<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>MPFX: /home/marc/cea-epfl/trunk/mpfx_package/mpfx/mpfx_job.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">MPFX&#160;<span id="projectnumber">1.0.0</span></div>
   <div id="projectbrief">MPF multiprocessing framework - Base adaptation layer</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('mpfx__job_8py.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>mpfx_job.py</h1>  </div>
</div>
<div class="contents">
<a href="mpfx__job_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespacempfx_1_1mpfx__job.html">00001</a> <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00002"></a>00002 <span class="stringliteral">   @package mpfx.mpfx_job Job Management</span>
<a name="l00003"></a>00003 <span class="stringliteral">   @author Marc Gentile</span>
<a name="l00004"></a>00004 <span class="stringliteral">   @file mpfx_job.py</span>
<a name="l00005"></a>00005 <span class="stringliteral">   Job Management</span>
<a name="l00006"></a>00006 <span class="stringliteral">&quot;&quot;&quot;</span> 
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="comment"># -- Python imports</span>
<a name="l00009"></a>00009 <span class="keyword">import</span> os, sys
<a name="l00010"></a>00010 <span class="keyword">import</span> re
<a name="l00011"></a>00011 <span class="keyword">import</span> time
<a name="l00012"></a>00012 <span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter, attrgetter
<a name="l00013"></a>00013 <span class="keyword">from</span> itertools <span class="keyword">import</span> chain
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="comment"># -- External imports</span>
<a name="l00016"></a>00016 <span class="keyword">from</span> mpfg.mp_job <span class="keyword">import</span> *         <span class="comment"># base job processing</span>
<a name="l00017"></a>00017 <span class="keyword">from</span> mpfg.mp_data <span class="keyword">import</span> *        <span class="comment"># data access</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="comment"># --- Module-specific imports</span>
<a name="l00020"></a>00020 <span class="keyword">from</span> mpfx_data <span class="keyword">import</span> *           <span class="comment"># dataset management</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="comment"># --------------------------------------------------------------------------------------------------</span>
<a name="l00023"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html">00023</a> <span class="keyword">class </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html" title="Job processor: submit jobs and process associated job results.">MpfxJobProcessor</a>(<a class="code" href="classJobProcessor.html">JobProcessor</a>):
<a name="l00024"></a>00024    
<a name="l00025"></a>00025    <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00026"></a>00026 <span class="stringliteral">      Job processor: submit jobs and process associated job results. Based on mpf.JobProcessor.   </span>
<a name="l00027"></a>00027 <span class="stringliteral">   &quot;&quot;&quot;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a427d91f98d121074733c7c2187ce8a1a">00029</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a427d91f98d121074733c7c2187ce8a1a">__init__</a>(self, master):
<a name="l00030"></a>00030       <span class="stringliteral">&quot;&quot;&quot; MpfxJobProcessor default constuctor &quot;&quot;&quot;</span>
<a name="l00031"></a>00031       JobProcessor.__init__(self, master)
<a name="l00032"></a>00032 
<a name="l00033"></a>00033       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#aa6b4f8a2fa6a05e5bab465efb355dcbe">_job_result_dico</a> = {}          <span class="comment"># dictionary holding all job results</span>
<a name="l00034"></a>00034       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a2a9b06be95f8b7d6b00a1b0157ce976a">_job_branches</a> = <span class="keywordtype">None</span>           <span class="comment"># all branches to process (initialized at jobs&#39; creation)</span>
<a name="l00035"></a>00035       
<a name="l00036"></a>00036    <span class="comment"># ~~~~~~~~~~</span>
<a name="l00037"></a>00037    <span class="comment"># Properties </span>
<a name="l00038"></a>00038    <span class="comment"># ~~~~~~~~~~</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040    @property
<a name="l00041"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#ad1c754c707d8c9ef38b22c0276631984">00041</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#ad1c754c707d8c9ef38b22c0276631984">job_result_dico</a>(self):
<a name="l00042"></a>00042       <span class="stringliteral">&quot;&quot;&quot;! @return the results of the processed jobs as a dictionary &quot;&quot;&quot;</span>
<a name="l00043"></a>00043       <span class="keywordflow">return</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#aa6b4f8a2fa6a05e5bab465efb355dcbe">_job_result_dico</a>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045    @property
<a name="l00046"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a6c37c93f855a725f94599f8b2a8c1ef5">00046</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a6c37c93f855a725f94599f8b2a8c1ef5">job_branches</a>(self):
<a name="l00047"></a>00047       <span class="stringliteral">&quot;&quot;&quot;! @return a list of all the branches (path trees) to process &quot;&quot;&quot;</span>
<a name="l00048"></a>00048       <span class="keywordflow">return</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a2a9b06be95f8b7d6b00a1b0157ce976a">_job_branches</a>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050    <span class="comment"># ~~~~~~~~~~~~~~~</span>
<a name="l00051"></a>00051    <span class="comment"># Public methods </span>
<a name="l00052"></a>00052    <span class="comment"># ~~~~~~~~~~~~~~~</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00055"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a463bb961b7d0d73e1927768cf28d1185">00055</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a463bb961b7d0d73e1927768cf28d1185" title="Invoked by worker to perform some optional pre-processing on the job.">preprocess_job</a>(self, job, worker):
<a name="l00056"></a>00056       <span class="stringliteral">&quot;&quot;&quot;! Invoked by worker to perform some optional pre-processing on the job. It may be for </span>
<a name="l00057"></a>00057 <span class="stringliteral">         instance some format conversion. or other preparation step before the actual</span>
<a name="l00058"></a>00058 <span class="stringliteral">         processing takes place in process_job().</span>
<a name="l00059"></a>00059 <span class="stringliteral"></span>
<a name="l00060"></a>00060 <span class="stringliteral">         @param job an object of class Job to pre-process</span>
<a name="l00061"></a>00061 <span class="stringliteral">         @param worker instance of the worker process</span>
<a name="l00062"></a>00062 <span class="stringliteral"></span>
<a name="l00063"></a>00063 <span class="stringliteral">         @note this method is called &lt;b&gt;before&lt;/b&gt; process_job_result()</span>
<a name="l00064"></a>00064 <span class="stringliteral">         @note this method is to be overridden by subclasses to perform</span>
<a name="l00065"></a>00065 <span class="stringliteral">               any processing required &lt;b&gt;before&lt;/b&gt; process_job() is called</span>
<a name="l00066"></a>00066 <span class="stringliteral">         @see process_job, postprocess_job, Job</span>
<a name="l00067"></a>00067 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00068"></a>00068       <span class="keywordflow">pass</span>
<a name="l00069"></a>00069 
<a name="l00070"></a>00070    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00071"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#aec2673df0b8974106279fcde91803856">00071</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#aec2673df0b8974106279fcde91803856" title="Process a job and return the corresponding results to the Master (here sample data).">process_job</a>(self, job, worker):
<a name="l00072"></a>00072       <span class="stringliteral">&quot;&quot;&quot;!</span>
<a name="l00073"></a>00073 <span class="stringliteral">         Process a job and return the corresponding results to the Master (here sample data). </span>
<a name="l00074"></a>00074 <span class="stringliteral"></span>
<a name="l00075"></a>00075 <span class="stringliteral">         @param job an object of class Job to process</span>
<a name="l00076"></a>00076 <span class="stringliteral">         @param worker instance of the worker process</span>
<a name="l00077"></a>00077 <span class="stringliteral">         @return an object of class JobResult containing the data of the processed job</span>
<a name="l00078"></a>00078 <span class="stringliteral">         @note this method should be overridden in a subclass of mpf </span>
<a name="l00079"></a>00079 <span class="stringliteral">         @see preprocess_job, postprocess_job, Job, JobResult</span>
<a name="l00080"></a>00080 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00081"></a>00081 
<a name="l00082"></a>00082       <span class="keywordflow">if</span> worker.logging_enabled():
<a name="l00083"></a>00083          worker.logger.log_info_p(<span class="stringliteral">&quot;{0} - job {1} - File types included: {2}&quot;</span>.format(
<a name="l00084"></a>00084                                                               worker, job, job.get_file_types()))
<a name="l00085"></a>00085 
<a name="l00086"></a>00086       data_dico = {<span class="stringliteral">&quot;result&quot;</span>: <span class="stringliteral">&quot;result from MpfxJob: {0}&quot;</span>.format(job.name)}    <span class="comment"># sample result data</span>
<a name="l00087"></a>00087 
<a name="l00088"></a>00088       <span class="comment"># simulate processing duration</span>
<a name="l00089"></a>00089       time.sleep(1)
<a name="l00090"></a>00090 
<a name="l00091"></a>00091       <span class="keywordflow">return</span> MpfxJobResult(worker, job, data_dico)  <span class="comment"># store the job results</span>
<a name="l00092"></a>00092 
<a name="l00093"></a>00093    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00094"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#aaaa2cad47e481dc1211d792d9d8bb9c9">00094</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#aaaa2cad47e481dc1211d792d9d8bb9c9" title="Invoked by the Worker to perform some optional post-processing on the job.">postprocess_job</a>(self, job_result, worker):
<a name="l00095"></a>00095       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00096"></a>00096 <span class="stringliteral">         Invoked by the Worker to perform some optional post-processing on the job.</span>
<a name="l00097"></a>00097 <span class="stringliteral"></span>
<a name="l00098"></a>00098 <span class="stringliteral">         @param job_result object of class JobResult with processed data</span>
<a name="l00099"></a>00099 <span class="stringliteral">         @param worker instance of the worker process</span>
<a name="l00100"></a>00100 <span class="stringliteral"></span>
<a name="l00101"></a>00101 <span class="stringliteral">         @note this method is called &lt;b&gt;after&lt;/b&gt; process_job_result()</span>
<a name="l00102"></a>00102 <span class="stringliteral">         @note this method is to be overridden by subclasses to perform</span>
<a name="l00103"></a>00103 <span class="stringliteral">               any processing required &lt;b&gt;after&lt;/b&gt; process_job() is called</span>
<a name="l00104"></a>00104 <span class="stringliteral">         @see process_job, postprocess_job, JobResult</span>
<a name="l00105"></a>00105 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00106"></a>00106       <span class="keywordflow">pass</span>
<a name="l00107"></a>00107 
<a name="l00108"></a>00108    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00109"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a4a1e2dec4ecb94bbb1cf826335a60a66">00109</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a4a1e2dec4ecb94bbb1cf826335a60a66" title="Process the result associated with a processed job, which may consist, for instance, in storing files to the output result directory tree, draw plots, compute statistics...">process_job_result</a>(self, job_result, master):
<a name="l00110"></a>00110       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00111"></a>00111 <span class="stringliteral">         Process the result associated with a processed job, which may consist, for instance, in </span>
<a name="l00112"></a>00112 <span class="stringliteral">         storing files to the output result directory tree, draw plots, compute statistics... </span>
<a name="l00113"></a>00113 <span class="stringliteral"></span>
<a name="l00114"></a>00114 <span class="stringliteral">         @param job_result object of class JobResult with processed data</span>
<a name="l00115"></a>00115 <span class="stringliteral">         @param master master process instance </span>
<a name="l00116"></a>00116 <span class="stringliteral">         @note This method should be overridden in a subclass of mpf  </span>
<a name="l00117"></a>00117 <span class="stringliteral">         @see Job, JobResult </span>
<a name="l00118"></a>00118 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00119"></a>00119 
<a name="l00120"></a>00120       <span class="keywordflow">if</span> master.logging_enabled():
<a name="l00121"></a>00121          master.logger.log_info_p(<span class="stringliteral">&quot;{0} - Processing result from job {1}...&quot;</span>.format(
<a name="l00122"></a>00122                                                                  master, job_result.job))
<a name="l00123"></a>00123 
<a name="l00124"></a>00124    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00125"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#aa3511fc7f5d3320712ecf95ee517494f">00125</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#aa3511fc7f5d3320712ecf95ee517494f" title="Locate all objects to process and create the corresponding jobs.">create_jobs</a>(self, master):
<a name="l00126"></a>00126       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00127"></a>00127 <span class="stringliteral">         Locate all objects to process and create the corresponding jobs. </span>
<a name="l00128"></a>00128 <span class="stringliteral">         @param master Master process instance</span>
<a name="l00129"></a>00129 <span class="stringliteral">         @return the list of created jobs </span>
<a name="l00130"></a>00130 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00131"></a>00131 
<a name="l00132"></a>00132       <span class="comment"># --- Create primary source Dataset</span>
<a name="l00133"></a>00133       dataset_name = master.config.get_as_string(<span class="stringliteral">&quot;NAME&quot;</span>, <span class="stringliteral">&quot;PRIMARY_DATASET&quot;</span>)
<a name="l00134"></a>00134       <span class="keywordflow">if</span> master.config.has_key(<span class="stringliteral">&quot;TYPE&quot;</span>, <span class="stringliteral">&quot;PRIMARY_DATASET&quot;</span>):
<a name="l00135"></a>00135          dataset_type = master.config.get_as_string(<span class="stringliteral">&quot;TYPE&quot;</span>, <span class="stringliteral">&quot;PRIMARY_DATASET&quot;</span>)
<a name="l00136"></a>00136       <span class="keywordflow">else</span>:
<a name="l00137"></a>00137          dataset_type = <span class="stringliteral">&quot;Mpfx&quot;</span>      <span class="comment"># default Dataset class prefix</span>
<a name="l00138"></a>00138       dataset_base_dir = master.config.get_as_string(<span class="stringliteral">&quot;BASE_DIR&quot;</span>, <span class="stringliteral">&quot;PRIMARY_DATASET&quot;</span>)
<a name="l00139"></a>00139       <span class="keywordflow">if</span> master.config.has_key(<span class="stringliteral">&quot;DIR_INPUT_LIST&quot;</span>, <span class="stringliteral">&quot;PRIMARY_DATASET&quot;</span>):
<a name="l00140"></a>00140          dataset_dir_list = master.config.get_as_list(<span class="stringliteral">&quot;DIR_INPUT_LIST&quot;</span>, <span class="stringliteral">&quot;PRIMARY_DATASET&quot;</span>)
<a name="l00141"></a>00141       <span class="keywordflow">else</span>:
<a name="l00142"></a>00142          dataset_dir_list = []
<a name="l00143"></a>00143       dataset_image_list = master.config.get_as_list(<span class="stringliteral">&quot;IMAGE_LIST&quot;</span>, <span class="stringliteral">&quot;PRIMARY_DATASET&quot;</span>)
<a name="l00144"></a>00144       dataset_image_range = master.config.get_as_list(<span class="stringliteral">&quot;IMAGE_RANGE&quot;</span>, <span class="stringliteral">&quot;PRIMARY_DATASET&quot;</span>)
<a name="l00145"></a>00145       dataset_file_patterns = master.config.get_as_list(<span class="stringliteral">&quot;FILE_PATTERNS&quot;</span>, <span class="stringliteral">&quot;PRIMARY_DATASET&quot;</span>)
<a name="l00146"></a>00146       <span class="keywordflow">if</span> master.config.has_key(<span class="stringliteral">&quot;DIR_RECURSE&quot;</span>, <span class="stringliteral">&quot;PRIMARY_DATASET&quot;</span>):
<a name="l00147"></a>00147          dataset_recurse_dirs = master.config.get_as_boolean(<span class="stringliteral">&quot;DIR_RECURSE&quot;</span>, <span class="stringliteral">&quot;PRIMARY_DATASET&quot;</span>)
<a name="l00148"></a>00148       <span class="keywordflow">else</span>:
<a name="l00149"></a>00149          dataset_recurse_dirs = <span class="keyword">True</span>
<a name="l00150"></a>00150 
<a name="l00151"></a>00151       dataset = self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a9e8020b5740ddfca321591bb62c7ef99" title="Create a Dataset object that represent the data source for images and catalogs.">create_dataset</a>(master, dataset_name, dataset_type, 
<a name="l00152"></a>00152                                             dataset_base_dir, dataset_dir_list, 
<a name="l00153"></a>00153                                             dataset_recurse_dirs)
<a name="l00154"></a>00154       <span class="keywordflow">if</span> dataset <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00155"></a>00155          <span class="keywordflow">if</span> master.logging_enabled():
<a name="l00156"></a>00156             master.logger.log_error_p(<span class="stringliteral">&quot;{0} - Dataset {1} could not be instantiated...&quot;</span>.format(
<a name="l00157"></a>00157                                                                 master, dataset_name))   
<a name="l00158"></a>00158 
<a name="l00159"></a>00159          <span class="comment"># --- Dataset could not be instantiated, return no jobs</span>
<a name="l00160"></a>00160          self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#ae1562f3b8efee4cb7ba55f4fcea17089">_job_list</a> = []
<a name="l00161"></a>00161          self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a2a9b06be95f8b7d6b00a1b0157ce976a">_job_branches</a> = []
<a name="l00162"></a>00162          <span class="keywordflow">return</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#ae1562f3b8efee4cb7ba55f4fcea17089">_job_list</a>
<a name="l00163"></a>00163 
<a name="l00164"></a>00164       <span class="comment"># --- Search for matching files to process</span>
<a name="l00165"></a>00165 
<a name="l00166"></a>00166       <span class="keywordflow">if</span> master.logging_enabled():
<a name="l00167"></a>00167          master.logger.log_info_p(<span class="stringliteral">&quot;{0} - Looking for files to process in directory: {1}...&quot;</span>.format(
<a name="l00168"></a>00168                                                              master, dataset_base_dir))   
<a name="l00169"></a>00169          <span class="keywordflow">if</span> len(dataset_dir_list) &gt; 0:
<a name="l00170"></a>00170             master.logger.log_info_p(<span class="stringliteral">&quot;{0} - Input dir(s): {1}&quot;</span>.format(master, dataset_dir_list))
<a name="l00171"></a>00171          <span class="keywordflow">else</span>:
<a name="l00172"></a>00172             master.logger.log_info_p(<span class="stringliteral">&quot;{0} - Input dir(s): {1}&quot;</span>.format(master, dataset_base_dir))
<a name="l00173"></a>00173 
<a name="l00174"></a>00174          master.logger.log_info_p(<span class="stringliteral">&quot;{0} - Input files: {1}&quot;</span>.format(master, dataset_file_patterns))
<a name="l00175"></a>00175 
<a name="l00176"></a>00176       filepath_dico = dataset.query(master, dataset_file_patterns, 
<a name="l00177"></a>00177                                     dir_list=dataset_dir_list,
<a name="l00178"></a>00178                                     image_list=dataset_image_list,
<a name="l00179"></a>00179                                     image_range=dataset_image_range,
<a name="l00180"></a>00180                                     sort=<span class="keyword">True</span>, recurse=dataset_recurse_dirs)
<a name="l00181"></a>00181 
<a name="l00182"></a>00182       <span class="comment"># --- For the multiepoch branch, make sure the catalog paths are also included</span>
<a name="l00183"></a>00183       <span class="comment">#     for images with non-zero epoch indice</span>
<a name="l00184"></a>00184       <span class="keywordflow">for</span> branch_key <span class="keywordflow">in</span> filepath_dico: 
<a name="l00185"></a>00185 
<a name="l00186"></a>00186          <span class="keywordflow">if</span> len(filepath_dico[branch_key].keys()) &lt; 2:
<a name="l00187"></a>00187 
<a name="l00188"></a>00188             <span class="comment"># --- Extract catalog file_types and paths from image with 0 epoch index</span>
<a name="l00189"></a>00189             <span class="comment">#     and insert them in filepath_dico[branch_key] where they are missing</span>
<a name="l00190"></a>00190             
<a name="l00191"></a>00191             new_branch_key = branch_key[:-1] + tuple([0])
<a name="l00192"></a>00192 
<a name="l00193"></a>00193             branch_items = filepath_dico[new_branch_key].items()
<a name="l00194"></a>00194             <span class="keywordflow">for</span> (file_type, file_path) <span class="keywordflow">in</span> branch_items:
<a name="l00195"></a>00195 
<a name="l00196"></a>00196                <span class="keywordflow">if</span> dataset.is_catalog(master, file_type):
<a name="l00197"></a>00197                   filepath_dico[branch_key][file_type] = file_path
<a name="l00198"></a>00198 
<a name="l00199"></a>00199       <span class="comment"># --- Create a Job object for each image &lt;img_no&gt; in the relevant branch structure, </span>
<a name="l00200"></a>00200       <span class="comment">#     with the filepaths for each type of file (images, catalogs...)</span>
<a name="l00201"></a>00201 
<a name="l00202"></a>00202       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#ae1562f3b8efee4cb7ba55f4fcea17089">_job_list</a> = [self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#aea504c5b730e76ab21e56a7d351abe33" title="Factory method for creating a Job object.">create_job</a>(master, dataset, filepath_dico, *key) \
<a name="l00203"></a>00203                         <span class="keywordflow">for</span> key <span class="keywordflow">in</span> sorted(filepath_dico.keys())]
<a name="l00204"></a>00204 
<a name="l00205"></a>00205       <span class="comment"># --- Record the list of branches to which jobs belongs</span>
<a name="l00206"></a>00206       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a2a9b06be95f8b7d6b00a1b0157ce976a">_job_branches</a> = list(set([j.branch <span class="keywordflow">for</span> j <span class="keywordflow">in</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#ae1562f3b8efee4cb7ba55f4fcea17089">_job_list</a>]))      
<a name="l00207"></a>00207 
<a name="l00208"></a>00208       <span class="comment"># --- Create output directories for job outputs:</span>
<a name="l00209"></a>00209       output_dir_dico = master.config.get_section_data(<span class="stringliteral">&quot;DIR.OUTPUT&quot;</span>)
<a name="l00210"></a>00210       <span class="keywordflow">for</span> (dir_key, dir_value) <span class="keywordflow">in</span> output_dir_dico.items():
<a name="l00211"></a>00211          <span class="keywordflow">if</span> dir_key.startswith(<span class="stringliteral">&quot;OUTPUT_&quot;</span>):
<a name="l00212"></a>00212             <span class="keywordflow">if</span> dir_key.find(<span class="stringliteral">&quot;LOG&quot;</span>) == -1:  <span class="comment"># no tree for log dirs</span>
<a name="l00213"></a>00213                base_dir = os.path.join(master.run_output_dir, dir_value)
<a name="l00214"></a>00214                <span class="comment">#self.helper.make_dir(base_dir)</span>
<a name="l00215"></a>00215                self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#afd9db34203f001d198272fed8dc156b9" title="Create the directory tree for storing the results.">_create_dir_tree</a>(base_dir, self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a2a9b06be95f8b7d6b00a1b0157ce976a">_job_branches</a>)      
<a name="l00216"></a>00216 
<a name="l00217"></a>00217       <span class="keywordflow">return</span> sorted(self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#ae1562f3b8efee4cb7ba55f4fcea17089">_job_list</a>, key=attrgetter(<span class="stringliteral">&#39;img_no&#39;</span>))   <span class="comment"># sort by img_no</span>
<a name="l00218"></a>00218 
<a name="l00219"></a>00219    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00220"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#aea504c5b730e76ab21e56a7d351abe33">00220</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#aea504c5b730e76ab21e56a7d351abe33" title="Factory method for creating a Job object.">create_job</a>(self, master, dataset, *args):
<a name="l00221"></a>00221 
<a name="l00222"></a>00222       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00223"></a>00223 <span class="stringliteral">         Factory method for creating a Job object.</span>
<a name="l00224"></a>00224 <span class="stringliteral">         Each subclass can define a job class derived from mpf.Job and instanciate it here.</span>
<a name="l00225"></a>00225 <span class="stringliteral">         @param master master process instance</span>
<a name="l00226"></a>00226 <span class="stringliteral">         @param dataset data source used to create the job</span>
<a name="l00227"></a>00227 <span class="stringliteral">         @param args a list of arguments chosen by the caller and whose nature depends on the </span>
<a name="l00228"></a>00228 <span class="stringliteral">                data necessary to process the job</span>
<a name="l00229"></a>00229 <span class="stringliteral">         @return a new MpfxJob job object</span>
<a name="l00230"></a>00230 <span class="stringliteral">         @see Job, MpfxJob</span>
<a name="l00231"></a>00231 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00232"></a>00232 
<a name="l00233"></a>00233       <span class="keywordflow">return</span> MpfxJob(master, dataset, *args)  <span class="comment"># create a MpfxJob instance, based on parent class mpf.Job</span>
<a name="l00234"></a>00234       
<a name="l00235"></a>00235    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00236"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a9e8020b5740ddfca321591bb62c7ef99">00236</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a9e8020b5740ddfca321591bb62c7ef99" title="Create a Dataset object that represent the data source for images and catalogs.">create_dataset</a>(self, master, dataset_name, dataset_type, dataset_base_dir, 
<a name="l00237"></a>00237                                     dataset_dir_list, dataset_recurse_dirs):
<a name="l00238"></a>00238       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00239"></a>00239 <span class="stringliteral">         Create a Dataset object that represent the data source for images and catalogs.</span>
<a name="l00240"></a>00240 <span class="stringliteral">         @param master master process instance</span>
<a name="l00241"></a>00241 <span class="stringliteral">         @param dataset_name dataset name</span>
<a name="l00242"></a>00242 <span class="stringliteral">         @param dataset_type prefix of a Dataset class, assumed to be of the form </span>
<a name="l00243"></a>00243 <span class="stringliteral">                @code &lt;dataset_type&gt;Dataset @endcode, like @c MpfxDataset</span>
<a name="l00244"></a>00244 <span class="stringliteral">         @param dataset_base_dir dataset base directory</span>
<a name="l00245"></a>00245 <span class="stringliteral">         @param dataset_dir_list dataset list of directories to search for input files</span>
<a name="l00246"></a>00246 <span class="stringliteral">         @param dataset_recurse_dirs true for a recursive input file search, false otherwise</span>
<a name="l00247"></a>00247 <span class="stringliteral">         @return the Dataset instance </span>
<a name="l00248"></a>00248 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00249"></a>00249 
<a name="l00250"></a>00250       <span class="keywordflow">return</span> MpfxDataset(master, dataset_name, dataset_base_dir, 
<a name="l00251"></a>00251                                  dataset_dir_list, dataset_recurse_dirs) 
<a name="l00252"></a>00252 
<a name="l00253"></a>00253    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00254"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a5e39adae968174e8bf1293f22adf3a12">00254</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a5e39adae968174e8bf1293f22adf3a12" title="Load and return a specific Dataset class, ready to be instantiated to create a dataset.">get_dataset_module</a>(self, master, dataset_name, dataset_type, dataset_base_dir):
<a name="l00255"></a>00255       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00256"></a>00256 <span class="stringliteral">         Load and return a specific Dataset class, ready to be instantiated to create a dataset. </span>
<a name="l00257"></a>00257 <span class="stringliteral">         Such a class may be derived fronm class @c MpxDataset to support a specific survey Dataset.  </span>
<a name="l00258"></a>00258 <span class="stringliteral">         @param master master process instance</span>
<a name="l00259"></a>00259 <span class="stringliteral">         @param dataset_name dataset name</span>
<a name="l00260"></a>00260 <span class="stringliteral">         @param dataset_type prefix of a Dataset class, assumed to be of the form </span>
<a name="l00261"></a>00261 <span class="stringliteral">                @code &lt;dataset_type&gt;Dataset @endcode, like @c MpfxDataset</span>
<a name="l00262"></a>00262 <span class="stringliteral">         @param dataset_base_dir dataset base directory</span>
<a name="l00263"></a>00263 <span class="stringliteral">         @return the Dataset object </span>
<a name="l00264"></a>00264 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00265"></a>00265 
<a name="l00266"></a>00266       <span class="keywordflow">if</span> dataset_type == <span class="stringliteral">&quot;Mpfx&quot;</span>:
<a name="l00267"></a>00267 
<a name="l00268"></a>00268          dataset_module = sys.modules[<span class="stringliteral">&quot;mpfx.mpfx_data&quot;</span>]
<a name="l00269"></a>00269          class_name = <span class="stringliteral">&quot;{0}Dataset&quot;</span>.format(dataset_type)
<a name="l00270"></a>00270          dataset_ctor = eval(<span class="stringliteral">&quot;dataset_module.&quot;</span> + class_name)
<a name="l00271"></a>00271          <span class="keywordflow">if</span> master.logging_enabled():
<a name="l00272"></a>00272             master.logger.log_info_p(           
<a name="l00273"></a>00273               <span class="stringliteral">&quot;{0} - Using Dataset type {1} [{2}]&quot;</span>.format(
<a name="l00274"></a>00274                      master.name, dataset_ctor, os.path.dirname(dataset_module.__file__)))
<a name="l00275"></a>00275          <span class="keywordflow">return</span> dataset_ctor
<a name="l00276"></a>00276 
<a name="l00277"></a>00277       <span class="keywordflow">else</span>:
<a name="l00278"></a>00278 
<a name="l00279"></a>00279          <span class="keywordflow">try</span>:
<a name="l00280"></a>00280             prefix = <span class="stringliteral">&quot;{0}.{0}_data&quot;</span>.format(dataset_type.lower())
<a name="l00281"></a>00281             class_name = <span class="stringliteral">&quot;{0}_data.{1}Dataset&quot;</span>.format(dataset_type.lower(), dataset_type)
<a name="l00282"></a>00282             dataset_module = __import__(prefix, globals(), locals(), [], -1)
<a name="l00283"></a>00283             dataset_ctor = eval(<span class="stringliteral">&quot;dataset_module.&quot;</span> + class_name)   
<a name="l00284"></a>00284 
<a name="l00285"></a>00285             <span class="keywordflow">if</span> master.logging_enabled():
<a name="l00286"></a>00286                master.logger.log_info_p(           
<a name="l00287"></a>00287                  <span class="stringliteral">&quot;{0} - Loading Dataset type {1} [{2}]&quot;</span>.format(
<a name="l00288"></a>00288                         master.name, dataset_ctor, os.path.dirname(dataset_module.__file__)))  
<a name="l00289"></a>00289             <span class="keywordflow">return</span> dataset_ctor
<a name="l00290"></a>00290 
<a name="l00291"></a>00291          <span class="keywordflow">except</span>:      
<a name="l00292"></a>00292             <span class="keywordflow">if</span> master.logging_enabled():
<a name="l00293"></a>00293                master.logger.log_error_p(           
<a name="l00294"></a>00294                  <span class="stringliteral">&quot;{0} - the Dataset {1}Dataset could not be loaded. &quot;</span>\
<a name="l00295"></a>00295                   <span class="stringliteral">&quot;Check that it has been installed &quot;</span>\
<a name="l00296"></a>00296                   <span class="stringliteral">&quot;and that it is referenced in PYTHONPATH.&quot;</span>.format(master.name, dataset_type))  
<a name="l00297"></a>00297                master.logger.log_warning_p(           
<a name="l00298"></a>00298                  <span class="stringliteral">&quot;{0} - Using {1} as default Dataset type &quot;</span>\
<a name="l00299"></a>00299                   <span class="stringliteral">&quot;instead of {2}Dataset ...&quot;</span>.format(master.name, <span class="stringliteral">&quot;MpfxDataset&quot;</span>, dataset_type))  
<a name="l00300"></a>00300             <span class="keywordflow">return</span> MpfxDataset   
<a name="l00301"></a>00301 
<a name="l00302"></a>00302    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00303"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a26d38bfa5ed7d08ed87889ca829a1fe4">00303</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a26d38bfa5ed7d08ed87889ca829a1fe4" title="Add a job result to the list of job results.">record_job_result</a>(self, job_result, master):
<a name="l00304"></a>00304       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00305"></a>00305 <span class="stringliteral">         Add a job result to the list of job results. This method is invoked by the Master. </span>
<a name="l00306"></a>00306 <span class="stringliteral">         @param master instance of the Master</span>
<a name="l00307"></a>00307 <span class="stringliteral">         @param job_result object of class JobResult containing the data of the processed job  </span>
<a name="l00308"></a>00308 <span class="stringliteral">         @see Job, JobResult       </span>
<a name="l00309"></a>00309 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00310"></a>00310 
<a name="l00311"></a>00311       branch = job_result.job.branch
<a name="l00312"></a>00312       img_no = job_result.job.img_no
<a name="l00313"></a>00313       epoch = job_result.job.epoch
<a name="l00314"></a>00314 
<a name="l00315"></a>00315       result_dico = self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#ad1c754c707d8c9ef38b22c0276631984">job_result_dico</a>
<a name="l00316"></a>00316       <span class="keywordflow">for</span> branch_dir <span class="keywordflow">in</span> job_result.job.branch_dirs:
<a name="l00317"></a>00317          <span class="keywordflow">if</span> <span class="keywordflow">not</span> branch_dir <span class="keywordflow">in</span> result_dico:
<a name="l00318"></a>00318             result_dico[branch_dir] = {}
<a name="l00319"></a>00319          result_dico = result_dico[branch_dir] 
<a name="l00320"></a>00320 
<a name="l00321"></a>00321       <span class="keywordflow">if</span> <span class="keywordflow">not</span> img_no <span class="keywordflow">in</span> result_dico: 
<a name="l00322"></a>00322          result_dico[img_no] = {}
<a name="l00323"></a>00323 
<a name="l00324"></a>00324       <span class="keywordflow">if</span> <span class="keywordflow">not</span> epoch <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> <span class="keywordflow">not</span> epoch <span class="keywordflow">in</span> result_dico[img_no]:
<a name="l00325"></a>00325           result_dico[img_no][epoch] = {}
<a name="l00326"></a>00326 
<a name="l00327"></a>00327       <span class="comment"># --- Record job result with the relevant branch tree structure   </span>
<a name="l00328"></a>00328       <span class="keywordflow">if</span> epoch <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00329"></a>00329          result_dico[img_no][<span class="keywordtype">None</span>] = job_result
<a name="l00330"></a>00330       <span class="keywordflow">else</span>:
<a name="l00331"></a>00331          result_dico[img_no][epoch] = job_result
<a name="l00332"></a>00332 
<a name="l00333"></a>00333    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00334"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#af7b416e3792f11f1c76cb37f05643549">00334</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#af7b416e3792f11f1c76cb37f05643549" title="This method is called by the Master once all the jobs have been processed.">all_jobs_processed</a>(self, master):
<a name="l00335"></a>00335       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00336"></a>00336 <span class="stringliteral">         This method is called by the Master once all the jobs have been processed. </span>
<a name="l00337"></a>00337 <span class="stringliteral">         @param master instance of the Master</span>
<a name="l00338"></a>00338 <span class="stringliteral">         @note Job results can be selectively obtained by calling the get_job_results() methods,</span>
<a name="l00339"></a>00339 <span class="stringliteral">               specifying the relevant query criterion: branch, observation type, data type, image </span>
<a name="l00340"></a>00340 <span class="stringliteral">         @note the entire list of Job results can aldo be obtained with by calling </span>
<a name="l00341"></a>00341 <span class="stringliteral">               JobProcessor.job_result_list()</span>
<a name="l00342"></a>00342 <span class="stringliteral">         @see Job, JobResult, get_job_result()</span>
<a name="l00343"></a>00343 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00344"></a>00344       <span class="comment"># --- Dump all results for checking     </span>
<a name="l00345"></a>00345       <span class="keywordflow">if</span> master.logging_enabled():
<a name="l00346"></a>00346          <span class="keywordflow">for</span> branch <span class="keywordflow">in</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a6c37c93f855a725f94599f8b2a8c1ef5">job_branches</a>:
<a name="l00347"></a>00347             job_results = self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a866b218969aee45bff24d56f40d4c3d6" title="Return the list of MpfxJobResult objects for a specified branch, observation type, data_type and image number.">get_job_results</a>(branch=branch)
<a name="l00348"></a>00348             master.logger.log_info_p(<span class="stringliteral">&quot;{0} - Results from branch {1}: {2}&quot;</span>.format(
<a name="l00349"></a>00349                                      master, branch, [r.result <span class="keywordflow">for</span> r <span class="keywordflow">in</span> job_results]))
<a name="l00350"></a>00350       <span class="keywordflow">else</span>:
<a name="l00351"></a>00351          <span class="keywordflow">pass</span>
<a name="l00352"></a>00352 
<a name="l00353"></a>00353    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00354"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a866b218969aee45bff24d56f40d4c3d6">00354</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a866b218969aee45bff24d56f40d4c3d6" title="Return the list of MpfxJobResult objects for a specified branch, observation type, data_type and image number.">get_job_results</a>(self, **kwargs):
<a name="l00355"></a>00355       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00356"></a>00356 <span class="stringliteral">         Return the list of MpfxJobResult objects for a specified branch, observation type, </span>
<a name="l00357"></a>00357 <span class="stringliteral">         data_type and image number. These parameters must be specified using the </span>
<a name="l00358"></a>00358 <span class="stringliteral">         &quot;branch=&quot;, &quot;img_no=&quot; and &quot;epoch=&quot; keywords</span>
<a name="l00359"></a>00359 <span class="stringliteral">         @return list of MpfxJobResult objects</span>
<a name="l00360"></a>00360 <span class="stringliteral">         @code</span>
<a name="l00361"></a>00361 <span class="stringliteral">            Examples</span>
<a name="l00362"></a>00362 <span class="stringliteral">            - self.get_job_results(branch=&quot;control/space&quot;) to retrieve job results for all images </span>
<a name="l00363"></a>00363 <span class="stringliteral">              and epochs in branch &quot;control/space&quot;</span>
<a name="l00364"></a>00364 <span class="stringliteral">            - self.get_job_results(branch=&quot;control/space/variable&quot;, img_no=1) to retrieve </span>
<a name="l00365"></a>00365 <span class="stringliteral">              job results of branch &quot;control/space/variable&quot;, image number 1, all epochs </span>
<a name="l00366"></a>00366 <span class="stringliteral">            - self.get_job_results(branch=&quot;control/space/variable&quot;, img_no=1, epoch=2) to retrieve </span>
<a name="l00367"></a>00367 <span class="stringliteral">              job results of branch &quot;control/space/variable&quot;, image number 1, epoch index 2 </span>
<a name="l00368"></a>00368 <span class="stringliteral">         @endcode</span>
<a name="l00369"></a>00369 <span class="stringliteral">         @note MpfxJobResult objects can also be directly obtained from the </span>
<a name="l00370"></a>00370 <span class="stringliteral">               mpfx.mpfx_job.MpfxJobProcessor.job_result_dico dictionary</span>
<a name="l00371"></a>00371 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00372"></a>00372       job_result_list = [] 
<a name="l00373"></a>00373 
<a name="l00374"></a>00374       branch = kwargs.get(<span class="stringliteral">&quot;branch&quot;</span>, <span class="keywordtype">None</span>)    <span class="comment"># branch tree path, e.g. &quot;control/ground/constant&quot;</span>
<a name="l00375"></a>00375       img_no = kwargs.get(<span class="stringliteral">&quot;img_no&quot;</span>, <span class="keywordtype">None</span>)
<a name="l00376"></a>00376       epoch  = kwargs.get(<span class="stringliteral">&quot;epoch&quot;</span>, <span class="keywordtype">None</span>)
<a name="l00377"></a>00377  
<a name="l00378"></a>00378       <span class="keywordflow">if</span> branch <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00379"></a>00379 
<a name="l00380"></a>00380          branch.strip(<span class="stringliteral">&quot;/&quot;</span>)                <span class="comment"># strip first &quot;/&quot; just in case...</span>
<a name="l00381"></a>00381          branch_dirs = branch.split(<span class="stringliteral">&quot;/&quot;</span>)  <span class="comment"># extract branch dir components</span>
<a name="l00382"></a>00382 
<a name="l00383"></a>00383          <span class="comment"># Point to the dictionary level of the leaf branch directory         </span>
<a name="l00384"></a>00384          job_result_dico = self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#aa6b4f8a2fa6a05e5bab465efb355dcbe">_job_result_dico</a>
<a name="l00385"></a>00385          <span class="keywordflow">for</span> branch_dir <span class="keywordflow">in</span> branch_dirs:
<a name="l00386"></a>00386             job_result_dico = job_result_dico[branch_dir]     
<a name="l00387"></a>00387 
<a name="l00388"></a>00388          <span class="keywordflow">if</span> img_no <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00389"></a>00389             <span class="keywordflow">if</span> img_no <span class="keywordflow">in</span> job_result_dico:
<a name="l00390"></a>00390                <span class="keywordflow">if</span> epoch <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00391"></a>00391                   <span class="comment"># image and epoch</span>
<a name="l00392"></a>00392                   <span class="keywordflow">if</span> epoch <span class="keywordflow">in</span> job_result_dico[img_no]:
<a name="l00393"></a>00393                      job_result_list.append(job_result_dico[img_no][epoch])
<a name="l00394"></a>00394                <span class="keywordflow">else</span>:
<a name="l00395"></a>00395                   <span class="comment"># all epochs of the image </span>
<a name="l00396"></a>00396                   job_result_list = list(self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a45549a9d1907e5a254f158aa553d0e84" title="Flatten a nested dictionary in order to return all values irrespective of nesting levels...">_flatten_dict</a>(job_result_dico[img_no]))
<a name="l00397"></a>00397          <span class="keywordflow">else</span>:
<a name="l00398"></a>00398             <span class="keywordflow">if</span> epoch <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00399"></a>00399                self.helper.print_error(
<a name="l00400"></a>00400                        <span class="stringliteral">&quot;get_job_results(): an image number must be specified&quot;</span>)
<a name="l00401"></a>00401             <span class="keywordflow">else</span>:
<a name="l00402"></a>00402                <span class="comment"># all image and epochs in the branch  </span>
<a name="l00403"></a>00403                job_result_list = list(self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a45549a9d1907e5a254f158aa553d0e84" title="Flatten a nested dictionary in order to return all values irrespective of nesting levels...">_flatten_dict</a>(job_result_dico))
<a name="l00404"></a>00404 
<a name="l00405"></a>00405       <span class="keywordflow">else</span>:
<a name="l00406"></a>00406          <span class="comment"># Unspecified branch</span>
<a name="l00407"></a>00407          <span class="keywordflow">if</span> img_no <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00408"></a>00408             job_result_list = list(self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a45549a9d1907e5a254f158aa553d0e84" title="Flatten a nested dictionary in order to return all values irrespective of nesting levels...">_flatten_dict</a>(self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#aa6b4f8a2fa6a05e5bab465efb355dcbe">_job_result_dico</a>))
<a name="l00409"></a>00409          <span class="keywordflow">else</span>:         
<a name="l00410"></a>00410             self.helper.print_error(
<a name="l00411"></a>00411                              <span class="stringliteral">&quot;get_job_results(): a branch must be specified&quot;</span>)
<a name="l00412"></a>00412                   
<a name="l00413"></a>00413       <span class="keywordflow">return</span> job_result_list
<a name="l00414"></a>00414 
<a name="l00415"></a>00415 
<a name="l00416"></a>00416    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00417"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#af87c0fa7a2b6223c9d8c21f22e2fb38d">00417</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#af87c0fa7a2b6223c9d8c21f22e2fb38d" title="Find and load a module module_name from a directory module_dir.">import_module</a>(self, master, top_module, module_name):
<a name="l00418"></a>00418       <span class="stringliteral">&quot;&quot;&quot;! Find and load a module @c module_name from a directory @c module_dir &quot;&quot;&quot;</span>
<a name="l00419"></a>00419 
<a name="l00420"></a>00420       <span class="keywordflow">try</span>:
<a name="l00421"></a>00421 
<a name="l00422"></a>00422          file_obj, filename, data = imp.find_module(top_module)
<a name="l00423"></a>00423 
<a name="l00424"></a>00424          <span class="keywordflow">return</span> imp.load_module(module_name, file_obj, filename, data)
<a name="l00425"></a>00425 
<a name="l00426"></a>00426       <span class="keywordflow">except</span>:
<a name="l00427"></a>00427          <span class="keywordflow">if</span> master.logging_enabled():
<a name="l00428"></a>00428             master.logger.log_error_p(           
<a name="l00429"></a>00429               <span class="stringliteral">&quot;{0} - The module {1} is not available: &quot;</span>\
<a name="l00430"></a>00430               <span class="stringliteral">&quot;check it has been installed and that it is referenced in PYTHONPATH)&quot;</span>.format(
<a name="l00431"></a>00431                                                                         master.name, module_name))
<a name="l00432"></a>00432 
<a name="l00433"></a>00433 
<a name="l00434"></a>00434    <span class="comment"># ~~~~~~~~~~~~~~~</span>
<a name="l00435"></a>00435    <span class="comment"># Private methods </span>
<a name="l00436"></a>00436    <span class="comment"># ~~~~~~~~~~~~~~~</span>
<a name="l00437"></a>00437 
<a name="l00438"></a>00438    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00439"></a>00439    <span class="keyword">def </span>_create_dir_tree(self, base_dir, branches):
<a name="l00440"></a>00440       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00441"></a>00441 <span class="stringliteral">         Create the directory tree for storing the results.</span>
<a name="l00442"></a>00442 <span class="stringliteral">         @param base_dir base directory</span>
<a name="l00443"></a>00443 <span class="stringliteral">         @param branches list of ordered directory names, making a path tree</span>
<a name="l00444"></a>00444 <span class="stringliteral">         @note example of directory layout: control/ground/constant</span>
<a name="l00445"></a>00445 <span class="stringliteral">         @see configuration file</span>
<a name="l00446"></a>00446 <span class="stringliteral">      &quot;&quot;&quot;</span>      
<a name="l00447"></a>00447 
<a name="l00448"></a>00448       <span class="keywordflow">for</span> branch <span class="keywordflow">in</span> branches:
<a name="l00449"></a>00449          dir_names = branch.split(<span class="stringliteral">&quot;/&quot;</span>)
<a name="l00450"></a>00450          branch_path = base_dir
<a name="l00451"></a>00451          <span class="keywordflow">for</span> dir_name <span class="keywordflow">in</span> dir_names:
<a name="l00452"></a>00452             branch_path = os.path.join(branch_path, dir_name)
<a name="l00453"></a>00453             self.helper.make_dir(branch_path)
<a name="l00454"></a>00454 
<a name="l00455"></a>00455    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00456"></a>00456    <span class="keyword">def </span>_flatten_dict(self, d):
<a name="l00457"></a>00457       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00458"></a>00458 <span class="stringliteral">         Flatten a nested dictionary in order to return all values irrespective of nesting levels </span>
<a name="l00459"></a>00459 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00460"></a>00460       <span class="keywordflow">for</span> v <span class="keywordflow">in</span> d.values():
<a name="l00461"></a>00461          <span class="keywordflow">if</span> isinstance(v, dict):
<a name="l00462"></a>00462             <span class="keywordflow">for</span> val <span class="keywordflow">in</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html#a45549a9d1907e5a254f158aa553d0e84" title="Flatten a nested dictionary in order to return all values irrespective of nesting levels...">_flatten_dict</a>(v):
<a name="l00463"></a>00463                <span class="keywordflow">yield</span> val
<a name="l00464"></a>00464          <span class="keywordflow">else</span>:
<a name="l00465"></a>00465             <span class="keywordflow">yield</span> v
<a name="l00466"></a>00466 
<a name="l00467"></a>00467 
<a name="l00468"></a>00468 <span class="comment"># -------------------------------------------------------------------------------------------------</span>
<a name="l00469"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html">00469</a> <span class="keyword">class </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html" title="Represents a Mpfx job.">MpfxJob</a>(<a class="code" href="classJob.html">Job</a>):      
<a name="l00470"></a>00470 
<a name="l00471"></a>00471    <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00472"></a>00472 <span class="stringliteral">       Represents a Mpfx job </span>
<a name="l00473"></a>00473 <span class="stringliteral">   &quot;&quot;&quot;</span>
<a name="l00474"></a>00474 
<a name="l00475"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a5d39babf709c07dd365f145d41d0415a">00475</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a5d39babf709c07dd365f145d41d0415a" title="Construct a new job for identifiying a set of files in the dataset to process together.">__init__</a>(self, master, dataset, img_path_dico, *args):
<a name="l00476"></a>00476       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00477"></a>00477 <span class="stringliteral">         Construct a new job for identifiying a set of files in the dataset to process together.</span>
<a name="l00478"></a>00478 <span class="stringliteral"></span>
<a name="l00479"></a>00479 <span class="stringliteral">         To obtain the path associated with a given type, just use:</span>
<a name="l00480"></a>00480 <span class="stringliteral">         @code self.img_path_dico[type]@endcode with one of the aforementioned types.</span>
<a name="l00481"></a>00481 <span class="stringliteral"></span>
<a name="l00482"></a>00482 <span class="stringliteral">         @param master master process instance</span>
<a name="l00483"></a>00483 <span class="stringliteral">         @param dataset data source used to create the job</span>
<a name="l00484"></a>00484 <span class="stringliteral">         @param img_path_dico file absolute path dictionary  for every file types referenced in </span>
<a name="l00485"></a>00485 <span class="stringliteral">                the job</span>
<a name="l00486"></a>00486 <span class="stringliteral">         @param args a list with the branch tree, image number and epoch number</span>
<a name="l00487"></a>00487 <span class="stringliteral"></span>
<a name="l00488"></a>00488 <span class="stringliteral">         @return an initialized MpfxJob object </span>
<a name="l00489"></a>00489 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00490"></a>00490  
<a name="l00491"></a>00491       img_no = args[-2]
<a name="l00492"></a>00492       epoch_no = args[-1]
<a name="l00493"></a>00493       branch_dirs = args[:-2]
<a name="l00494"></a>00494 
<a name="l00495"></a>00495       branch_key = list(branch_dirs)
<a name="l00496"></a>00496       branch_key.extend([img_no, epoch_no])
<a name="l00497"></a>00497 
<a name="l00498"></a>00498       <span class="keywordflow">if</span> epoch_no <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00499"></a>00499          <span class="comment"># A file without epoch index, e.g. a catalog like star_catalog-000.txt</span>
<a name="l00500"></a>00500          job_name = <span class="stringliteral">&quot;img_{0:03d}-*&quot;</span>.format(img_no)
<a name="l00501"></a>00501       <span class="keywordflow">else</span>:
<a name="l00502"></a>00502          job_name = <span class="stringliteral">&quot;img_{0:03d}-{1:1d}&quot;</span>.format(img_no, epoch_no)
<a name="l00503"></a>00503 
<a name="l00504"></a>00504       <span class="comment"># Parent class initialization      </span>
<a name="l00505"></a>00505       Job.__init__(self, master, job_name, dataset)
<a name="l00506"></a>00506 
<a name="l00507"></a>00507       <span class="comment"># Set job attributes</span>
<a name="l00508"></a>00508       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a90b1cef0904e8223e7048d0d08f9e290">_branch</a> = <span class="stringliteral">&quot;/&quot;</span>.join(branch_dirs)   <span class="comment"># branch (path) to the files of the job</span>
<a name="l00509"></a>00509       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#abae95fe16133990d0420ad019aa6b12b">_branch_dirs</a> = branch_dirs        <span class="comment"># list of directory names in the branch </span>
<a name="l00510"></a>00510       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#af6d50384ed6fb52a6a20f374aeaccafb">_branch_key</a> = tuple(branch_key)   <span class="comment"># tuple (branch_dirs, im_no, epoch)</span>
<a name="l00511"></a>00511       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a00c07a66378e5442cb2f89fb43f859ed">_img_no</a> = img_no                  <span class="comment"># image number associated with the job</span>
<a name="l00512"></a>00512       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#acd188b88fba6e6123fd3224271dcabee">_epoch</a> = epoch_no                 <span class="comment"># epoch index: only one value in this case   </span>
<a name="l00513"></a>00513       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#aef123ee2e27cdeb8541f94285fb39291">_img_path_dico</a> = img_path_dico    <span class="comment"># dictionary of file paths per file type</span>
<a name="l00514"></a>00514 
<a name="l00515"></a>00515    <span class="comment"># ~~~~~~~~~~~</span>
<a name="l00516"></a>00516    <span class="comment"># Properties </span>
<a name="l00517"></a>00517    <span class="comment"># ~~~~~~~~~~~</span>
<a name="l00518"></a>00518 
<a name="l00519"></a>00519    <span class="comment"># --- Getters</span>
<a name="l00520"></a>00520 
<a name="l00521"></a>00521    @property
<a name="l00522"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#abfc8cbe5847f019ce0637e00f6ca1696">00522</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#abfc8cbe5847f019ce0637e00f6ca1696">branch</a>(self):
<a name="l00523"></a>00523       <span class="stringliteral">&quot;&quot;&quot;! @return the branch (path from base directory) containing the image file of the job. &quot;&quot;&quot;</span>
<a name="l00524"></a>00524       <span class="keywordflow">return</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a90b1cef0904e8223e7048d0d08f9e290">_branch</a>
<a name="l00525"></a>00525 
<a name="l00526"></a>00526    @property
<a name="l00527"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a3006e79940168ea98ed37e250552568b">00527</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a3006e79940168ea98ed37e250552568b">img_no</a>(self):
<a name="l00528"></a>00528       <span class="stringliteral">&quot;&quot;&quot;! @return the image number associated with the job. &quot;&quot;&quot;</span>
<a name="l00529"></a>00529       <span class="keywordflow">return</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a00c07a66378e5442cb2f89fb43f859ed">_img_no</a> 
<a name="l00530"></a>00530 
<a name="l00531"></a>00531    @property
<a name="l00532"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a696eb6140a8ce9d7b68936fd0747c0b0">00532</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a696eb6140a8ce9d7b68936fd0747c0b0">epoch</a>(self):
<a name="l00533"></a>00533       <span class="stringliteral">&quot;&quot;&quot;! @return the epoch index associated with the job if any, None otherwise. &quot;&quot;&quot;</span>
<a name="l00534"></a>00534       <span class="keywordflow">return</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#acd188b88fba6e6123fd3224271dcabee">_epoch</a>
<a name="l00535"></a>00535 
<a name="l00536"></a>00536    @property
<a name="l00537"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a205ecee6cca125b66f68df2ac14cf639">00537</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a205ecee6cca125b66f68df2ac14cf639">epoch_nos</a>(self):
<a name="l00538"></a>00538       <span class="stringliteral">&quot;&quot;&quot;! @return the epoch (multiple exposure) indice associated with the job </span>
<a name="l00539"></a>00539 <span class="stringliteral">                   (only one in this class). &quot;&quot;&quot;</span>
<a name="l00540"></a>00540       <span class="keywordflow">return</span> [self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a696eb6140a8ce9d7b68936fd0747c0b0">epoch</a>]
<a name="l00541"></a>00541 
<a name="l00542"></a>00542    @property
<a name="l00543"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#afefbe83fffc173965e019d028a7c41c9">00543</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#afefbe83fffc173965e019d028a7c41c9">branch_dirs</a>(self):
<a name="l00544"></a>00544       <span class="stringliteral">&quot;&quot;&quot;! @return the list of directory names in the branch associated with the job. &quot;&quot;&quot;</span>
<a name="l00545"></a>00545       <span class="keywordflow">return</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#abae95fe16133990d0420ad019aa6b12b">_branch_dirs</a>
<a name="l00546"></a>00546 
<a name="l00547"></a>00547    @property
<a name="l00548"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#aae268723bb34a3f9bc4bf734168b31e7">00548</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#aae268723bb34a3f9bc4bf734168b31e7">branch_key</a>(self):
<a name="l00549"></a>00549       <span class="stringliteral">&quot;&quot;&quot;! @return a tuple (branch_dirs, im_no, epoch). &quot;&quot;&quot;</span>
<a name="l00550"></a>00550       <span class="keywordflow">return</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#af6d50384ed6fb52a6a20f374aeaccafb">_branch_key</a>
<a name="l00551"></a>00551 
<a name="l00552"></a>00552    @property
<a name="l00553"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a7ac0787900744d38f5c87d1e065711d7">00553</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a7ac0787900744d38f5c87d1e065711d7">img_path_dico</a>(self):
<a name="l00554"></a>00554       <span class="stringliteral">&quot;&quot;&quot;! @return the file path dictionary with the job. &quot;&quot;&quot;</span>
<a name="l00555"></a>00555       <span class="keywordflow">return</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#aef123ee2e27cdeb8541f94285fb39291">_img_path_dico</a>
<a name="l00556"></a>00556 
<a name="l00557"></a>00557    <span class="comment"># --- Setters</span>
<a name="l00558"></a>00558 
<a name="l00559"></a>00559    @branch.setter 
<a name="l00560"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#abfc8cbe5847f019ce0637e00f6ca1696">00560</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#abfc8cbe5847f019ce0637e00f6ca1696">branch</a>(self, branch):
<a name="l00561"></a>00561       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00562"></a>00562 <span class="stringliteral">         Specify the branch (path from base directory) containing the image file of the job.</span>
<a name="l00563"></a>00563 <span class="stringliteral">         @param branch the branch containing the image file of the job</span>
<a name="l00564"></a>00564 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00565"></a>00565       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a90b1cef0904e8223e7048d0d08f9e290">_branch</a> = branch
<a name="l00566"></a>00566 
<a name="l00567"></a>00567    @img_no.setter 
<a name="l00568"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a3006e79940168ea98ed37e250552568b">00568</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a3006e79940168ea98ed37e250552568b">img_no</a>(self, img_no):
<a name="l00569"></a>00569       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00570"></a>00570 <span class="stringliteral">         Specify the image number associated with the job.</span>
<a name="l00571"></a>00571 <span class="stringliteral">         @param img_no the image number associated with the job</span>
<a name="l00572"></a>00572 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00573"></a>00573       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a00c07a66378e5442cb2f89fb43f859ed">_img_no</a> = img_no
<a name="l00574"></a>00574 
<a name="l00575"></a>00575    @epoch.setter 
<a name="l00576"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a696eb6140a8ce9d7b68936fd0747c0b0">00576</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a696eb6140a8ce9d7b68936fd0747c0b0">epoch</a>(self, epoch):
<a name="l00577"></a>00577       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00578"></a>00578 <span class="stringliteral">         Specify the epoch (exposure) index associated with the job.</span>
<a name="l00579"></a>00579 <span class="stringliteral">         @param epoch the epoch (exposure) index associated with the job</span>
<a name="l00580"></a>00580 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00581"></a>00581       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#acd188b88fba6e6123fd3224271dcabee">_epoch</a> = epoch
<a name="l00582"></a>00582 
<a name="l00583"></a>00583    @branch_dirs.setter 
<a name="l00584"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#afefbe83fffc173965e019d028a7c41c9">00584</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#afefbe83fffc173965e019d028a7c41c9">branch_dirs</a>(self, branch_dirs):
<a name="l00585"></a>00585       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00586"></a>00586 <span class="stringliteral">         Specify the list of directory names in the branch associated with the job.</span>
<a name="l00587"></a>00587 <span class="stringliteral">         @param branch_dirs the list of directory names in the branch associated with the job</span>
<a name="l00588"></a>00588 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00589"></a>00589       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#abae95fe16133990d0420ad019aa6b12b">_branch_dirs</a> = branch_dirs
<a name="l00590"></a>00590 
<a name="l00591"></a>00591    @branch_key.setter 
<a name="l00592"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#aae268723bb34a3f9bc4bf734168b31e7">00592</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#aae268723bb34a3f9bc4bf734168b31e7">branch_key</a>(self, branch_key):
<a name="l00593"></a>00593       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00594"></a>00594 <span class="stringliteral">         Specify a key made of a tuple (branch_dirs, im_no, epoch).</span>
<a name="l00595"></a>00595 <span class="stringliteral">         @param branch_key a tuple (branch_dirs, im_no, epoch)</span>
<a name="l00596"></a>00596 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00597"></a>00597       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#af6d50384ed6fb52a6a20f374aeaccafb">_branch_key</a> = branch_key
<a name="l00598"></a>00598 
<a name="l00599"></a>00599    @img_path_dico.setter 
<a name="l00600"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a7ac0787900744d38f5c87d1e065711d7">00600</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a7ac0787900744d38f5c87d1e065711d7">img_path_dico</a>(self, img_path_dico):
<a name="l00601"></a>00601       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00602"></a>00602 <span class="stringliteral">         Specify the file path dictionary with the job.</span>
<a name="l00603"></a>00603 <span class="stringliteral">         @param img_path_dico the file path dictionary with the job</span>
<a name="l00604"></a>00604 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00605"></a>00605       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#aef123ee2e27cdeb8541f94285fb39291">_img_path_dico</a> = img_path_dico
<a name="l00606"></a>00606 
<a name="l00607"></a>00607 
<a name="l00608"></a>00608    <span class="comment"># ~~~~~~~~~~~~~~</span>
<a name="l00609"></a>00609    <span class="comment"># Public methods </span>
<a name="l00610"></a>00610    <span class="comment"># ~~~~~~~~~~~~~~</span>
<a name="l00611"></a>00611 
<a name="l00612"></a>00612    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00613"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#ad2f7947e5c4fa865de6fa465449e4b6e">00613</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#ad2f7947e5c4fa865de6fa465449e4b6e" title="Convenience method to find the catalog name matching an image name, for instance &amp;quot;starfield_imag...">get_catalog_from_image</a>(self, img_name, cat_extension=&quot;.txt&quot;):
<a name="l00614"></a>00614       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00615"></a>00615 <span class="stringliteral">         Convenience method to find the catalog name matching an image name, for instance</span>
<a name="l00616"></a>00616 <span class="stringliteral">         &quot;starfield_image&quot; -&gt; &quot;star_catalog&quot;, or  &quot;image.fits&quot; -&gt; &quot;galaxy_catalog&quot;  </span>
<a name="l00617"></a>00617 <span class="stringliteral">         @param img_name name or image file type of an image </span>
<a name="l00618"></a>00618 <span class="stringliteral">         @param cat_extension expected file extension for the catalog (default: .txt) </span>
<a name="l00619"></a>00619 <span class="stringliteral">         @return the corresponding catalog name</span>
<a name="l00620"></a>00620 <span class="stringliteral">         @see see get_file_types. __init__</span>
<a name="l00621"></a>00621 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00622"></a>00622       <span class="keywordflow">return</span> img_name.replace(<span class="stringliteral">&quot;.fits&quot;</span>, cat_extension)  
<a name="l00623"></a>00623 
<a name="l00624"></a>00624    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00625"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a73ae3498ac1116a98c5cf620888a5f0e">00625</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a73ae3498ac1116a98c5cf620888a5f0e" title="Convenience method to find the image matching a given catalog file type, for instance &amp;quot;galaxy_ca...">get_image_type_from_catalog</a>(self, cat_name):
<a name="l00626"></a>00626       <span class="stringliteral">&quot;&quot;&quot;!</span>
<a name="l00627"></a>00627 <span class="stringliteral">         Convenience method to find the image matching a given catalog file type, </span>
<a name="l00628"></a>00628 <span class="stringliteral">         for instance</span>
<a name="l00629"></a>00629 <span class="stringliteral">         &quot;galaxy_catalog.txt&quot; -&gt; &quot;image.fits&quot; or &quot;galaxy_catalog.fits&quot; -&gt; &quot;image.fits&quot;</span>
<a name="l00630"></a>00630 <span class="stringliteral">         @param cat_name name of an catalog type</span>
<a name="l00631"></a>00631 <span class="stringliteral">         @return the image name that corresponds to the catalog</span>
<a name="l00632"></a>00632 <span class="stringliteral"></span>
<a name="l00633"></a>00633 <span class="stringliteral">         @see see get_file_types. __init__</span>
<a name="l00634"></a>00634 <span class="stringliteral">      &quot;&quot;&quot;</span>  
<a name="l00635"></a>00635 
<a name="l00636"></a>00636       <span class="keywordflow">return</span> cat_name.replace(<span class="stringliteral">&quot;.txt&quot;</span>, <span class="stringliteral">&quot;.fits&quot;</span>)  
<a name="l00637"></a>00637 
<a name="l00638"></a>00638 
<a name="l00639"></a>00639    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00640"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a2abce637daa914bc390b3a6f21658535">00640</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a2abce637daa914bc390b3a6f21658535" title="Return the list of object types managed by the job:">get_file_types</a>(self):
<a name="l00641"></a>00641       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00642"></a>00642 <span class="stringliteral">         Return the list of object types managed by the job:</span>
<a name="l00643"></a>00643 <span class="stringliteral">         @see list in comments for __init__</span>
<a name="l00644"></a>00644 <span class="stringliteral">         @see get_file_types()</span>
<a name="l00645"></a>00645 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00646"></a>00646       path_dico = self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a7ac0787900744d38f5c87d1e065711d7">img_path_dico</a>.get(self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#aae268723bb34a3f9bc4bf734168b31e7">branch_key</a>, <span class="keywordtype">None</span>)
<a name="l00647"></a>00647       <span class="keywordflow">if</span> <span class="keywordflow">not</span> path_dico <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00648"></a>00648          <span class="keywordflow">return</span> path_dico.keys()
<a name="l00649"></a>00649       <span class="keywordflow">else</span>:
<a name="l00650"></a>00650          <span class="keywordflow">return</span> []
<a name="l00651"></a>00651 
<a name="l00652"></a>00652    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00653"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a2237d5a8cc51f24776a8aa076c140f9c">00653</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a2237d5a8cc51f24776a8aa076c140f9c" title="Return the list of image file types managed by the job:">get_image_file_types</a>(self, process):
<a name="l00654"></a>00654       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00655"></a>00655 <span class="stringliteral">         Return the list of image file types managed by the job:</span>
<a name="l00656"></a>00656 <span class="stringliteral">         @param process master or worker process</span>
<a name="l00657"></a>00657 <span class="stringliteral">         @see list in comments for __init__</span>
<a name="l00658"></a>00658 <span class="stringliteral">         @see get_file_types(), get_image_file_types</span>
<a name="l00659"></a>00659 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00660"></a>00660 
<a name="l00661"></a>00661       file_types = []
<a name="l00662"></a>00662       path_dico = self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a7ac0787900744d38f5c87d1e065711d7">img_path_dico</a>.get(self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#aae268723bb34a3f9bc4bf734168b31e7">branch_key</a>, <span class="keywordtype">None</span>)
<a name="l00663"></a>00663       <span class="keywordflow">if</span> <span class="keywordflow">not</span> path_dico <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00664"></a>00664          file_types = [p <span class="keywordflow">for</span> p <span class="keywordflow">in</span> path_dico.keys() <span class="keywordflow">if</span> self.dataset.is_image(process, p)] 
<a name="l00665"></a>00665       <span class="keywordflow">return</span> file_types
<a name="l00666"></a>00666 
<a name="l00667"></a>00667    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00668"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a6f1db23c7649c6249bbe036ca1b529ec">00668</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a6f1db23c7649c6249bbe036ca1b529ec" title="Return the list of star image file types managed by the job:">get_star_image_file_types</a>(self, process):
<a name="l00669"></a>00669       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00670"></a>00670 <span class="stringliteral">         Return the list of star image file types managed by the job:</span>
<a name="l00671"></a>00671 <span class="stringliteral">         @param process master or worker process</span>
<a name="l00672"></a>00672 <span class="stringliteral">         @see list in comments for __init__</span>
<a name="l00673"></a>00673 <span class="stringliteral">         @see get_file_types(), get_image_file_types(), get_galaxy_image_file_types()</span>
<a name="l00674"></a>00674 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00675"></a>00675 
<a name="l00676"></a>00676       file_types = []
<a name="l00677"></a>00677       path_dico = self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a7ac0787900744d38f5c87d1e065711d7">img_path_dico</a>.get(self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#aae268723bb34a3f9bc4bf734168b31e7">branch_key</a>, <span class="keywordtype">None</span>)
<a name="l00678"></a>00678       <span class="keywordflow">if</span> <span class="keywordflow">not</span> path_dico <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00679"></a>00679          file_types = [p <span class="keywordflow">for</span> p <span class="keywordflow">in</span> path_dico.keys() <span class="keywordflow">if</span> self.dataset.is_star_image(process, p)] 
<a name="l00680"></a>00680       <span class="keywordflow">return</span> file_types
<a name="l00681"></a>00681 
<a name="l00682"></a>00682    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00683"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a41f9fb70973c09c3c40149d4116690d0">00683</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a41f9fb70973c09c3c40149d4116690d0" title="Return the list of galaxy image file types managed by the job:">get_galaxy_image_file_types</a>(self, process):
<a name="l00684"></a>00684       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00685"></a>00685 <span class="stringliteral">         Return the list of galaxy image file types managed by the job:</span>
<a name="l00686"></a>00686 <span class="stringliteral">         @param process master or worker process</span>
<a name="l00687"></a>00687 <span class="stringliteral">         @see list in comments for __init__</span>
<a name="l00688"></a>00688 <span class="stringliteral">         @see get_file_types(), get_image_file_types(), get_star_image_file_types()</span>
<a name="l00689"></a>00689 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00690"></a>00690 
<a name="l00691"></a>00691       file_types = []
<a name="l00692"></a>00692       path_dico = self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a7ac0787900744d38f5c87d1e065711d7">img_path_dico</a>.get(self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#aae268723bb34a3f9bc4bf734168b31e7">branch_key</a>, <span class="keywordtype">None</span>)
<a name="l00693"></a>00693       <span class="keywordflow">if</span> <span class="keywordflow">not</span> path_dico <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00694"></a>00694          file_types = [p <span class="keywordflow">for</span> p <span class="keywordflow">in</span> path_dico.keys() <span class="keywordflow">if</span> self.dataset.is_galaxy_image(process, p)] 
<a name="l00695"></a>00695       <span class="keywordflow">return</span> file_types
<a name="l00696"></a>00696 
<a name="l00697"></a>00697    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00698"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a4c599bd54f9af0849daa43182397289d">00698</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a4c599bd54f9af0849daa43182397289d" title="Return the list of catalog file types managed by the job:">get_catalog_file_types</a>(self, process):
<a name="l00699"></a>00699       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00700"></a>00700 <span class="stringliteral">         Return the list of catalog file types managed by the job:</span>
<a name="l00701"></a>00701 <span class="stringliteral">         @param process master or worker process</span>
<a name="l00702"></a>00702 <span class="stringliteral">         @see list in comments for __init__</span>
<a name="l00703"></a>00703 <span class="stringliteral">         @see get_file_types(), get_image_file_types()</span>
<a name="l00704"></a>00704 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00705"></a>00705 
<a name="l00706"></a>00706       file_types = []
<a name="l00707"></a>00707       path_dico = self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a7ac0787900744d38f5c87d1e065711d7">img_path_dico</a>.get(self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#aae268723bb34a3f9bc4bf734168b31e7">branch_key</a>, <span class="keywordtype">None</span>)
<a name="l00708"></a>00708       <span class="keywordflow">if</span> <span class="keywordflow">not</span> path_dico <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00709"></a>00709          file_types = [p <span class="keywordflow">for</span> p <span class="keywordflow">in</span> path_dico.keys() <span class="keywordflow">if</span> self.dataset.is_catalog(process, p)] 
<a name="l00710"></a>00710       <span class="keywordflow">return</span> file_types
<a name="l00711"></a>00711 
<a name="l00712"></a>00712    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00713"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a9545a7af5d631db3bd34c6f83f5598af">00713</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a9545a7af5d631db3bd34c6f83f5598af" title="Return the list of star catalog file types managed by the job:">get_star_catalog_file_types</a>(self, process):
<a name="l00714"></a>00714       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00715"></a>00715 <span class="stringliteral">         Return the list of star catalog file types managed by the job:</span>
<a name="l00716"></a>00716 <span class="stringliteral">         @param process master or worker process</span>
<a name="l00717"></a>00717 <span class="stringliteral">         @see list in comments for __init__</span>
<a name="l00718"></a>00718 <span class="stringliteral">         @see get_file_types(), get_image_file_types(), get_galaxy_catalog_file_types()</span>
<a name="l00719"></a>00719 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00720"></a>00720 
<a name="l00721"></a>00721       file_types = []
<a name="l00722"></a>00722       path_dico = self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a7ac0787900744d38f5c87d1e065711d7">img_path_dico</a>.get(self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#aae268723bb34a3f9bc4bf734168b31e7">branch_key</a>, <span class="keywordtype">None</span>)
<a name="l00723"></a>00723       <span class="keywordflow">if</span> <span class="keywordflow">not</span> path_dico <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00724"></a>00724          file_types = [p <span class="keywordflow">for</span> p <span class="keywordflow">in</span> path_dico.keys() <span class="keywordflow">if</span> self.dataset.is_star_catalog(process, p)] 
<a name="l00725"></a>00725       <span class="keywordflow">return</span> file_types
<a name="l00726"></a>00726 
<a name="l00727"></a>00727    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00728"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#add1b0dd6c5574824cc35ac7ca98b46b2">00728</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#add1b0dd6c5574824cc35ac7ca98b46b2" title="Return the list of galaxy catalog file types managed by the job:">get_galaxy_catalog_file_types</a>(self, process):
<a name="l00729"></a>00729       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00730"></a>00730 <span class="stringliteral">         Return the list of galaxy catalog file types managed by the job:</span>
<a name="l00731"></a>00731 <span class="stringliteral">         @param process master or worker process</span>
<a name="l00732"></a>00732 <span class="stringliteral">         @see list in comments for __init__</span>
<a name="l00733"></a>00733 <span class="stringliteral">         @see get_file_types(), get_image_file_types(), get_star_catalog_file_types()</span>
<a name="l00734"></a>00734 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00735"></a>00735 
<a name="l00736"></a>00736       file_types = []
<a name="l00737"></a>00737       path_dico = self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a7ac0787900744d38f5c87d1e065711d7">img_path_dico</a>.get(self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#aae268723bb34a3f9bc4bf734168b31e7">branch_key</a>, <span class="keywordtype">None</span>)
<a name="l00738"></a>00738       <span class="keywordflow">if</span> <span class="keywordflow">not</span> path_dico <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00739"></a>00739          file_types = [p <span class="keywordflow">for</span> p <span class="keywordflow">in</span> path_dico.keys() <span class="keywordflow">if</span> self.dataset.is_galaxy_catalog(process, p)] 
<a name="l00740"></a>00740       <span class="keywordflow">return</span> file_types
<a name="l00741"></a>00741 
<a name="l00742"></a>00742    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00743"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a9064f3774ab97006b6fc3a2355d4aabe">00743</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a9064f3774ab97006b6fc3a2355d4aabe" title="Return the list of object paths (like associated with the job.">get_file_paths</a>(self, epoch=None):
<a name="l00744"></a>00744       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00745"></a>00745 <span class="stringliteral">         Return the list of object paths (like associated with the job</span>
<a name="l00746"></a>00746 <span class="stringliteral">         @param epoch optional epoch index: if None, the epoch index is ignored</span>
<a name="l00747"></a>00747 <span class="stringliteral">         @return list of file paths associated with the job, possibly matching an epoch index</span>
<a name="l00748"></a>00748 <span class="stringliteral">         @see get_file_types()</span>
<a name="l00749"></a>00749 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00750"></a>00750 
<a name="l00751"></a>00751       path_dico = self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a7ac0787900744d38f5c87d1e065711d7">img_path_dico</a>.get(self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#aae268723bb34a3f9bc4bf734168b31e7">branch_key</a>, <span class="keywordtype">None</span>)
<a name="l00752"></a>00752       <span class="keywordflow">if</span> <span class="keywordflow">not</span> path_dico <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00753"></a>00753          <span class="keywordflow">if</span> epoch <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00754"></a>00754             <span class="keywordflow">return</span> path_dico.values()
<a name="l00755"></a>00755          <span class="keywordflow">else</span>:
<a name="l00756"></a>00756             <span class="keywordflow">return</span> [ p <span class="keywordflow">for</span> p <span class="keywordflow">in</span> path_dico.values()\
<a name="l00757"></a>00757                              <span class="keywordflow">if</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a0f93995aec6e7850403a4ea1ecd69c29" title="Return the epoch index of a file with a given absolute file path.">get_file_epoch_from_path</a>(p) <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> \
<a name="l00758"></a>00758                                 self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a0f93995aec6e7850403a4ea1ecd69c29" title="Return the epoch index of a file with a given absolute file path.">get_file_epoch_from_path</a>(p) == epoch ]
<a name="l00759"></a>00759       <span class="keywordflow">else</span>:
<a name="l00760"></a>00760          <span class="keywordflow">return</span> []
<a name="l00761"></a>00761 
<a name="l00762"></a>00762    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00763"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a35048b431e5403008cb45d060529ddbe">00763</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a35048b431e5403008cb45d060529ddbe" title="Return the path of a given file type.">get_file_path</a>(self, file_type, epoch=None):
<a name="l00764"></a>00764       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00765"></a>00765 <span class="stringliteral">         Return the path of a given file type. For instance, get_file_path(&quot;star_catalog.txt&quot;)</span>
<a name="l00766"></a>00766 <span class="stringliteral">         @param file_type type of the file (like &quot;star_catalog.txt&quot;)</span>
<a name="l00767"></a>00767 <span class="stringliteral">         @param epoch epoch index or None for any epoch</span>
<a name="l00768"></a>00768 <span class="stringliteral">         @return path of the file identified by the file_type, None otherwise</span>
<a name="l00769"></a>00769 <span class="stringliteral">         @see get_file_types()</span>
<a name="l00770"></a>00770 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00771"></a>00771 
<a name="l00772"></a>00772       path_list = [ p <span class="keywordflow">for</span> p <span class="keywordflow">in</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a9064f3774ab97006b6fc3a2355d4aabe" title="Return the list of object paths (like associated with the job.">get_file_paths</a>(epoch=epoch)\
<a name="l00773"></a>00773                             <span class="keywordflow">if</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a6007cfb9ca88d383a530fe25bb031405" title="Return the file type of a file with a given absolute file path.">get_file_type_from_path</a>(p) == file_type]
<a name="l00774"></a>00774 
<a name="l00775"></a>00775       <span class="keywordflow">if</span> len(path_list) &gt; 0:
<a name="l00776"></a>00776          <span class="keywordflow">return</span> path_list[0]
<a name="l00777"></a>00777       <span class="keywordflow">else</span>:
<a name="l00778"></a>00778          <span class="keywordflow">return</span> <span class="keywordtype">None</span>   
<a name="l00779"></a>00779 
<a name="l00780"></a>00780 
<a name="l00781"></a>00781    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00782"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#ac3c4f9679a126c785863ac083f4e49c8">00782</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#ac3c4f9679a126c785863ac083f4e49c8" title="Return the list of file components of a file absolute path: file type, image number and possibly epoc...">get_file_components_from_path</a>(self, file_path):
<a name="l00783"></a>00783       <span class="stringliteral">&quot;&quot;&quot;!</span>
<a name="l00784"></a>00784 <span class="stringliteral">         Return the list of file components of a file absolute path: file type, image number </span>
<a name="l00785"></a>00785 <span class="stringliteral">         and possibly epoch index. </span>
<a name="l00786"></a>00786 <span class="stringliteral">         @code</span>
<a name="l00787"></a>00787 <span class="stringliteral">         - If the file is of the form /&lt;path&gt;/&lt;file_type&gt;-&lt;image_no&gt;-&lt;epoch&gt;.&lt;extension&gt; a list</span>
<a name="l00788"></a>00788 <span class="stringliteral">           [file_type, img_no, epoch] is returned</span>
<a name="l00789"></a>00789 <span class="stringliteral">         - If the file is of the form /&lt;path&gt;/&lt;file_type&gt;-&lt;image_no&gt;.&lt;extension&gt;, a list  </span>
<a name="l00790"></a>00790 <span class="stringliteral">           [file_type, img_no, None] is returned</span>
<a name="l00791"></a>00791 <span class="stringliteral">         @endcode </span>
<a name="l00792"></a>00792 <span class="stringliteral">         @param file_path absolute file path of a file (image, catalog, etc.) </span>
<a name="l00793"></a>00793 <span class="stringliteral">         @code</span>
<a name="l00794"></a>00794 <span class="stringliteral">           Examples:</span>
<a name="l00795"></a>00795 <span class="stringliteral">           - get_file_compoments_from_path(&quot;starfield-000.1.fits&quot;) =&gt; [starfield_image.fits, 0, 1] </span>
<a name="l00796"></a>00796 <span class="stringliteral">           - get_file_compoments_from_path(&quot;star_catalog-000.txt&quot;) =&gt; [star_catalog.txt, 0, None] </span>
<a name="l00797"></a>00797 <span class="stringliteral">         @endcode</span>
<a name="l00798"></a>00798 <span class="stringliteral">         @return </span>
<a name="l00799"></a>00799 <span class="stringliteral">         @see get_file_type_from_path(), get_file_epoch_from_path()</span>
<a name="l00800"></a>00800 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00801"></a>00801 
<a name="l00802"></a>00802       components = []      
<a name="l00803"></a>00803       filedir, filename = os.path.split(file_path)
<a name="l00804"></a>00804       filemain, fileext = os.path.splitext(filename)      
<a name="l00805"></a>00805    
<a name="l00806"></a>00806       regex_dash = re.compile(<span class="stringliteral">&quot;(.+)\-(.+)\-(.+)\.&quot;</span>)
<a name="l00807"></a>00807       result = regex_dash.search(filename)
<a name="l00808"></a>00808       <span class="keywordflow">if</span> <span class="keywordflow">not</span> result <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00809"></a>00809          <span class="keywordflow">return</span> [result.group(1)+fileext, int(result.group(2)), int(result.group(3))]
<a name="l00810"></a>00810       <span class="keywordflow">else</span>:
<a name="l00811"></a>00811          regex_dot = re.compile(<span class="stringliteral">&quot;(.+)\-(.+)\.&quot;</span>)
<a name="l00812"></a>00812          result = regex_dot.search(filename)
<a name="l00813"></a>00813          <span class="keywordflow">return</span> [result.group(1)+fileext, int(result.group(2)), <span class="keywordtype">None</span>]
<a name="l00814"></a>00814 
<a name="l00815"></a>00815                
<a name="l00816"></a>00816    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00817"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a6007cfb9ca88d383a530fe25bb031405">00817</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a6007cfb9ca88d383a530fe25bb031405" title="Return the file type of a file with a given absolute file path.">get_file_type_from_path</a>(self, file_path):
<a name="l00818"></a>00818       <span class="stringliteral">&quot;&quot;&quot;!</span>
<a name="l00819"></a>00819 <span class="stringliteral">         Return the file type of a file with a given absolute file path </span>
<a name="l00820"></a>00820 <span class="stringliteral">         @param file_path absolute file path of a file (image, catalog, etc.)</span>
<a name="l00821"></a>00821 <span class="stringliteral">         @return the file type of a file (like star_catalog.fits)</span>
<a name="l00822"></a>00822 <span class="stringliteral">         @note: None is returned if no file type could be found</span>
<a name="l00823"></a>00823 <span class="stringliteral">         @see get_file_components_from_path()</span>
<a name="l00824"></a>00824 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00825"></a>00825       components = self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#ac3c4f9679a126c785863ac083f4e49c8" title="Return the list of file components of a file absolute path: file type, image number and possibly epoc...">get_file_components_from_path</a>(file_path)
<a name="l00826"></a>00826 
<a name="l00827"></a>00827       <span class="keywordflow">if</span> len(components) &gt; 0:
<a name="l00828"></a>00828          <span class="keywordflow">return</span> components[0]      
<a name="l00829"></a>00829       <span class="keywordflow">else</span>:
<a name="l00830"></a>00830          <span class="keywordflow">return</span> <span class="keywordtype">None</span>      
<a name="l00831"></a>00831 
<a name="l00832"></a>00832    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00833"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#abbc5bbb94dc629048c9c6b534dc8ac5e">00833</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#abbc5bbb94dc629048c9c6b534dc8ac5e" title="Return the image number of a file with a given absolute file path.">get_file_image_no_from_path</a>(self, file_path):
<a name="l00834"></a>00834       <span class="stringliteral">&quot;&quot;&quot;!</span>
<a name="l00835"></a>00835 <span class="stringliteral">         Return the image number of a file with a given absolute file path </span>
<a name="l00836"></a>00836 <span class="stringliteral">         @param file_path absolute file path of a file (image, catalog, etc.)</span>
<a name="l00837"></a>00837 <span class="stringliteral">         @return the file image number</span>
<a name="l00838"></a>00838 <span class="stringliteral">         @note: None is returned if no file type could be found</span>
<a name="l00839"></a>00839 <span class="stringliteral">         @see get_file_components_from_path()</span>
<a name="l00840"></a>00840 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00841"></a>00841       components = self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#ac3c4f9679a126c785863ac083f4e49c8" title="Return the list of file components of a file absolute path: file type, image number and possibly epoc...">get_file_components_from_path</a>(file_path)
<a name="l00842"></a>00842       <span class="keywordflow">if</span> len(components) &gt; 1:
<a name="l00843"></a>00843          <span class="keywordflow">return</span> components[1]      
<a name="l00844"></a>00844       <span class="keywordflow">else</span>:
<a name="l00845"></a>00845          <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00846"></a>00846 
<a name="l00847"></a>00847    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00848"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a0f93995aec6e7850403a4ea1ecd69c29">00848</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a0f93995aec6e7850403a4ea1ecd69c29" title="Return the epoch index of a file with a given absolute file path.">get_file_epoch_from_path</a>(self, file_path):
<a name="l00849"></a>00849       <span class="stringliteral">&quot;&quot;&quot;!</span>
<a name="l00850"></a>00850 <span class="stringliteral">         Return the epoch index of a file with a given absolute file path </span>
<a name="l00851"></a>00851 <span class="stringliteral">         @param file_path absolute file path of a file (image, catalog, etc.)</span>
<a name="l00852"></a>00852 <span class="stringliteral">         @return the file epoch index</span>
<a name="l00853"></a>00853 <span class="stringliteral">         @note: None is returned if no file type could be found</span>
<a name="l00854"></a>00854 <span class="stringliteral">         @see get_file_components_from_path()</span>
<a name="l00855"></a>00855 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00856"></a>00856       components = self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#ac3c4f9679a126c785863ac083f4e49c8" title="Return the list of file components of a file absolute path: file type, image number and possibly epoc...">get_file_components_from_path</a>(file_path)
<a name="l00857"></a>00857       <span class="keywordflow">if</span> len(components) &gt; 2:
<a name="l00858"></a>00858          <span class="keywordflow">return</span> components[2]      
<a name="l00859"></a>00859       <span class="keywordflow">else</span>:
<a name="l00860"></a>00860          <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00861"></a>00861 
<a name="l00862"></a>00862    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00863"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a859585cf1f72689aa073e6bed6a691cc">00863</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#a859585cf1f72689aa073e6bed6a691cc" title="Convenience method to return the jobs&amp;#39;s branch tree structure, for example &amp;quot;control/space/co...">get_branch_tree</a>(self):
<a name="l00864"></a>00864       <span class="stringliteral">&quot;&quot;&quot;!</span>
<a name="l00865"></a>00865 <span class="stringliteral">         Convenience method to return the jobs&#39;s branch tree structure, for example</span>
<a name="l00866"></a>00866 <span class="stringliteral">         &quot;control/space/constant&quot;.</span>
<a name="l00867"></a>00867 <span class="stringliteral">         @return branch directory tree for this job  </span>
<a name="l00868"></a>00868 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00869"></a>00869       <span class="keywordflow">return</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html#abfc8cbe5847f019ce0637e00f6ca1696">branch</a>
<a name="l00870"></a>00870 
<a name="l00871"></a>00871 
<a name="l00872"></a>00872 
<a name="l00873"></a>00873 <span class="comment"># -------------------------------------------------------------------------------------------------</span>
<a name="l00874"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobResult.html">00874</a> <span class="keyword">class </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobResult.html" title="Represents the result of a job.">MpfxJobResult</a>(<a class="code" href="classJobResult.html">JobResult</a>):      
<a name="l00875"></a>00875 
<a name="l00876"></a>00876    <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00877"></a>00877 <span class="stringliteral">       Represents the result of a job.</span>
<a name="l00878"></a>00878 <span class="stringliteral">   &quot;&quot;&quot;</span>
<a name="l00879"></a>00879 
<a name="l00880"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobResult.html#a0a7f46403e0620d5b79225a5a6f47f18">00880</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobResult.html#a0a7f46403e0620d5b79225a5a6f47f18" title="Construct a MpfxJobResult job result object.">__init__</a>(self, worker, job, result):   
<a name="l00881"></a>00881       <span class="stringliteral">&quot;&quot;&quot;! Construct a MpfxJobResult job result object &quot;&quot;&quot;</span>
<a name="l00882"></a>00882       JobResult.__init__(self, worker, job, result)
<a name="l00883"></a>00883 
<a name="l00884"></a>00884 
<a name="l00885"></a>00885 
<a name="l00886"></a>00886 
<a name="l00887"></a>00887 <span class="comment"># --------------------------------------------------------------------------------------------------</span>
<a name="l00888"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html">00888</a> <span class="keyword">class </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html" title="Extension of MpfxJobProcessor: submit jobs and process associated job results, taking care of multiep...">MpfxMultiEpochJobProcessor</a>(<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJobProcessor.html" title="Job processor: submit jobs and process associated job results.">MpfxJobProcessor</a>):
<a name="l00889"></a>00889    
<a name="l00890"></a>00890    <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00891"></a>00891 <span class="stringliteral">      Extension of MpfxJobProcessor: submit jobs and process associated job results, taking care</span>
<a name="l00892"></a>00892 <span class="stringliteral">      of multiepoch (multiple exposure) images and related catalogs.      </span>
<a name="l00893"></a>00893 <span class="stringliteral">      Based on mpf.MpfxJobProcessor.   </span>
<a name="l00894"></a>00894 <span class="stringliteral">   &quot;&quot;&quot;</span>
<a name="l00895"></a>00895 
<a name="l00896"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html#aa037902397b61bc6c222d5d758d0a183">00896</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html#aa037902397b61bc6c222d5d758d0a183">__init__</a>(self, master):
<a name="l00897"></a>00897       <span class="stringliteral">&quot;&quot;&quot; MpfxMultiEpochJobProcessorProcessor default constuctor &quot;&quot;&quot;</span>
<a name="l00898"></a>00898 
<a name="l00899"></a>00899       MpfxJobProcessor.__init__(self, master)
<a name="l00900"></a>00900 
<a name="l00901"></a>00901 
<a name="l00902"></a>00902    <span class="comment"># ~~~~~~~~~~~~~~~</span>
<a name="l00903"></a>00903    <span class="comment"># Public methods </span>
<a name="l00904"></a>00904    <span class="comment"># ~~~~~~~~~~~~~~~</span>
<a name="l00905"></a>00905 
<a name="l00906"></a>00906    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00907"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html#ad7d93092eafdaa92cc8f17535f6649bf">00907</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html#ad7d93092eafdaa92cc8f17535f6649bf" title="Create a Dataset object that represent the data source for images and catalogs.">create_dataset</a>(self, master, dataset_name, dataset_type, dataset_base_dir, 
<a name="l00908"></a>00908                                     dataset_dir_list, dataset_recurse_dir):
<a name="l00909"></a>00909       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00910"></a>00910 <span class="stringliteral">         Create a Dataset object that represent the data source for images and catalogs.</span>
<a name="l00911"></a>00911 <span class="stringliteral">         @param master master process instance</span>
<a name="l00912"></a>00912 <span class="stringliteral">         @param dataset_name dataset name</span>
<a name="l00913"></a>00913 <span class="stringliteral">         @param dataset_type prefix of a Dataset class, assumed to be of the form </span>
<a name="l00914"></a>00914 <span class="stringliteral">                @code &lt;dataset_type&gt;Dataset @endcode, like @c MpfxDataset</span>
<a name="l00915"></a>00915 <span class="stringliteral">         @param dataset_base_dir dataset base directory</span>
<a name="l00916"></a>00916 <span class="stringliteral">         @param dataset_dir_list dataset list of directories to search for input files</span>
<a name="l00917"></a>00917 <span class="stringliteral">         @param dataset_recurse_dir true for a recursive input file search, false otherwise</span>
<a name="l00918"></a>00918 <span class="stringliteral">         @return the Dataset instance, None in case of error </span>
<a name="l00919"></a>00919 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00920"></a>00920 
<a name="l00921"></a>00921       <span class="keywordflow">return</span> MpfxMultiEpochDataset(master, dataset_name, dataset_base_dir, 
<a name="l00922"></a>00922                                            dataset_dir_list, dataset_recurse_dir) 
<a name="l00923"></a>00923 
<a name="l00924"></a>00924    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00925"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html#ae8c08640bf7bd31b3ad3c1f5754d6759">00925</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html#ae8c08640bf7bd31b3ad3c1f5754d6759" title="Locate all objects to process and create the corresponding jobs.">create_jobs</a>(self, master):
<a name="l00926"></a>00926       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00927"></a>00927 <span class="stringliteral">         Locate all objects to process and create the corresponding jobs. </span>
<a name="l00928"></a>00928 <span class="stringliteral">         @param master Master object instance</span>
<a name="l00929"></a>00929 <span class="stringliteral">         @return the list of created jobs </span>
<a name="l00930"></a>00930 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00931"></a>00931 
<a name="l00932"></a>00932       <span class="keywordflow">return</span> MpfxJobProcessor.create_jobs(self, master)
<a name="l00933"></a>00933 
<a name="l00934"></a>00934    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00935"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html#a10adb8539201b376d76af5225c12ce13">00935</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html#a10adb8539201b376d76af5225c12ce13" title="Factory method for creating a Job object.">create_job</a>(self, master, dataset, *args):
<a name="l00936"></a>00936       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00937"></a>00937 <span class="stringliteral">         Factory method for creating a Job object.</span>
<a name="l00938"></a>00938 <span class="stringliteral">         Each subclass can define a job class derived from mpf.Job and instanciate it here.</span>
<a name="l00939"></a>00939 <span class="stringliteral">         @param master master process instance</span>
<a name="l00940"></a>00940 <span class="stringliteral">         @param dataset data source used to create the job</span>
<a name="l00941"></a>00941 <span class="stringliteral">         @param args a list of arguments chosen by the caller and whose nature depends on the </span>
<a name="l00942"></a>00942 <span class="stringliteral">                data necessary to process the job</span>
<a name="l00943"></a>00943 <span class="stringliteral">         @return a new MpfxJob job object</span>
<a name="l00944"></a>00944 <span class="stringliteral">         @see Job, MpfxJob</span>
<a name="l00945"></a>00945 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00946"></a>00946 
<a name="l00947"></a>00947       <span class="comment"># --- Create a MpfxMultiEpochJob instance, based on parent class mpfx.MpfxJob</span>
<a name="l00948"></a>00948       <span class="keywordflow">return</span> MpfxMultiEpochJob(master, dataset, *args)  
<a name="l00949"></a>00949 
<a name="l00950"></a>00950    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00951"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html#af936712300b4059a0bf5ecb41fae40b1">00951</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html#af936712300b4059a0bf5ecb41fae40b1" title="Add a job result to the list of job results.">record_job_result</a>(self, job_result, master):
<a name="l00952"></a>00952       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00953"></a>00953 <span class="stringliteral">         Add a job result to the list of job results. This method is invoked by the Master. </span>
<a name="l00954"></a>00954 <span class="stringliteral">         @param master instance of the Master</span>
<a name="l00955"></a>00955 <span class="stringliteral">         @param job_result object of class JobResult containing the data of the processed job  </span>
<a name="l00956"></a>00956 <span class="stringliteral">         @see Job, JobResult       </span>
<a name="l00957"></a>00957 <span class="stringliteral">         @note individual epochs are not recorded, unlike for mono-epoch jobs</span>
<a name="l00958"></a>00958 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00959"></a>00959 
<a name="l00960"></a>00960       branch = job_result.job.branch
<a name="l00961"></a>00961       img_no = job_result.job.img_no
<a name="l00962"></a>00962 
<a name="l00963"></a>00963       result_dico = self.job_result_dico
<a name="l00964"></a>00964       <span class="keywordflow">for</span> branch_dir <span class="keywordflow">in</span> job_result.job.branch_dirs:
<a name="l00965"></a>00965          <span class="keywordflow">if</span> <span class="keywordflow">not</span> branch_dir <span class="keywordflow">in</span> result_dico:
<a name="l00966"></a>00966             result_dico[branch_dir] = {}
<a name="l00967"></a>00967          result_dico = result_dico[branch_dir] 
<a name="l00968"></a>00968 
<a name="l00969"></a>00969       <span class="keywordflow">if</span> <span class="keywordflow">not</span> img_no <span class="keywordflow">in</span> result_dico: 
<a name="l00970"></a>00970          result_dico[img_no] = {}
<a name="l00971"></a>00971 
<a name="l00972"></a>00972       <span class="comment"># --- Record job result with the relevant branch tree structure   </span>
<a name="l00973"></a>00973       result_dico[img_no] = job_result
<a name="l00974"></a>00974 
<a name="l00975"></a>00975    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00976"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html#a447c59d052fc60df4bedc9e0fe589180">00976</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html#a447c59d052fc60df4bedc9e0fe589180" title="Process a job and return the corresponding results to the Master (here sample data).">process_job</a>(self, job, worker):
<a name="l00977"></a>00977       <span class="stringliteral">&quot;&quot;&quot;!</span>
<a name="l00978"></a>00978 <span class="stringliteral">         Process a job and return the corresponding results to the Master (here sample data). </span>
<a name="l00979"></a>00979 <span class="stringliteral"></span>
<a name="l00980"></a>00980 <span class="stringliteral">         @param job an object of class Job to process</span>
<a name="l00981"></a>00981 <span class="stringliteral">         @param worker instance of the worker process</span>
<a name="l00982"></a>00982 <span class="stringliteral">         @return an object of class JobResult containing the data of the processed job</span>
<a name="l00983"></a>00983 <span class="stringliteral">         @note this method should be overridden in a subclass of mpf </span>
<a name="l00984"></a>00984 <span class="stringliteral">         @see preprocess_job, postprocess_job, Job, JobResult</span>
<a name="l00985"></a>00985 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00986"></a>00986 
<a name="l00987"></a>00987       <span class="keywordflow">if</span> worker.logging_enabled():
<a name="l00988"></a>00988          worker.logger.log_info_p(<span class="stringliteral">&quot;{0} - job {1} - File types included: {2}&quot;</span>.format(
<a name="l00989"></a>00989                                                               worker, job, job.get_file_types()))
<a name="l00990"></a>00990 
<a name="l00991"></a>00991       data_dico = {<span class="stringliteral">&quot;result&quot;</span>: <span class="stringliteral">&quot;result from MpfxMultiEpochJob: {0}&quot;</span>.format(job.name)}    <span class="comment"># sample result data</span>
<a name="l00992"></a>00992 
<a name="l00993"></a>00993       <span class="keywordflow">return</span> MpfxMultiEpochJobResult(worker, job, data_dico)  <span class="comment"># store the job results</span>
<a name="l00994"></a>00994 
<a name="l00995"></a>00995    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00996"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html#a636498654d19aacbc3b71f320ce4cc94">00996</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html#a636498654d19aacbc3b71f320ce4cc94" title="This method is called by the Master once all the jobs have been processed.">all_jobs_processed</a>(self, master):
<a name="l00997"></a>00997       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00998"></a>00998 <span class="stringliteral">         This method is called by the Master once all the jobs have been processed. </span>
<a name="l00999"></a>00999 <span class="stringliteral">         @param master instance of the Master</span>
<a name="l01000"></a>01000 <span class="stringliteral">         @note Job results can be selectively obtained by calling the get_job_results() methods,</span>
<a name="l01001"></a>01001 <span class="stringliteral">               specifying the relevant query criterion: branch, observation type, data type, image </span>
<a name="l01002"></a>01002 <span class="stringliteral">         @note the entire list of Job results can aldo be obtained with by calling </span>
<a name="l01003"></a>01003 <span class="stringliteral">               JobProcessor.job_result_list()</span>
<a name="l01004"></a>01004 <span class="stringliteral">         @see Job, JobResult, get_job_result()</span>
<a name="l01005"></a>01005 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l01006"></a>01006 
<a name="l01007"></a>01007       <span class="comment"># --- Dump all results for checking     </span>
<a name="l01008"></a>01008       <span class="keywordflow">if</span> master.logging_enabled():
<a name="l01009"></a>01009          <span class="keywordflow">for</span> branch <span class="keywordflow">in</span> self.job_branches:
<a name="l01010"></a>01010             job_results = self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html#a84aa65742c9da7459085cf01447c8a6c" title="Return the list of MpfxMultiEpochJobResult objects for a specified branch, observation type...">get_job_results</a>(branch=branch, img_no=0)
<a name="l01011"></a>01011             master.logger.log_info_p(<span class="stringliteral">&quot;{0} - Results from branch {1}: {2}&quot;</span>.format(
<a name="l01012"></a>01012                                      master, branch, [r.result <span class="keywordflow">for</span> r <span class="keywordflow">in</span> job_results]))
<a name="l01013"></a>01013       <span class="keywordflow">else</span>:
<a name="l01014"></a>01014          <span class="keywordflow">pass</span>
<a name="l01015"></a>01015 
<a name="l01016"></a>01016    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l01017"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html#a84aa65742c9da7459085cf01447c8a6c">01017</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobProcessor.html#a84aa65742c9da7459085cf01447c8a6c" title="Return the list of MpfxMultiEpochJobResult objects for a specified branch, observation type...">get_job_results</a>(self, **kwargs):
<a name="l01018"></a>01018       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l01019"></a>01019 <span class="stringliteral">         Return the list of MpfxMultiEpochJobResult objects for a specified branch, observation type, </span>
<a name="l01020"></a>01020 <span class="stringliteral">         data_type and image number. These parameters must be specified using the </span>
<a name="l01021"></a>01021 <span class="stringliteral">         &quot;branch=&quot;, &quot;img_no=&quot; keywords</span>
<a name="l01022"></a>01022 <span class="stringliteral">         @return list of MpfxMultiEpochJobResult objects</span>
<a name="l01023"></a>01023 <span class="stringliteral">         @code</span>
<a name="l01024"></a>01024 <span class="stringliteral">            Examples</span>
<a name="l01025"></a>01025 <span class="stringliteral">            - self.get_job_results(branch=&quot;control/space&quot;) to retrieve job results for all images </span>
<a name="l01026"></a>01026 <span class="stringliteral">              and epochs in branch &quot;control/space&quot;</span>
<a name="l01027"></a>01027 <span class="stringliteral">            - self.get_job_results(branch=&quot;control/space/variable&quot;, img_no=1) to retrieve </span>
<a name="l01028"></a>01028 <span class="stringliteral">              job results of branch &quot;control/space/variable&quot;, image number 1, all epochs </span>
<a name="l01029"></a>01029 <span class="stringliteral">         @endcode</span>
<a name="l01030"></a>01030 <span class="stringliteral">         @note MpfxMultiEpochJobResult objects can also be directly obtained from the </span>
<a name="l01031"></a>01031 <span class="stringliteral">               mpfx.mpfx_job.MpfxMultiEpochJobProcessor.job_result_dico dictionary</span>
<a name="l01032"></a>01032 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l01033"></a>01033 
<a name="l01034"></a>01034       job_result_list = [] 
<a name="l01035"></a>01035 
<a name="l01036"></a>01036       branch = kwargs.get(<span class="stringliteral">&quot;branch&quot;</span>, <span class="keywordtype">None</span>)    <span class="comment"># branch tree path, e.g. &quot;control/ground/constant&quot;</span>
<a name="l01037"></a>01037       img_no = kwargs.get(<span class="stringliteral">&quot;img_no&quot;</span>, <span class="keywordtype">None</span>)
<a name="l01038"></a>01038  
<a name="l01039"></a>01039       <span class="keywordflow">if</span> branch <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l01040"></a>01040 
<a name="l01041"></a>01041          branch.strip(<span class="stringliteral">&quot;/&quot;</span>)                <span class="comment"># strip first &quot;/&quot; just in case...</span>
<a name="l01042"></a>01042          branch_dirs = branch.split(<span class="stringliteral">&quot;/&quot;</span>)  <span class="comment"># extract branch dir components</span>
<a name="l01043"></a>01043 
<a name="l01044"></a>01044          <span class="comment"># Point to the dictionary level of the leaf branch directory         </span>
<a name="l01045"></a>01045          job_result_dico = self._job_result_dico
<a name="l01046"></a>01046          <span class="keywordflow">for</span> branch_dir <span class="keywordflow">in</span> branch_dirs:
<a name="l01047"></a>01047             job_result_dico = job_result_dico[branch_dir]     
<a name="l01048"></a>01048 
<a name="l01049"></a>01049          <span class="keywordflow">if</span> img_no <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l01050"></a>01050             <span class="keywordflow">if</span> img_no <span class="keywordflow">in</span> job_result_dico:
<a name="l01051"></a>01051                <span class="comment"># all epochs of the image </span>
<a name="l01052"></a>01052                job_result_list.append(job_result_dico[img_no])
<a name="l01053"></a>01053          <span class="keywordflow">else</span>:
<a name="l01054"></a>01054             <span class="comment"># all image and epochs in the branch  </span>
<a name="l01055"></a>01055             job_result_list = list(self._flatten_dict(job_result_dico))
<a name="l01056"></a>01056 
<a name="l01057"></a>01057       <span class="keywordflow">else</span>:
<a name="l01058"></a>01058          <span class="comment"># Unspecified branch</span>
<a name="l01059"></a>01059          <span class="keywordflow">if</span> img_no <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l01060"></a>01060             job_result_list = list(self._flatten_dict(self._job_result_dico))
<a name="l01061"></a>01061          <span class="keywordflow">else</span>:         
<a name="l01062"></a>01062             self.helper.print_error(
<a name="l01063"></a>01063                              <span class="stringliteral">&quot;get_job_results(): a branch must be specified&quot;</span>)
<a name="l01064"></a>01064                   
<a name="l01065"></a>01065       <span class="keywordflow">return</span> job_result_list
<a name="l01066"></a>01066 
<a name="l01067"></a>01067 
<a name="l01068"></a>01068 
<a name="l01069"></a>01069 <span class="comment"># -------------------------------------------------------------------------------------------------</span>
<a name="l01070"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html">01070</a> <span class="keyword">class </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html" title="Represents a MpfxMultiEpochJob job, an extension of a MpfxJob for holding a group of images with mult...">MpfxMultiEpochJob</a>(<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxJob.html" title="Represents a Mpfx job.">MpfxJob</a>):      
<a name="l01071"></a>01071 
<a name="l01072"></a>01072    <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l01073"></a>01073 <span class="stringliteral">       Represents a MpfxMultiEpochJob job, an extension of a MpfxJob for holding a group of</span>
<a name="l01074"></a>01074 <span class="stringliteral">       images with multiple exposures, with related catalogs. </span>
<a name="l01075"></a>01075 <span class="stringliteral">   &quot;&quot;&quot;</span>
<a name="l01076"></a>01076 
<a name="l01077"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a1eef28561f6f7de6cdc1f1d58694847b">01077</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a1eef28561f6f7de6cdc1f1d58694847b" title="Construct a new job for identifiying a set of files in the dataset to process together.">__init__</a>(self, master, dataset, img_path_dico, *args):
<a name="l01078"></a>01078       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l01079"></a>01079 <span class="stringliteral">         Construct a new job for identifiying a set of files in the dataset to process together.</span>
<a name="l01080"></a>01080 <span class="stringliteral"></span>
<a name="l01081"></a>01081 <span class="stringliteral">         To obtain the path associated with a given type, just use:</span>
<a name="l01082"></a>01082 <span class="stringliteral">         @code self.img_path_dico[type]@endcode with one of the aforementioned types.</span>
<a name="l01083"></a>01083 <span class="stringliteral"></span>
<a name="l01084"></a>01084 <span class="stringliteral">         @param master master process instance</span>
<a name="l01085"></a>01085 <span class="stringliteral">         @param dataset data source used to create the job</span>
<a name="l01086"></a>01086 <span class="stringliteral">         @param img_path_dico file absolute path dictionary  for every file types referenced in </span>
<a name="l01087"></a>01087 <span class="stringliteral">                the job</span>
<a name="l01088"></a>01088 <span class="stringliteral">         @param args a list with the branch tree, image number and epoch number</span>
<a name="l01089"></a>01089 <span class="stringliteral"></span>
<a name="l01090"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a93fe8932a81c3dc3fb1b7e8480d5556e">01090</a> <span class="stringliteral">         @return an initialized MpfxJob object </span>
<a name="l01091"></a>01091 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l01092"></a>01092 
<a name="l01093"></a>01093       <span class="comment"># ~~~~~~~~~~~</span>
<a name="l01094"></a>01094       <span class="comment"># Properties </span>
<a name="l01095"></a>01095       <span class="comment"># ~~~~~~~~~~~</span>
<a name="l01096"></a>01096 
<a name="l01097"></a>01097       img_no = args[-1]
<a name="l01098"></a>01098       branch_dirs = args[:-1]
<a name="l01099"></a>01099 
<a name="l01100"></a>01100       <span class="comment"># Set job attributes</span>
<a name="l01101"></a>01101       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a85bec15e1ada58af0bc1d1abd6c408c9">branch</a> = <span class="stringliteral">&quot;/&quot;</span>.join(branch_dirs)    <span class="comment"># branch (path) to the files of the job</span>
<a name="l01102"></a>01102       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a462ae66137ea8cf28219ed33a6b6186a">branch_dirs</a> = branch_dirs         <span class="comment"># list of directory names in the branch </span>
<a name="l01103"></a>01103       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a5e8315f15520dbd3c4db78b6c9aebac2">img_no</a> = img_no                   <span class="comment"># image number associated with the job</span>
<a name="l01104"></a>01104       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a870b3a05f712a176278ffa3c24f7574d">img_path_dico</a> = img_path_dico     <span class="comment"># dictionary of file paths per file type</span>
<a name="l01105"></a>01105 
<a name="l01106"></a>01106       branch_key = list(branch_dirs)
<a name="l01107"></a>01107       branch_key.extend([img_no])
<a name="l01108"></a>01108       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a6963784bf0c039b4fb99a78fc43b8ed6">branch_key</a> = tuple(branch_key)
<a name="l01109"></a>01109 
<a name="l01110"></a>01110       <span class="comment"># --- Build epoch list </span>
<a name="l01111"></a>01111       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a2092546812c8d72d0c6bf80dabdca35d">_epoch_nos</a> = []
<a name="l01112"></a>01112 
<a name="l01113"></a>01113       reg_epoch = re.compile(<span class="stringliteral">&quot;\-(.+)\-(.+)\.&quot;</span>)
<a name="l01114"></a>01114 
<a name="l01115"></a>01115       path_dico = img_path_dico.get(self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a6963784bf0c039b4fb99a78fc43b8ed6">branch_key</a>, <span class="keywordtype">None</span>)
<a name="l01116"></a>01116       <span class="keywordflow">if</span> path_dico <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l01117"></a>01117          file_lists = [l <span class="keywordflow">for</span> l <span class="keywordflow">in</span> path_dico.values() <span class="keywordflow">if</span> dataset.is_image(master, l[0])]
<a name="l01118"></a>01118          <span class="keywordflow">if</span> len(file_lists) &gt; 0:    
<a name="l01119"></a>01119             self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a2092546812c8d72d0c6bf80dabdca35d">_epoch_nos</a> = sorted([ int(reg_epoch.search(os.path.split(t)[1]).group(2)) \
<a name="l01120"></a>01120                                        <span class="keywordflow">for</span> t <span class="keywordflow">in</span>  file_lists[0] ])
<a name="l01121"></a>01121          <span class="keywordflow">else</span>:      
<a name="l01122"></a>01122             <span class="keywordflow">if</span> master.logging_enabled():
<a name="l01123"></a>01123                master.helper.print_error(<span class="stringliteral">&quot;/{0}/image-{1:03d} - &quot;</span>\
<a name="l01124"></a>01124                                          <span class="stringliteral">&quot;Job creation failure: empty image file list&quot;</span>.format(
<a name="l01125"></a>01125                                                                              self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a85bec15e1ada58af0bc1d1abd6c408c9">branch</a>, img_no))
<a name="l01126"></a>01126 
<a name="l01127"></a>01127          <span class="comment"># --- Set job name   </span>
<a name="l01128"></a>01128          <span class="keywordflow">if</span> len(dataset.dir_list) &gt; 0:
<a name="l01129"></a>01129             self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a93fe8932a81c3dc3fb1b7e8480d5556e">job_name</a> = <span class="stringliteral">&quot;{0}_img_{1:03d}-[{2}]&quot;</span>.format(<span class="stringliteral">&quot;_&quot;</span>.join(branch_dirs), img_no, 
<a name="l01130"></a>01130                                                      <span class="stringliteral">&quot;-&quot;</span>.join([str(e) <span class="keywordflow">for</span> e <span class="keywordflow">in</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a2092546812c8d72d0c6bf80dabdca35d">_epoch_nos</a>]) )
<a name="l01131"></a>01131          <span class="keywordflow">else</span>:
<a name="l01132"></a>01132             self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a93fe8932a81c3dc3fb1b7e8480d5556e">job_name</a> = <span class="stringliteral">&quot;img_{0:03d}-[{1}]&quot;</span>.format(img_no, 
<a name="l01133"></a>01133                                                      <span class="stringliteral">&quot;-&quot;</span>.join([str(e) <span class="keywordflow">for</span> e <span class="keywordflow">in</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a2092546812c8d72d0c6bf80dabdca35d">_epoch_nos</a>]) )
<a name="l01134"></a>01134 
<a name="l01135"></a>01135          <span class="comment"># Parent class initialization      </span>
<a name="l01136"></a>01136          Job.__init__(self, master, self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a93fe8932a81c3dc3fb1b7e8480d5556e">job_name</a> , dataset)
<a name="l01137"></a>01137 
<a name="l01138"></a>01138       <span class="keywordflow">else</span>:
<a name="l01139"></a>01139          <span class="comment"># Job creation failure</span>
<a name="l01140"></a>01140          <span class="keywordflow">if</span> master.logging_enabled():
<a name="l01141"></a>01141             master.helper.print_error(<span class="stringliteral">&quot;/{0}/image-{1:03d} - &quot;</span>\
<a name="l01142"></a>01142                                       <span class="stringliteral">&quot;Job creation failure-: unknown directory path {2}&quot;</span>.format(
<a name="l01143"></a>01143                                                             self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a85bec15e1ada58af0bc1d1abd6c408c9">branch</a>, img_no, self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a6963784bf0c039b4fb99a78fc43b8ed6">branch_key</a>))
<a name="l01144"></a>01144 
<a name="l01145"></a>01145 
<a name="l01146"></a>01146    <span class="comment"># ~~~~~~~~~~~</span>
<a name="l01147"></a>01147    <span class="comment"># Properties </span>
<a name="l01148"></a>01148    <span class="comment"># ~~~~~~~~~~~</span>
<a name="l01149"></a>01149 
<a name="l01150"></a>01150    <span class="comment"># --- Getters</span>
<a name="l01151"></a>01151 
<a name="l01152"></a>01152    @property
<a name="l01153"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a5c91b3d0bebab38a3a1b9520a7cd3b82">01153</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a5c91b3d0bebab38a3a1b9520a7cd3b82">epoch_nos</a>(self):
<a name="l01154"></a>01154       <span class="stringliteral">&quot;&quot;&quot;! @return the epoch (multiple exposure) indice associated with the job. &quot;&quot;&quot;</span>
<a name="l01155"></a>01155       <span class="keywordflow">return</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a2092546812c8d72d0c6bf80dabdca35d">_epoch_nos</a>
<a name="l01156"></a>01156 
<a name="l01157"></a>01157    @property
<a name="l01158"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a701c5005d92e650fa704ea457c0ec91b">01158</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a701c5005d92e650fa704ea457c0ec91b">epoch</a>(self):
<a name="l01159"></a>01159       <span class="stringliteral">&quot;&quot;&quot;! @return the first epoch index associated with the job. &quot;&quot;&quot;</span>
<a name="l01160"></a>01160       <span class="keywordflow">return</span> self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a2092546812c8d72d0c6bf80dabdca35d">_epoch_nos</a>[0]
<a name="l01161"></a>01161 
<a name="l01162"></a>01162    <span class="comment"># --- Setters</span>
<a name="l01163"></a>01163 
<a name="l01164"></a>01164    @epoch_nos.setter 
<a name="l01165"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a5c91b3d0bebab38a3a1b9520a7cd3b82">01165</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a5c91b3d0bebab38a3a1b9520a7cd3b82">epoch_nos</a>(self, epoch_nos):
<a name="l01166"></a>01166       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l01167"></a>01167 <span class="stringliteral">         Specify the epoch (multiple exposure) indice associated with the job. </span>
<a name="l01168"></a>01168 <span class="stringliteral">         @param epoch_nos the epoch indice associated with the job. </span>
<a name="l01169"></a>01169 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l01170"></a>01170       self.<a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJob.html#a2092546812c8d72d0c6bf80dabdca35d">_epoch_nos</a> = epoch_nos
<a name="l01171"></a>01171 
<a name="l01172"></a>01172 
<a name="l01173"></a>01173 <span class="comment"># -------------------------------------------------------------------------------------------------</span>
<a name="l01174"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobResult.html">01174</a> <span class="keyword">class </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobResult.html" title="Represents the result of a job with multiple epochs (exposures) images and related catalogs...">MpfxMultiEpochJobResult</a>(<a class="code" href="classJobResult.html">JobResult</a>):      
<a name="l01175"></a>01175 
<a name="l01176"></a>01176    <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l01177"></a>01177 <span class="stringliteral">       Represents the result of a job with multiple epochs (exposures) images and related catalogs.</span>
<a name="l01178"></a>01178 <span class="stringliteral">   &quot;&quot;&quot;</span>
<a name="l01179"></a>01179 
<a name="l01180"></a><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobResult.html#ae1cd2893f416e7344302e4a4d5dc6aa8">01180</a>    <span class="keyword">def </span><a class="code" href="classmpfx_1_1mpfx__job_1_1MpfxMultiEpochJobResult.html#ae1cd2893f416e7344302e4a4d5dc6aa8" title="Construct a MpfxJobResult job result object.">__init__</a>(self, worker, job, result):   
<a name="l01181"></a>01181       <span class="stringliteral">&quot;&quot;&quot;! Construct a MpfxJobResult job result object &quot;&quot;&quot;</span>
<a name="l01182"></a>01182       JobResult.__init__(self, worker, job, result)
<a name="l01183"></a>01183 
<a name="l01184"></a>01184 
<a name="l01185"></a>01185 <span class="comment"># -- EOF mpfx_job.py</span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="mpfx__job_8py.html">mpfx_job.py</a>      </li>
      <li class="footer">Generated on Mon Apr 20 2015 16:43:07 for MPFX by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
