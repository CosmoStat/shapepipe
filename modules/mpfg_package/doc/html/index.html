<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>MPF: MPF - Multiprocessing framework</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">MPF
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">MPF multiprocessing framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MPF - Multiprocessing framework </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Author: Marc Gentile (<a href="#" onclick="location.href='mai'+'lto:'+'mar'+'c.'+'gen'+'ti'+'le@'+'ep'+'fl.'+'ch'; return false;">marc.<span style="display: none;">.nosp@m.</span>gent<span style="display: none;">.nosp@m.</span>ile@e<span style="display: none;">.nosp@m.</span>pfl.<span style="display: none;">.nosp@m.</span>ch</a>)</p>
<h1><a class="anchor" id="Description"></a>
Description</h1>
<p>MPF is a simple multiprocessing frawework for executing code on both SMP (Symmetric Multiprocessing) or on serveurs supporting the Message Passing Interface (MPI).</p>
<p>The implemented multiprocessing scheme follows a Producer-Consumer model whereby a "manager" process is responsible for producing and dispatching "jobs" to a pool of "worker" processes. The task of each worker is to process the job assigned to it and once done, supply the result to the manager. The manager can process that result and provide the worker with a new job and so on until no work is left.</p>
<p>This scheme works well when the same processing must be applied to a great number of files, e.g. thousands of astronomical images to be processed.</p>
<p>Every time it is run, MPF will create a new time-stamped run_xxx directory in the base output directory specified in the configuration file [DIR.OUTPUT] section.</p>
<p>In MPF, a Job object is created for each file found to process in a base input directory specified by the user. Such a file may be for example an image or a catalog to process. All the files under the base input directory constitute a 'Dataset' in the sense of MPF. A Dataset can be extended to represent a more complex directory structure.</p>
<p>As it is, MPF is only a skeleton that implements a default behavior. One has to extend its classes and overrides some of its methods in order to implement concrete tasks, such as deconvolution or denoising in astronomy.</p>
<p>One thus has to create a python module based on MPF, i.e. provide classes that inherits from relevant MPF classes and overrides some of their methods.</p>
<p>Assuming such a module has been created, it will have to provide:</p>
<ol type="1">
<li>A subclass of class Args in order to tell where to find the default configuration file and optionnally support additional command-line arguments or options</li>
<li>A subclass of class JobProcessor where the following methods must be overridden to implement custom behavior.<ul>
<li>process_job(): where the specific code of the task to perform must be invoked from.</li>
<li>process_job_result(): which defines what to do with the results of the job, like creating catalogs or making plots.</li>
<li>create_job(): factory method for creating a job object if the base Job class must be extended. In such a case, the derived Job class must be defined and its constructor invoked there.</li>
<li>Optionally, it may be useful to override the following methods:<ul>
<li>preprocess_job() : processing to be done before process_job() is called</li>
<li>postprocess_job(): processing to be done afer process_job() is called</li>
<li>all_jobs_processed(): invoked once all the jobs have been processed.</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>Modifying other methods has to be made with great care.</p>
<h1><a class="anchor" id="code"></a>
Source code</h1>
<p>The MPF code is made of the following files:</p><ul>
<li>mpf.cfg: configuration file</li>
<li><a class="el" href="mp__SMP_8py.html">mp_SMP.py</a>: main program for the SMP implementation</li>
<li><a class="el" href="mp__MPI_8py.html">mp_MPI.py</a>: main program for the MPI implementation</li>
<li><a class="el" href="mp__calc__SMP_8py.html" title="mp_calc_SMP.py: multiprocessing infrastructure for calculation on a SMP architecture ...">mp_calc_SMP.py</a>: SMP multiprocessing classes</li>
<li><a class="el" href="mp__calc__MPI_8py.html" title="mp_calc_MPI.py: nultiprocessing infrastructure for calculation with the MPI interface ...">mp_calc_MPI.py</a>: MPI multiprocessing classes</li>
<li><a class="el" href="mp__calc_8py.html" title="Multiprocessing infrastructure for calculation - Base module. ">mp_calc.py</a>: common code for <a class="el" href="mp__SMP_8py.html">mp_SMP.py</a> and <a class="el" href="mp__MPI_8py.html">mp_MPI.py</a></li>
<li><a class="el" href="namespacempfg_1_1mp__args.html" title="Command line options management for mp_MPI.py or mp_SMP.py. ">mp_args</a>: command-line argument and options</li>
<li><a class="el" href="namespacempfg_1_1mp__job.html" title="job management for SMP or MPI interface ">mp_job</a>: parallel job processing</li>
<li><a class="el" href="namespacempfg_1_1mp__data.html" title="data access ">mp_data</a>: data management in the form of datasets</li>
<li><a class="el" href="namespacempfg_1_1mp__helper.html" title="various helper functions ">mp_helper</a>: utility functions</li>
</ul>
<h1><a class="anchor" id="Prerequisites"></a>
Prerequisites</h1>
<ul>
<li>Python 2.6 or 2.7 on Unix or Mac OS</li>
<li>sconfig v1.x: configuration file parser module</li>
<li>slogger v1.x: logging module</li>
</ul>
<h1><a class="anchor" id="Installation"></a>
Installation</h1>
<p>Download and unpack the file mpfg-1.0.2.tar.gz in the directory of your choice. MPF is a pure Python module and can then be installed using the standard procedure:</p>
<ol>
<li>
create a console or terminal session  </li>
<li>
cd to the directory where mpfg-1.0.2.tar.gz was detared  </li>
<li>
<p class="startli">enter the command: command:</p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;sudo python setup.py install </div>
</div><!-- fragment --> <p class="endli"></p>
</li>
<li>
if no root access, use:<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;python setup install --home=target_directory </div>
</div><!-- fragment --> to install the module to target_directory. This directory must be included in the <code>PYTHONPATH</code> environment variable  </li>
</ol>
<h1><a class="anchor" id="Execution"></a>
Execution</h1>
<p>The general syntax is:</p>
<ul>
<li>SMP version: <code><a class="el" href="mp__SMP_8py.html">mp_SMP.py</a> [options] </code></li>
<li>MPI version: <code><a class="el" href="mp__MPI_8py.html">mp_MPI.py</a> [options] </code></li>
</ul>
<p>by default, MPF will look for a configuration file named mpfg.cfg in the ./config directory. The location of this file can be changed using the -c and -d options (see below).</p>
<p>The supported options are:</p>
<ul>
<li>
<p class="startli">-h, &ndash;help Display the usage syntax and the list of supported options. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">-d, &ndash;config-dir Directory where to find the configuration file </p>
<p class="endli"></p>
</li>
<li>
-c, &ndash;config-file Name of the configuration file (default: mpfg.cfg)  </li>
</ul>
<p>To run <a class="el" href="mp__MPI_8py.html">mp_MPI.py</a>, one has to use the mpirun executable as:</p>
<ul>
<li><code>mpirun -np N <a class="el" href="mp__MPI_8py.html">mp_MPI.py</a> [options] </code></li>
</ul>
<p>where N is the number of processors (or nodes) to use. MPI must has been installed and configured appropriately.</p>
<p>Since the manager process of MPF uses one processor for itself, workers will share N-1 processors.</p>
<p>For example: <code>mpirun -np 6 <a class="el" href="namespacempfg_1_1mp__MPI.html">mp_MPI</a> -d mydir -c myconfig.cfg</code> will run mpf on 6 processors, 1 for the manager and 5 for the workers. The manager and each of the workers will look for a configuration file: ./mydir/myconfig.cfg.</p>
<h1><a class="anchor" id="notes"></a>
Release notes</h1>
<ul>
<li>v1.0.0: initial version </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Oct 28 2015 10:59:59 for MPF by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
