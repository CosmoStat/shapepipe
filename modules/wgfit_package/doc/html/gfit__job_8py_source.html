<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>gfit: /home/marc/cea-epfl/trunk/gfit_package/gfit/gfit_job.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">gfit&#160;<span id="projectnumber">1.0.0</span></div>
   <div id="projectbrief">Galaxy Shape Measurement</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('gfit__job_8py.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>gfit_job.py</h1>  </div>
</div>
<div class="contents">
<a href="gfit__job_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespacegfit_1_1gfit__job.html">00001</a> <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00002"></a>00002 <span class="stringliteral">   Job Processing  </span>
<a name="l00003"></a>00003 <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="comment"># -- Python imports</span>
<a name="l00006"></a>00006 <span class="keyword">import</span> os, sys
<a name="l00007"></a>00007 <span class="keyword">import</span> time
<a name="l00008"></a>00008 <span class="keyword">import</span> numpy
<a name="l00009"></a>00009 <span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter, attrgetter
<a name="l00010"></a>00010 <span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="comment"># -- External imports</span>
<a name="l00013"></a>00013 <span class="keyword">from</span> mpfx.mpfx_job <span class="keyword">import</span> *      <span class="comment"># base job processing</span>
<a name="l00014"></a>00014 <span class="keyword">from</span> mpfx.mpfx_data <span class="keyword">import</span> *     <span class="comment"># data access</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="comment"># --- Module-specific imports</span>
<a name="l00017"></a>00017 <span class="keyword">from</span> gfit_shape <span class="keyword">import</span> *         <span class="comment"># galaxy shape estimation</span>
<a name="l00018"></a>00018 <span class="keyword">from</span> gfit_plot <span class="keyword">import</span> *          <span class="comment"># plotter </span>
<a name="l00019"></a>00019 <span class="keyword">from</span> gfit_helper <span class="keyword">import</span> *        <span class="comment"># helper utility functions</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="comment"># -------------------------------------------------------------------------------------------------</span>
<a name="l00022"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html">00022</a> <span class="keyword">class </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html" title="Job processor: submit jobs and process associated job results.">GfitJobProcessor</a>(<a class="code" href="classMpfxJobProcessor.html">MpfxJobProcessor</a>):
<a name="l00023"></a>00023    
<a name="l00024"></a>00024    <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00025"></a>00025 <span class="stringliteral">      Job processor: submit jobs and process associated job results. Based on mpfx.JobProcessor.   </span>
<a name="l00026"></a>00026 <span class="stringliteral">   &quot;&quot;&quot;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a809359de4f18983dcec7b6541698a297">00028</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a809359de4f18983dcec7b6541698a297" title="Job Processor constructor.">__init__</a>(self, master):
<a name="l00029"></a>00029       <span class="stringliteral">&quot;&quot;&quot;! Job Processor constructor &quot;&quot;&quot;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031       MpfxJobProcessor.__init__(self, master)
<a name="l00032"></a>00032       
<a name="l00033"></a>00033       self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a58d32273eed8e73bb6a126012822ad6b">_shape_estimator</a> = GfitShapeEstimator(master) 
<a name="l00034"></a>00034       self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a50cfbeacb5f0daf74677c39f125a1d05">_plotter</a> = GfitPlotter()    <span class="comment"># plotter</span>
<a name="l00035"></a>00035       self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a8ef21268708e4256abd4665567ed6a47">_helper</a> = GfitHelper()      <span class="comment"># helper</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037    <span class="comment"># ~~~~~~~~~~</span>
<a name="l00038"></a>00038    <span class="comment"># Properties </span>
<a name="l00039"></a>00039    <span class="comment"># ~~~~~~~~~~</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041    @property
<a name="l00042"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a477b178dac8ec625d9ab30d428e8bb48">00042</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a477b178dac8ec625d9ab30d428e8bb48">shape_estimator</a>(self):
<a name="l00043"></a>00043       <span class="stringliteral">&quot;&quot;&quot;! @return the shape estimator instance. &quot;&quot;&quot;</span>
<a name="l00044"></a>00044       <span class="keywordflow">return</span> self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a58d32273eed8e73bb6a126012822ad6b">_shape_estimator</a>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046    @property
<a name="l00047"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a76497570864a2e798c9a1cc5206787d3">00047</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a76497570864a2e798c9a1cc5206787d3">plotter</a>(self):
<a name="l00048"></a>00048       <span class="stringliteral">&quot;&quot;&quot;! @return the GfitPlotter instance. &quot;&quot;&quot;</span>
<a name="l00049"></a>00049       <span class="keywordflow">return</span> self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a50cfbeacb5f0daf74677c39f125a1d05">_plotter</a>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051    @property
<a name="l00052"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a6792fa9aee819fe6ea18195e42a5ad09">00052</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a6792fa9aee819fe6ea18195e42a5ad09">helper</a>(self):
<a name="l00053"></a>00053       <span class="stringliteral">&quot;&quot;&quot;! @return the GfitHelper instance. &quot;&quot;&quot;</span>
<a name="l00054"></a>00054       <span class="keywordflow">return</span> self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a8ef21268708e4256abd4665567ed6a47">_helper</a>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 
<a name="l00057"></a>00057    <span class="comment"># ~~~~~~~~~~~~~~~</span>
<a name="l00058"></a>00058    <span class="comment"># Public methods </span>
<a name="l00059"></a>00059    <span class="comment"># ~~~~~~~~~~~~~~~</span>
<a name="l00060"></a>00060 
<a name="l00061"></a>00061    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00062"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#afb0f7689d1313df325d08848552ac948">00062</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#afb0f7689d1313df325d08848552ac948" title="Create a primary Dataset object that represent the data source for images and catalogs.">create_dataset</a>(self, master, dataset_name, dataset_type, 
<a name="l00063"></a>00063                                     dataset_base_dir, dataset_dir_list, dataset_recurse):
<a name="l00064"></a>00064       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00065"></a>00065 <span class="stringliteral">         Create a primary Dataset object that represent the data source for images and catalogs.</span>
<a name="l00066"></a>00066 <span class="stringliteral">         @param master master process instance</span>
<a name="l00067"></a>00067 <span class="stringliteral">         @param dataset_name dataset name</span>
<a name="l00068"></a>00068 <span class="stringliteral">         @param dataset_type prefix of a Dataset class, assumed to be of the form </span>
<a name="l00069"></a>00069 <span class="stringliteral">                @code &lt;dataset_type&gt;Dataset @endcode, like @c MpfxDataset</span>
<a name="l00070"></a>00070 <span class="stringliteral">         @param dataset_base_dir dataset base directory</span>
<a name="l00071"></a>00071 <span class="stringliteral">         @param dataset_dir_list [optional] a list of specific directories to search under base directory</span>
<a name="l00072"></a>00072 <span class="stringliteral">         @param dataset_recurse [optional] tell whether to walk down directories (default @c True)</span>
<a name="l00073"></a>00073 <span class="stringliteral">         @return the Dataset instance </span>
<a name="l00074"></a>00074 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00075"></a>00075 
<a name="l00076"></a>00076       dataset_class = self.get_dataset_module(master, dataset_name, dataset_type, dataset_base_dir)
<a name="l00077"></a>00077       <span class="keywordflow">if</span> dataset_class <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00078"></a>00078          <span class="keywordflow">return</span> dataset_class(master, dataset_name, 
<a name="l00079"></a>00079                               dataset_base_dir, dataset_dir_list, dataset_recurse)   
<a name="l00080"></a>00080       <span class="keywordflow">else</span>:
<a name="l00081"></a>00081          <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00084"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a79bca56f162ca0b6f9be9e03b9097eb1">00084</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a79bca56f162ca0b6f9be9e03b9097eb1" title="Locate all objects to process and create the corresponding jobs.">create_jobs</a>(self, master):
<a name="l00085"></a>00085       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00086"></a>00086 <span class="stringliteral">         Locate all objects to process and create the corresponding jobs. </span>
<a name="l00087"></a>00087 <span class="stringliteral">         @param master Master process instance</span>
<a name="l00088"></a>00088 <span class="stringliteral">         @return the list of created jobs </span>
<a name="l00089"></a>00089 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00090"></a>00090 
<a name="l00091"></a>00091       <span class="comment"># --- Check that the jobs constains all necessary data </span>
<a name="l00092"></a>00092       is_valid = <span class="keyword">True</span>
<a name="l00093"></a>00093       job_list = MpfxJobProcessor.create_jobs(self, master)
<a name="l00094"></a>00094       <span class="keywordflow">if</span> len(job_list) &gt; 0:
<a name="l00095"></a>00095          <span class="comment"># --- Check first job</span>
<a name="l00096"></a>00096          job = job_list[0]
<a name="l00097"></a>00097          is_valid = len(job.galaxy_se_filepath_dico) &gt; 0 <span class="keywordflow">and</span> \
<a name="l00098"></a>00098                     len(job.star_se_filepath_dico) &gt; 0 <span class="keywordflow">and</span> \
<a name="l00099"></a>00099                     len(job.psf_filepath_dico) &gt; 0
<a name="l00100"></a>00100 
<a name="l00101"></a>00101          <span class="keywordflow">if</span> master.logging_enabled() <span class="keywordflow">and</span> <span class="keywordflow">not</span> is_valid:
<a name="l00102"></a>00102             <span class="keywordflow">if</span> len(job.galaxy_se_filepath_dico) == 0:
<a name="l00103"></a>00103                file_patterns = master.config.get_as_list(<span class="stringliteral">&quot;FILE_PATTERNS&quot;</span>,
<a name="l00104"></a>00104                                                     <span class="stringliteral">&quot;SEXTRACTOR_DATASET_GALAXY.CATALOG_PROPERTIES&quot;</span>)
<a name="l00105"></a>00105                master.logger.log_error_p(<span class="stringliteral">&quot;{0} - Failed to find input &quot;</span>\
<a name="l00106"></a>00106                                             <span class="stringliteral">&quot;SExtractor Galaxy catalogs {1}&quot;</span>.format(
<a name="l00107"></a>00107                                             master, file_patterns))
<a name="l00108"></a>00108             <span class="keywordflow">if</span> len(job.star_se_filepath_dico) == 0:
<a name="l00109"></a>00109                file_patterns = master.config.get_as_list(<span class="stringliteral">&quot;FILE_PATTERNS&quot;</span>,
<a name="l00110"></a>00110                                                       <span class="stringliteral">&quot;SEXTRACTOR_DATASET_PSF.CATALOG_PROPERTIES&quot;</span>)
<a name="l00111"></a>00111                master.logger.log_error_p(<span class="stringliteral">&quot;{0} - Failed to find input &quot;</span>\
<a name="l00112"></a>00112                                          <span class="stringliteral">&quot;SExtractor Star catalogs {1}&quot;</span>.format(
<a name="l00113"></a>00113                                             master, file_patterns))
<a name="l00114"></a>00114             <span class="keywordflow">if</span> len(job.psf_filepath_dico) == 0:
<a name="l00115"></a>00115                file_patterns = master.config.get_as_list(<span class="stringliteral">&quot;FILE_PATTERNS&quot;</span>,
<a name="l00116"></a>00116                                                          <span class="stringliteral">&quot;PSF_DATASET.IMAGE_PROPERTIES&quot;</span>)
<a name="l00117"></a>00117                master.logger.log_error_p(<span class="stringliteral">&quot;{0} - Failed to find input PSF images {1}&quot;</span>.format(
<a name="l00118"></a>00118                                              master, file_patterns))
<a name="l00119"></a>00119 
<a name="l00120"></a>00120       <span class="keywordflow">if</span> <span class="keywordflow">not</span> is_valid:
<a name="l00121"></a>00121          self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#ae572317850e637fdcc873cdcbe505958">_job_list</a> = []
<a name="l00122"></a>00122          self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a70831ffa5b119ad24dfd727e0c8ee71b">_job_branches</a> = []
<a name="l00123"></a>00123          <span class="keywordflow">return</span> self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#ae572317850e637fdcc873cdcbe505958">_job_list</a>
<a name="l00124"></a>00124 
<a name="l00125"></a>00125       <span class="comment"># --- Create output directories for job outputs:</span>
<a name="l00126"></a>00126       output_dir_dico = master.config.get_section_data(<span class="stringliteral">&quot;DIR.OUTPUT&quot;</span>)
<a name="l00127"></a>00127       <span class="keywordflow">for</span> (dir_key, dir_value) <span class="keywordflow">in</span> output_dir_dico.items():
<a name="l00128"></a>00128          <span class="keywordflow">if</span> dir_key.startswith(<span class="stringliteral">&quot;OUTPUT_&quot;</span>):
<a name="l00129"></a>00129             <span class="keywordflow">if</span> dir_key.find(<span class="stringliteral">&quot;LOG&quot;</span>) == -1:  <span class="comment"># no tree for log dirs</span>
<a name="l00130"></a>00130                base_dir = os.path.join(master.run_output_dir, dir_value)
<a name="l00131"></a>00131                self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a0bb48b564c64425fbbb330ab491e9f53" title="Create the directory tree for storing the results.">_create_dir_tree</a>(base_dir, self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a70831ffa5b119ad24dfd727e0c8ee71b">_job_branches</a>)
<a name="l00132"></a>00132 
<a name="l00133"></a>00133       <span class="keywordflow">return</span> self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#ae572317850e637fdcc873cdcbe505958">_job_list</a>
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 
<a name="l00136"></a>00136    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00137"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a909b171df97f59614b8abec1a0ae6497">00137</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a909b171df97f59614b8abec1a0ae6497" title="Factory method for creating a GfitJob object.">create_job</a>(self, master, dataset, *args):
<a name="l00138"></a>00138       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00139"></a>00139 <span class="stringliteral">         Factory method for creating a GfitJob object. </span>
<a name="l00140"></a>00140 <span class="stringliteral">         @param master the master process</span>
<a name="l00141"></a>00141 <span class="stringliteral">         @param dataset source dataset object</span>
<a name="l00142"></a>00142 <span class="stringliteral">         @param args a list of arguments chosen by the caller and whose nature depends on the </span>
<a name="l00143"></a>00143 <span class="stringliteral">                     data necessary to process the job</span>
<a name="l00144"></a>00144 <span class="stringliteral">         @return a new GfitJob job object</span>
<a name="l00145"></a>00145 <span class="stringliteral">         @note overrides MpfxJobProcessor.create_job() </span>
<a name="l00146"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a4fa863e0e9542425beeeb5a446fd0097">00146</a> <span class="stringliteral">         @see Job, MpfxJob</span>
<a name="l00147"></a>00147 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00148"></a>00148 
<a name="l00149"></a>00149       <span class="comment"># --- create a MpfxJob instance, based on parent class mpf.Job</span>
<a name="l00150"></a>00150       job = GfitJob(master, dataset, *args)  
<a name="l00151"></a>00151 
<a name="l00152"></a>00152       <span class="comment"># --- Attach to the job the datasets to be used</span>
<a name="l00153"></a>00153       se_galaxy_dataset = self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a4181abbc808cd7105f3f499ed32bf699" title="Create a MpfxDataset object to query Sextractor-related data.">_create_galaxy_SE_dataset</a>(master)
<a name="l00154"></a>00154       se_psf_dataset    = self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#acf28d902fa062062a076497b1d449d47" title="Create a MpfxDataset object to query Sextractor-related data.">_create_psf_SE_dataset</a>(master)
<a name="l00155"></a>00155       psf_image_dataset = self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a3e128b34e723b88af930ce5d5d04d3f3" title="Create a MpfxDataset object to query PSF-related data at the positions of galaxies.">_create_psf_image_dataset</a>(master)
<a name="l00156"></a>00156 
<a name="l00157"></a>00157       self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a4fa863e0e9542425beeeb5a446fd0097">dataset_dico</a> = {dataset.name : dataset,\
<a name="l00158"></a>00158                            se_galaxy_dataset.name : se_galaxy_dataset,\
<a name="l00159"></a>00159                            se_psf_dataset.name : se_psf_dataset,\
<a name="l00160"></a>00160                            psf_image_dataset.name : psf_image_dataset,\
<a name="l00161"></a>00161                           }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163       <span class="comment"># --- Attach to the job the file paths of the relevant SEXtractor catalogs and PSF images</span>
<a name="l00164"></a>00164       job.galaxy_se_filepath_dico = self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a06745cf447dbbe5e357233adf174ca4d">_locate_galaxy_se_files</a>(se_galaxy_dataset, job, master)
<a name="l00165"></a>00165       job.star_se_filepath_dico   = self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a683af87d2e35b1e1e6a85d333aa4683b">_locate_psf_se_files</a>(se_psf_dataset, job, master)
<a name="l00166"></a>00166       job.psf_filepath_dico = self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a57a0335bd8dd44606ecfa1aa83973c41">_locate_psf_image_files</a>(psf_image_dataset, job, master)
<a name="l00167"></a>00167 
<a name="l00168"></a>00168       <span class="keywordflow">print</span> <span class="stringliteral">&quot;job.galaxy_se_filepath_dico:&quot;</span>, job.galaxy_se_filepath_dico
<a name="l00169"></a>00169       <span class="keywordflow">print</span> <span class="stringliteral">&quot;job.star_se_filepath_dico:&quot;</span>, job.star_se_filepath_dico
<a name="l00170"></a>00170       <span class="keywordflow">print</span> <span class="stringliteral">&quot;job.psf_image_filepath_dico:&quot;</span>, job.psf_filepath_dico
<a name="l00171"></a>00171 
<a name="l00172"></a>00172       <span class="keywordflow">print</span> <span class="stringliteral">&quot;job.img_path_dico:&quot;</span>, job.img_path_dico
<a name="l00173"></a>00173 
<a name="l00174"></a>00174       <span class="keywordflow">return</span> job
<a name="l00175"></a>00175       
<a name="l00176"></a>00176    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00177"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a2b8a6c394905b63ff0b3cbe7de30e4e5">00177</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a2b8a6c394905b63ff0b3cbe7de30e4e5" title="Invoked by the Worker to perform some optional pre-processing on the job.">preprocess_job</a>(self, job, worker):
<a name="l00178"></a>00178       <span class="stringliteral">&quot;&quot;&quot;!</span>
<a name="l00179"></a>00179 <span class="stringliteral">         Invoked by the Worker to perform some optional pre-processing on the job. </span>
<a name="l00180"></a>00180 <span class="stringliteral">         It may be for instance some format conversion. or other preparation step before the actual</span>
<a name="l00181"></a>00181 <span class="stringliteral">         processing takes place in process_job().</span>
<a name="l00182"></a>00182 <span class="stringliteral"></span>
<a name="l00183"></a>00183 <span class="stringliteral">         @param job an object of class GfitJob to process</span>
<a name="l00184"></a>00184 <span class="stringliteral">         @param worker instance of the worker process</span>
<a name="l00185"></a>00185 <span class="stringliteral"></span>
<a name="l00186"></a>00186 <span class="stringliteral">         @return an object of class GfitJobResult containing the data of the processed job</span>
<a name="l00187"></a>00187 <span class="stringliteral"></span>
<a name="l00188"></a>00188 <span class="stringliteral">         @note overrides MpfxJobProcessor.preprocess_job() </span>
<a name="l00189"></a>00189 <span class="stringliteral">               to perform any processing required &lt;b&gt;before&lt;/b&gt; process_job() is called</span>
<a name="l00190"></a>00190 <span class="stringliteral">         @see preprocess_job, postprocess_job, Job, JobResult, MpfxJobResult</span>
<a name="l00191"></a>00191 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00192"></a>00192       <span class="keywordflow">pass</span>  <span class="comment"># we no nothing here in gfit</span>
<a name="l00193"></a>00193 
<a name="l00194"></a>00194    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00195"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a550adc4ee9a31cb3cb703ea3cb4efef5">00195</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a550adc4ee9a31cb3cb703ea3cb4efef5" title="Process a job of class GfitJob and return the corresponding results in the form of a GfitJobResult ob...">process_job</a>(self, job, worker):
<a name="l00196"></a>00196       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00197"></a>00197 <span class="stringliteral">         Process a job of class GfitJob and return the corresponding results in the form of a </span>
<a name="l00198"></a>00198 <span class="stringliteral">         GfitJobResult object to the Master.       </span>
<a name="l00199"></a>00199 <span class="stringliteral"></span>
<a name="l00200"></a>00200 <span class="stringliteral">         @param job object of class GfitJob with processed data</span>
<a name="l00201"></a>00201 <span class="stringliteral">         @param worker Worker object instance</span>
<a name="l00202"></a>00202 <span class="stringliteral"></span>
<a name="l00203"></a>00203 <span class="stringliteral">         @return an object of class GfitJobResult containing the data of the processed job</span>
<a name="l00204"></a>00204 <span class="stringliteral"></span>
<a name="l00205"></a>00205 <span class="stringliteral">         @note overrides MpfxJobProcessor.process_job() </span>
<a name="l00206"></a>00206 <span class="stringliteral">         @see Job, MpfxJob, JobResult, MpfxJobResult </span>
<a name="l00207"></a>00207 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00208"></a>00208 
<a name="l00209"></a>00209       <span class="comment"># --- Depending on the object selection criteria, we may have to process either catalogs</span>
<a name="l00210"></a>00210       <span class="comment">#     matching &quot;*catalog-???.fits&quot; or images matching &quot;*image-???-??.fits&quot;</span>
<a name="l00211"></a>00211       <span class="comment">#     e.g. &quot;star_catalog-002-0.fits&quot; or &quot;starfield_image-002-0.fits&quot; for regular stars.</span>
<a name="l00212"></a>00212       <span class="comment">#     The class attribute: job.img_path_dico contains all these paths as a dictionary</span>
<a name="l00213"></a>00213       <span class="comment">#     (see description of class: GfitJob below).  </span>
<a name="l00214"></a>00214 
<a name="l00215"></a>00215       <span class="comment"># --- Here we only want to process images and catalogs. We don&#39;t any other files accesible</span>
<a name="l00216"></a>00216       <span class="comment">#     from this job, like deep_images or other dither files. </span>
<a name="l00217"></a>00217 
<a name="l00218"></a>00218       object_per_type_dico = {}  <span class="comment"># will contain all results (e1, e2, etc.) per image type   </span>
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 
<a name="l00221"></a>00221       <span class="comment"># --- Iterate over the path dictionary content and compute the ellipticities</span>
<a name="l00222"></a>00222       <span class="keywordflow">try</span>:
<a name="l00223"></a>00223 
<a name="l00224"></a>00224          <span class="comment"># --- For each file type referenced by the job...</span>
<a name="l00225"></a>00225          file_types = job.get_file_types()
<a name="l00226"></a>00226          <span class="keywordflow">for</span> file_type <span class="keywordflow">in</span> file_types: 
<a name="l00227"></a>00227 
<a name="l00228"></a>00228             filepath = job.get_file_path(file_type)
<a name="l00229"></a>00229 
<a name="l00230"></a>00230             <span class="comment"># --- A galaxy image to process</span>
<a name="l00231"></a>00231             <span class="keywordflow">if</span>  job.dataset.is_galaxy_image(worker, filepath):
<a name="l00232"></a>00232 
<a name="l00233"></a>00233                <span class="keywordflow">if</span> worker.logging_enabled():
<a name="l00234"></a>00234                   worker.logger.log_info_p(
<a name="l00235"></a>00235                          <span class="stringliteral">&quot;{0} - Processing /{1}/image-{2:03d}-{3:1d} - {4}...&quot;</span>.format(
<a name="l00236"></a>00236                             worker.name, job.get_branch_tree(), job.img_no, job.epoch, file_type))
<a name="l00237"></a>00237 
<a name="l00238"></a>00238                <span class="keywordflow">try</span>:
<a name="l00239"></a>00239 
<a name="l00240"></a>00240                   <span class="comment"># --- Create a ShapeMeasurementRequest object to process by the ShapeEstimator </span>
<a name="l00241"></a>00241 <span class="comment">#                  cat_file_extension = worker.config.get_as_string(&quot;CATALOG_EXTENSION&quot;, </span>
<a name="l00242"></a>00242 <span class="comment">#                                                                   &quot;IMAGE_PROPERTIES.GALAXY&quot;)</span>
<a name="l00243"></a>00243 
<a name="l00244"></a>00244                   shape_request = ShapeMeasurementRequest(file_type, job, worker)
<a name="l00245"></a>00245                   <span class="keywordflow">if</span> <span class="keywordflow">not</span> shape_request <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00246"></a>00246 
<a name="l00247"></a>00247                      <span class="comment"># --- Process the ShapeMeasurementRequest object and produce shape measurements</span>
<a name="l00248"></a>00248                      object_per_type_dico[file_type] = self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a477b178dac8ec625d9ab30d428e8bb48">shape_estimator</a>.measure_galaxy_shapes(
<a name="l00249"></a>00249                                                                                  shape_request,
<a name="l00250"></a>00250                                                                                  job, worker)
<a name="l00251"></a>00251                <span class="keywordflow">except</span> GfitShapeEstimator.ShapeMeasurementError <span class="keyword">as</span> detail:
<a name="l00252"></a>00252                   <span class="keywordflow">if</span> worker.logging_enabled():
<a name="l00253"></a>00253                      worker.logger.log_info_p(detail)
<a name="l00254"></a>00254 
<a name="l00255"></a>00255                   <span class="keywordflow">continue</span>    <span class="comment"># nevertheless, proceed with the next job</span>
<a name="l00256"></a>00256       
<a name="l00257"></a>00257 
<a name="l00258"></a>00258       <span class="keywordflow">except</span> Exception <span class="keyword">as</span> detail:
<a name="l00259"></a>00259 
<a name="l00260"></a>00260          <span class="keywordflow">if</span> worker.logging_enabled():
<a name="l00261"></a>00261             worker.logger.log_error_p(
<a name="l00262"></a>00262                         <span class="stringliteral">&quot;{0} - Some error occurred while processing job: {1} ({2})&quot;</span>.format(
<a name="l00263"></a>00263                                                                                 worker.name, 
<a name="l00264"></a>00264                                                                                 job,
<a name="l00265"></a>00265                                                                                 detail))
<a name="l00266"></a>00266 
<a name="l00267"></a>00267       <span class="comment"># --- Create a GfitJobResult object with the results from all image types</span>
<a name="l00268"></a>00268       <span class="keywordflow">return</span> GfitJobResult(job, object_per_type_dico, worker)
<a name="l00269"></a>00269 
<a name="l00270"></a>00270    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00271"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a0c134a07f2676d3614cfdd71c35b8ab0">00271</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a0c134a07f2676d3614cfdd71c35b8ab0" title="Invoked by the Worker to perform some optional post-processing on the job.">postprocess_job</a>(self, job_result, worker):
<a name="l00272"></a>00272       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00273"></a>00273 <span class="stringliteral">         Invoked by the Worker to perform some optional post-processing on the job.</span>
<a name="l00274"></a>00274 <span class="stringliteral">         @param job_result object of class GfitJobResult with processed data</span>
<a name="l00275"></a>00275 <span class="stringliteral">         @param worker instance of the worker process</span>
<a name="l00276"></a>00276 <span class="stringliteral"></span>
<a name="l00277"></a>00277 <span class="stringliteral">         @note overrides MpfxJobProcessor.preprocess_job() </span>
<a name="l00278"></a>00278 <span class="stringliteral">               to perform any processing required &lt;b&gt;after&lt;/b&gt; process_job() is called</span>
<a name="l00279"></a>00279 <span class="stringliteral">         @see process_job, postprocess_job, JobResult, MpfxJobResult</span>
<a name="l00280"></a>00280 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00281"></a>00281       <span class="keywordflow">pass</span>  <span class="comment"># we no nothing here in gfit</span>
<a name="l00282"></a>00282 
<a name="l00283"></a>00283    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00284"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a49316c0fef511faf594ae49b6d793f52">00284</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a49316c0fef511faf594ae49b6d793f52" title="Process the result associated with a processed job.">process_job_result</a>(self, job_result, master):
<a name="l00285"></a>00285       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00286"></a>00286 <span class="stringliteral">         Process the result associated with a processed job.       </span>
<a name="l00287"></a>00287 <span class="stringliteral"></span>
<a name="l00288"></a>00288 <span class="stringliteral">         @param job_result object of class GfitJobResult with processed data</span>
<a name="l00289"></a>00289 <span class="stringliteral">         @param master Master object instance</span>
<a name="l00290"></a>00290 <span class="stringliteral">         @note overrides MpfxJobProcessor.process_job_result()</span>
<a name="l00291"></a>00291 <span class="stringliteral">         @see Job, JobResult, MpfxJobResult</span>
<a name="l00292"></a>00292 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00293"></a>00293 
<a name="l00294"></a>00294       <span class="comment"># --- Iterate through the results of all file types in the job...  </span>
<a name="l00295"></a>00295       job = job_result.job
<a name="l00296"></a>00296       object_per_type_dico = job_result.result
<a name="l00297"></a>00297 
<a name="l00298"></a>00298       <span class="keywordflow">for</span> file_type <span class="keywordflow">in</span> object_per_type_dico.keys():
<a name="l00299"></a>00299 
<a name="l00300"></a>00300          object_dico = object_per_type_dico[file_type]
<a name="l00301"></a>00301          result_dico = object_per_type_dico[file_type][<span class="stringliteral">&quot;result&quot;</span>]   <span class="comment"># shape measurement results</span>
<a name="l00302"></a>00302          error_dico  = object_per_type_dico[file_type][<span class="stringliteral">&quot;error&quot;</span>]    <span class="comment"># shape measurement error</span>
<a name="l00303"></a>00303          filter_dico = object_per_type_dico[file_type][<span class="stringliteral">&quot;filtered&quot;</span>] <span class="comment"># object was filtered</span>
<a name="l00304"></a>00304          info_dico   = object_per_type_dico[file_type][<span class="stringliteral">&quot;info&quot;</span>]     <span class="comment"># info. about the measurement </span>
<a name="l00305"></a>00305          model_dico  = object_per_type_dico[file_type][<span class="stringliteral">&quot;model&quot;</span>]    <span class="comment"># infor about the model</span>
<a name="l00306"></a>00306 
<a name="l00307"></a>00307          <span class="comment"># --- Gives a status of what has been processed at job level</span>
<a name="l00308"></a>00308          <span class="keywordflow">if</span> master.logging_enabled():
<a name="l00309"></a>00309             elapsed_time = info_dico[<span class="stringliteral">&quot;elapsed_time&quot;</span>]
<a name="l00310"></a>00310             hours = elapsed_time/3600.0
<a name="l00311"></a>00311 
<a name="l00312"></a>00312             <span class="keywordflow">if</span> info_dico[<span class="stringliteral">&quot;success_count&quot;</span>] &gt; 0:
<a name="l00313"></a>00313                <span class="comment"># --- There are successsful results...</span>
<a name="l00314"></a>00314                bad_entry_marker = master.config.get_as_float(<span class="stringliteral">&quot;FAILED_ELLIPTICITY_VALUE&quot;</span>, 
<a name="l00315"></a>00315                                                               <span class="stringliteral">&quot;SHAPE_MEASUREMENT&quot;</span>)
<a name="l00316"></a>00316                [mean_e1, mean_e2, mean_e] = self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a477b178dac8ec625d9ab30d428e8bb48">shape_estimator</a>.compute_average_ellipticity(
<a name="l00317"></a>00317                                                                                  result_dico,
<a name="l00318"></a>00318                                                                                  bad_entry_marker)
<a name="l00319"></a>00319 
<a name="l00320"></a>00320                processed_count = info_dico[<span class="stringliteral">&quot;success_count&quot;</span>] + info_dico[<span class="stringliteral">&quot;warning_count&quot;</span>] +\
<a name="l00321"></a>00321                                   info_dico[<span class="stringliteral">&quot;failure_count&quot;</span>] + info_dico[<span class="stringliteral">&quot;filtered_count&quot;</span>]
<a name="l00322"></a>00322 
<a name="l00323"></a>00323                msg = <span class="stringliteral">&quot;{0} - /{1}/img {2:03}-{3:1d} - {4} - Galaxies successfully processed: &quot;</span>\
<a name="l00324"></a>00324                      <span class="stringliteral">&quot;{5}/{6} ({7}-{8}-{9}-{10}) - &lt;e1&gt;={11:+.9f} &lt;e2&gt;={12:+.9f} &lt;e&gt;={13:+.9f} - &quot;</span>\
<a name="l00325"></a>00325                      <span class="stringliteral">&quot;Total Processing time: {13:.3f} secs. ({15:.3f} hours)&quot;</span>
<a name="l00326"></a>00326                master.logger.log_info_p(msg.format(
<a name="l00327"></a>00327                   master.name, job.get_branch_tree(), job.img_no, 
<a name="l00328"></a>00328                   job.epoch,  file_type, 
<a name="l00329"></a>00329                   info_dico[<span class="stringliteral">&quot;success_count&quot;</span>], processed_count, <span class="comment"># info_dico[&quot;total_count&quot;], </span>
<a name="l00330"></a>00330                   info_dico[<span class="stringliteral">&quot;success_count&quot;</span>], info_dico[<span class="stringliteral">&quot;warning_count&quot;</span>], 
<a name="l00331"></a>00331                   info_dico[<span class="stringliteral">&quot;failure_count&quot;</span>], info_dico[<span class="stringliteral">&quot;filtered_count&quot;</span>], 
<a name="l00332"></a>00332                   mean_e1, mean_e2, mean_e, elapsed_time, hours))
<a name="l00333"></a>00333 
<a name="l00334"></a>00334                avg_time_per_gal = elapsed_time / processed_count
<a name="l00335"></a>00335 
<a name="l00336"></a>00336                master.logger.log_info_p(<span class="stringliteral">&quot;{0} - /{1}/img {2:03}-{3:1d} - {4} - &quot;</span>\
<a name="l00337"></a>00337                                         <span class="stringliteral">&quot;Average time per galaxy: {5:.2f} secs.&quot;</span>.format(
<a name="l00338"></a>00338                             master.name, job.get_branch_tree(), job.img_no, 
<a name="l00339"></a>00339                             job.epoch,  file_type, avg_time_per_gal))
<a name="l00340"></a>00340             <span class="keywordflow">else</span>:
<a name="l00341"></a>00341                msg = <span class="stringliteral">&quot;{0} - /{1}/img {2:03}-{3:1d} - {4} - &quot;</span>\
<a name="l00342"></a>00342                      <span class="stringliteral">&quot;None of the galaxies could be succcessfully processed - &quot;</span>\
<a name="l00343"></a>00343                      <span class="stringliteral">&quot;Total Processing time: {5:.3f} secs. ({6:.3f} hours)&quot;</span>
<a name="l00344"></a>00344                master.logger.log_info_p(msg.format(
<a name="l00345"></a>00345                   master.name, job.get_branch_tree(), job.img_no, 
<a name="l00346"></a>00346                   job.epoch,  file_type, elapsed_time, hours))
<a name="l00347"></a>00347 
<a name="l00348"></a>00348                master.logger.flush()
<a name="l00349"></a>00349 
<a name="l00350"></a>00350          <span class="comment"># --- Save the shape measurement results for this job</span>
<a name="l00351"></a>00351          self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#ad5bc8c8641ce54ff91b8f3dc6f583b66" title="Create a catalog with the columns: ID, e1, e2 in SE text format.">_create_result_catalog</a>(result_dico, error_dico, filter_dico, info_dico, job, master)
<a name="l00352"></a>00352 
<a name="l00353"></a>00353          <span class="keywordflow">if</span> master.config.get_as_boolean(<span class="stringliteral">&quot;DUMP_COLLECTED_DATA&quot;</span>, <span class="stringliteral">&quot;DATA_COLLECTION&quot;</span>):
<a name="l00354"></a>00354 
<a name="l00355"></a>00355             <span class="comment"># --- Create a catalog that includes all collected data for this job</span>
<a name="l00356"></a>00356             output_result_data_directory = os.path.join(master.result_output_dir, 
<a name="l00357"></a>00357                                                         job.get_branch_tree())
<a name="l00358"></a>00358             output_error_data_directory  = os.path.join(master.error_output_dir, 
<a name="l00359"></a>00359                                                         job.get_branch_tree())
<a name="l00360"></a>00360 
<a name="l00361"></a>00361             data_file_prefix_main, data_file_prefix_main_ext = os.path.splitext(file_type)
<a name="l00362"></a>00362             output_result_data_filename = <span class="stringliteral">&quot;data_{0}-{1:03}.txt&quot;</span>.format(data_file_prefix_main, 
<a name="l00363"></a>00363                                                                        job.img_no)
<a name="l00364"></a>00364             output_error_data_filename = <span class="stringliteral">&quot;errors_{0}_{1:03}.txt&quot;</span>.format(
<a name="l00365"></a>00365                                      <span class="stringliteral">&quot;_&quot;</span>.join(job.branch_dirs), job.img_no)
<a name="l00366"></a>00366             output_filtered_data_filename = <span class="stringliteral">&quot;filtered_{0}-{1:03}.txt&quot;</span>.format(
<a name="l00367"></a>00367                                      <span class="stringliteral">&quot;_&quot;</span>.join(job.branch_dirs), job.img_no)
<a name="l00368"></a>00368 
<a name="l00369"></a>00369             self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a7a87599123a042c6d1c84a7b4be724a5" title="Create a catalog containing all data collected during shape measurement for this job.">_dump_all_collected_data</a>(result_dico, error_dico, filter_dico, model_dico, 
<a name="l00370"></a>00370                                           output_result_data_directory, output_result_data_filename,  
<a name="l00371"></a>00371                                           job, master)
<a name="l00372"></a>00372 
<a name="l00373"></a>00373             <span class="keywordflow">if</span> len(error_dico[<span class="stringliteral">&quot;GAL_id&quot;</span>]) &gt; 0:
<a name="l00374"></a>00374                self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a7a87599123a042c6d1c84a7b4be724a5" title="Create a catalog containing all data collected during shape measurement for this job.">_dump_all_collected_data</a>(error_dico, error_dico, filter_dico, model_dico,
<a name="l00375"></a>00375                                              output_error_data_directory, 
<a name="l00376"></a>00376                                              output_error_data_filename, job, master)
<a name="l00377"></a>00377 
<a name="l00378"></a>00378             <span class="keywordflow">if</span> len(filter_dico[<span class="stringliteral">&quot;GAL_id&quot;</span>]) &gt; 0:
<a name="l00379"></a>00379                self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a7a87599123a042c6d1c84a7b4be724a5" title="Create a catalog containing all data collected during shape measurement for this job.">_dump_all_collected_data</a>(filter_dico, error_dico, filter_dico, model_dico,
<a name="l00380"></a>00380                                              output_error_data_directory, 
<a name="l00381"></a>00381                                              output_filtered_data_filename, job, master)
<a name="l00382"></a>00382 
<a name="l00383"></a>00383          <span class="comment"># --- Summary plots at job level</span>
<a name="l00384"></a>00384          <span class="keywordflow">if</span> master.config.get_as_boolean(<span class="stringliteral">&quot;PLOT_COLLECTED_DATA&quot;</span>, <span class="stringliteral">&quot;DATA_COLLECTION&quot;</span>):
<a name="l00385"></a>00385             self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a76497570864a2e798c9a1cc5206787d3">plotter</a>.create_image_plots(object_per_type_dico, file_type, job, master)         
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 
<a name="l00388"></a>00388    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00389"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a45c99ab832871f37626a634ded62da0d">00389</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a45c99ab832871f37626a634ded62da0d" title="This method is called by the Master once all the jobs have been processed.">all_jobs_processed</a>(self, master):
<a name="l00390"></a>00390       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00391"></a>00391 <span class="stringliteral">         This method is called by the Master once all the jobs have been processed. </span>
<a name="l00392"></a>00392 <span class="stringliteral">         @param master instance of the Master</span>
<a name="l00393"></a>00393 <span class="stringliteral"></span>
<a name="l00394"></a>00394 <span class="stringliteral">         @code  </span>
<a name="l00395"></a>00395 <span class="stringliteral">         Job results can be selectively obtained from: self.job_result_dico, e.g.: </span>
<a name="l00396"></a>00396 <span class="stringliteral">         print(self.job_result_dico.items()) # =&gt; all (key,value) pairs in the dico</span>
<a name="l00397"></a>00397 <span class="stringliteral">         print(self.job_result_dico[&quot;control&quot;].values()) # =&gt; all values in branch &quot;/control&quot;</span>
<a name="l00398"></a>00398 <span class="stringliteral">         print(self.job_result_dico[&quot;control&quot;][&quot;ground&quot;].values())  # =&gt; all values in &quot;/control/ground&quot;</span>
<a name="l00399"></a>00399 <span class="stringliteral">         print(self.job_result_dico[&quot;control&quot;][&quot;ground&quot;][&quot;constant&quot;].values()) # =&gt; all values in &quot;/control/ground/constant&quot;</span>
<a name="l00400"></a>00400 <span class="stringliteral">         print(self.job_result_dico[&quot;control&quot;][&quot;ground&quot;][&quot;constant&quot;][0]) # =&gt; job results for img_0 in &quot;/control/ground/constant&quot;g_0  </span>
<a name="l00401"></a>00401 <span class="stringliteral">         @endcode</span>
<a name="l00402"></a>00402 <span class="stringliteral">         @note Job results can be obtained with by accessing propertyies job_result_list and </span>
<a name="l00403"></a>00403 <span class="stringliteral">               job_result_dico</span>
<a name="l00404"></a>00404 <span class="stringliteral">         @see Job, JobResult, MpfxJobResult</span>
<a name="l00405"></a>00405 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00406"></a>00406 
<a name="l00407"></a>00407 
<a name="l00408"></a>00408 <span class="comment">#      # --- Compute and generate statistics per branch</span>
<a name="l00409"></a>00409 
<a name="l00410"></a>00410 <span class="comment">#      #print &quot;#############&quot;, self.job_result_dico</span>
<a name="l00411"></a>00411       <span class="keywordflow">for</span> branch_tree <span class="keywordflow">in</span> self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a5bf280dff05fe812d3ba0019806b48c4">_get_selected_branches</a>(master):
<a name="l00412"></a>00412          branch_job_results = self.get_job_results(branch=branch_tree)
<a name="l00413"></a>00413 
<a name="l00414"></a>00414          branch_id = branch_tree.replace(<span class="stringliteral">&quot;/&quot;</span>, <span class="stringliteral">&quot;_&quot;</span>) 
<a name="l00415"></a>00415 
<a name="l00416"></a>00416          <span class="keywordflow">if</span> master.logging_enabled():
<a name="l00417"></a>00417             master.logger.log_info_p(
<a name="l00418"></a>00418               <span class="stringliteral">&quot;{0} - {1} - Generating statistics...&quot;</span>.format(master, branch_id))
<a name="l00419"></a>00419 
<a name="l00420"></a>00420          self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a419a9ecc87ab03551e97d549d45146fa">_generate_result_statistics</a>(<span class="stringliteral">&quot;result&quot;</span>, 
<a name="l00421"></a>00421                                           branch_id, branch_tree, branch_job_results, master)
<a name="l00422"></a>00422          self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a419a9ecc87ab03551e97d549d45146fa">_generate_result_statistics</a>(<span class="stringliteral">&quot;error&quot;</span>, 
<a name="l00423"></a>00423                                           branch_id, branch_tree, branch_job_results, master)
<a name="l00424"></a>00424          self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a419a9ecc87ab03551e97d549d45146fa">_generate_result_statistics</a>(<span class="stringliteral">&quot;filtered&quot;</span>, 
<a name="l00425"></a>00425                                           branch_id, branch_tree, branch_job_results, master)
<a name="l00426"></a>00426 
<a name="l00427"></a>00427 
<a name="l00428"></a>00428    <span class="comment"># ~~~~~~~~~~~~~~~</span>
<a name="l00429"></a>00429    <span class="comment"># Private methods </span>
<a name="l00430"></a>00430    <span class="comment"># ~~~~~~~~~~~~~~~</span>
<a name="l00431"></a>00431 
<a name="l00432"></a>00432    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00433"></a>00433    <span class="keyword">def </span>_create_dir_tree(self, base_dir, branches):
<a name="l00434"></a>00434       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00435"></a>00435 <span class="stringliteral">         Create the directory tree for storing the results.</span>
<a name="l00436"></a>00436 <span class="stringliteral">         @param base_dir base directory</span>
<a name="l00437"></a>00437 <span class="stringliteral">         @param branches list of ordered directory names, making a path tree</span>
<a name="l00438"></a>00438 <span class="stringliteral">         @note example of directory layout: control/ground/constant</span>
<a name="l00439"></a>00439 <span class="stringliteral">         @see configuration file</span>
<a name="l00440"></a>00440 <span class="stringliteral">      &quot;&quot;&quot;</span>      
<a name="l00441"></a>00441 
<a name="l00442"></a>00442       <span class="keywordflow">for</span> branch <span class="keywordflow">in</span> branches:
<a name="l00443"></a>00443          dir_names = branch.split(<span class="stringliteral">&quot;/&quot;</span>)
<a name="l00444"></a>00444          branch_path = base_dir
<a name="l00445"></a>00445          <span class="keywordflow">for</span> dir_name <span class="keywordflow">in</span> dir_names:
<a name="l00446"></a>00446             branch_path = os.path.join(branch_path, dir_name)
<a name="l00447"></a>00447             self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a6792fa9aee819fe6ea18195e42a5ad09">helper</a>.make_dir(branch_path)
<a name="l00448"></a>00448 
<a name="l00449"></a>00449    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00450"></a>00450    <span class="keyword">def </span>_create_result_catalog(self, result_dico, error_dico, filter_dico, info_dico, job, master):
<a name="l00451"></a>00451       <span class="stringliteral">&quot;&quot;&quot;! Create a catalog with the columns: ID, e1, e2 in SE text format &quot;&quot;&quot;</span>            
<a name="l00452"></a>00452 
<a name="l00453"></a>00453       <span class="comment"># --- Create a submission result catalog, marking failed ellipticity values </span>
<a name="l00454"></a>00454       <span class="comment">#     with a constant &gt;= 10</span>
<a name="l00455"></a>00455       failed_marking_value = master.config.get_as_float(<span class="stringliteral">&quot;FAILED_ELLIPTICITY_VALUE&quot;</span>, 
<a name="l00456"></a>00456                                                         <span class="stringliteral">&quot;SHAPE_MEASUREMENT&quot;</span>)
<a name="l00457"></a>00457 
<a name="l00458"></a>00458       output_filename = <span class="stringliteral">&quot;results_{0}-{1:03}.txt&quot;</span>.format(<span class="stringliteral">&quot;_&quot;</span>.join(job.branch_dirs), job.img_no)
<a name="l00459"></a>00459       output_directory = os.path.join(master.result_output_dir, job.get_branch_tree())
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 
<a name="l00462"></a>00462       col_list = [<span class="stringliteral">&quot;Gal_id&quot;</span>, <span class="stringliteral">&quot;e1&quot;</span>, <span class="stringliteral">&quot;e2&quot;</span>, <span class="stringliteral">&quot;weight&quot;</span>, <span class="stringliteral">&quot;GAL_Xc&quot;</span>, <span class="stringliteral">&quot;GAL_Yc&quot;</span>, <span class="stringliteral">&quot;GAL_RA&quot;</span>, <span class="stringliteral">&quot;GAL_DEC&quot;</span>]
<a name="l00463"></a>00463       col_key_map = {<span class="stringliteral">&quot;GAL_id&quot;</span>:0, <span class="stringliteral">&quot;e1&quot;</span>:1, <span class="stringliteral">&quot;e2&quot;</span>:2, <span class="stringliteral">&quot;weight&quot;</span>:3,\
<a name="l00464"></a>00464                      <span class="stringliteral">&quot;GAL_Xc&quot;</span>:4, <span class="stringliteral">&quot;GAL_Yc&quot;</span>:5, <span class="stringliteral">&quot;GAL_RA&quot;</span>:6, <span class="stringliteral">&quot;GAL_DEC&quot;</span>:7}
<a name="l00465"></a>00465       col_fmt_map = {<span class="stringliteral">&quot;GAL_id&quot;</span>:<span class="stringliteral">&quot;%d&quot;</span>, <span class="stringliteral">&quot;e1&quot;</span>:<span class="stringliteral">&quot;%15.15f&quot;</span>,<span class="stringliteral">&quot;e2&quot;</span>:<span class="stringliteral">&quot;%15.15f&quot;</span>, <span class="stringliteral">&quot;weight&quot;</span>:<span class="stringliteral">&quot;%4.3f&quot;</span>,\
<a name="l00466"></a>00466                      <span class="stringliteral">&quot;GAL_Xc&quot;</span>:<span class="stringliteral">&quot;%9.6f&quot;</span>, <span class="stringliteral">&quot;GAL_Yc&quot;</span>:<span class="stringliteral">&quot;%9.6f&quot;</span>, <span class="stringliteral">&quot;GAL_RA&quot;</span>:<span class="stringliteral">&quot;%15.15f&quot;</span>, <span class="stringliteral">&quot;GAL_DEC&quot;</span>:<span class="stringliteral">&quot;%15.15f&quot;</span>}
<a name="l00467"></a>00467 
<a name="l00468"></a>00468       sub_result_dico = deepcopy(result_dico)   <span class="comment"># Note: a deep copy is required here, otherwise  </span>
<a name="l00469"></a>00469                                                 <span class="comment">#       result_dico gets updated as well</span>
<a name="l00470"></a>00470             
<a name="l00471"></a>00471       nb_unprocessed_ids = len(info_dico[<span class="stringliteral">&quot;unprocessed_ids&quot;</span>])
<a name="l00472"></a>00472 
<a name="l00473"></a>00473       sub_result_dico[<span class="stringliteral">&quot;GAL_id&quot;</span>].extend(info_dico[<span class="stringliteral">&quot;unprocessed_ids&quot;</span>])
<a name="l00474"></a>00474       sub_result_dico[<span class="stringliteral">&quot;e1&quot;</span>].extend(numpy.repeat(failed_marking_value, nb_unprocessed_ids))      
<a name="l00475"></a>00475       sub_result_dico[<span class="stringliteral">&quot;e2&quot;</span>].extend(numpy.repeat(failed_marking_value, nb_unprocessed_ids))      
<a name="l00476"></a>00476       sub_result_dico[<span class="stringliteral">&quot;weight&quot;</span>].extend(numpy.repeat(0.0, nb_unprocessed_ids))      
<a name="l00477"></a>00477 
<a name="l00478"></a>00478       <span class="keywordflow">if</span> <span class="stringliteral">&quot;GAL_Xc&quot;</span> <span class="keywordflow">in</span> sub_result_dico <span class="keywordflow">and</span> <span class="stringliteral">&quot;GAL_Yc&quot;</span> <span class="keywordflow">in</span> sub_result_dico: 
<a name="l00479"></a>00479          sub_result_dico[<span class="stringliteral">&quot;GAL_Xc&quot;</span>].extend(info_dico[<span class="stringliteral">&quot;unprocessed_GAL_Xc&quot;</span>])
<a name="l00480"></a>00480          sub_result_dico[<span class="stringliteral">&quot;GAL_Yc&quot;</span>].extend(info_dico[<span class="stringliteral">&quot;unprocessed_GAL_Yc&quot;</span>])
<a name="l00481"></a>00481       <span class="keywordflow">if</span> <span class="stringliteral">&quot;GAL_RA&quot;</span> <span class="keywordflow">in</span> sub_result_dico <span class="keywordflow">and</span><span class="stringliteral">&quot;GAL_DEC&quot;</span> <span class="keywordflow">in</span> sub_result_dico: 
<a name="l00482"></a>00482          sub_result_dico[<span class="stringliteral">&quot;GAL_RA&quot;</span>].extend(info_dico[<span class="stringliteral">&quot;unprocessed_GAL_RA&quot;</span>])
<a name="l00483"></a>00483          sub_result_dico[<span class="stringliteral">&quot;GAL_DEC&quot;</span>].extend(info_dico[<span class="stringliteral">&quot;unprocessed_GAL_DEC&quot;</span>])
<a name="l00484"></a>00484 
<a name="l00485"></a>00485       self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a6792fa9aee819fe6ea18195e42a5ad09">helper</a>.save_from_list_dico(sub_result_dico, output_directory, output_filename, col_list,
<a name="l00486"></a>00486                                       key_index_map=col_key_map, key_fmt_map=col_fmt_map)
<a name="l00487"></a>00487 
<a name="l00488"></a>00488       <span class="comment"># --- Create a unfiltered catalog if required</span>
<a name="l00489"></a>00489       <span class="keywordflow">if</span> len(filter_dico[<span class="stringliteral">&quot;GAL_id&quot;</span>]) &gt; 0:
<a name="l00490"></a>00490 
<a name="l00491"></a>00491          <span class="comment"># --- Also Create a result catalog, without &quot;failed&quot; values but keeping all &quot;filtered&quot; values</span>
<a name="l00492"></a>00492          output_filename = <span class="stringliteral">&quot;results_unfiltered_{0}-{1:03}.txt&quot;</span>.format(<span class="stringliteral">&quot;_&quot;</span>.join(job.branch_dirs), job.img_no)
<a name="l00493"></a>00493 
<a name="l00494"></a>00494           <span class="comment"># --- A deep copy is required here, otherwise result_dico gets updated as well</span>
<a name="l00495"></a>00495          result_unfiltered_dico = deepcopy(sub_result_dico)
<a name="l00496"></a>00496 
<a name="l00497"></a>00497          <span class="keywordflow">if</span> failed_marking_value <span class="keywordflow">in</span> sub_result_dico[<span class="stringliteral">&quot;e1&quot;</span>] <span class="keywordflow">or</span> failed_marking_value <span class="keywordflow">in</span> sub_result_dico[<span class="stringliteral">&quot;e2&quot;</span>]:
<a name="l00498"></a>00498 
<a name="l00499"></a>00499             <span class="keywordflow">for</span> (ID, e1) <span class="keywordflow">in</span> zip(filter_dico[<span class="stringliteral">&quot;GAL_id&quot;</span>], filter_dico[<span class="stringliteral">&quot;e1&quot;</span>]):
<a name="l00500"></a>00500                result_unfiltered_dico[<span class="stringliteral">&quot;e1&quot;</span>][sub_result_dico[<span class="stringliteral">&quot;GAL_id&quot;</span>].index(ID)] = e1       
<a name="l00501"></a>00501       
<a name="l00502"></a>00502             <span class="keywordflow">for</span> (ID, e2) <span class="keywordflow">in</span> zip(filter_dico[<span class="stringliteral">&quot;GAL_id&quot;</span>], filter_dico[<span class="stringliteral">&quot;e2&quot;</span>]):
<a name="l00503"></a>00503                result_unfiltered_dico[<span class="stringliteral">&quot;e2&quot;</span>][sub_result_dico[<span class="stringliteral">&quot;GAL_id&quot;</span>].index(ID)] = e2 
<a name="l00504"></a>00504 
<a name="l00505"></a>00505          <span class="comment"># --- Create the result &quot;unfiltered&quot; catalog</span>
<a name="l00506"></a>00506          self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a6792fa9aee819fe6ea18195e42a5ad09">helper</a>.save_from_list_dico(result_unfiltered_dico, 
<a name="l00507"></a>00507                                          output_directory, output_filename, col_list,
<a name="l00508"></a>00508                                          key_index_map=col_key_map, key_fmt_map=col_fmt_map)
<a name="l00509"></a>00509 
<a name="l00510"></a>00510 
<a name="l00511"></a>00511    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00512"></a>00512    <span class="keyword">def </span>_generate_result_statistics(self, data_tag, branch_id, branch_tree, branch_results, master):
<a name="l00513"></a>00513 
<a name="l00514"></a>00514 
<a name="l00515"></a>00515       <span class="comment"># --- Where to store the statistics file</span>
<a name="l00516"></a>00516       stats_output_dir = os.path.join(master.stat_output_dir, branch_tree)
<a name="l00517"></a>00517       output_filename = <span class="stringliteral">&quot;stats_{0}_{1}.txt&quot;</span>.format(data_tag, branch_id)             
<a name="l00518"></a>00518       output_filepath = os.path.join(stats_output_dir, output_filename) 
<a name="l00519"></a>00519 
<a name="l00520"></a>00520       <span class="comment"># --- Variables we do not want statistics on </span>
<a name="l00521"></a>00521       except_list = [<span class="stringliteral">&quot;GAL_id&quot;</span>, <span class="stringliteral">&quot;flag&quot;</span>, <span class="stringliteral">&quot;weight&quot;</span>,\
<a name="l00522"></a>00522                      <span class="comment">#&quot;xc&quot;, &quot;yc&quot;,\</span>
<a name="l00523"></a>00523                      <span class="stringliteral">&quot;gal_Xc&quot;</span>, <span class="stringliteral">&quot;gal_Yc&quot;</span>, <span class="stringliteral">&quot;psf_Xc&quot;</span>, <span class="stringliteral">&quot;psf_Yc&quot;</span>,\
<a name="l00524"></a>00524                      <span class="stringliteral">&quot;GAL_Xc&quot;</span>, <span class="stringliteral">&quot;GAL_Yc&quot;</span>,\
<a name="l00525"></a>00525                      <span class="stringliteral">&quot;GAL_RA&quot;</span>,<span class="stringliteral">&quot;GAL_DEC&quot;</span>
<a name="l00526"></a>00526                     ]
<a name="l00527"></a>00527 
<a name="l00528"></a>00528       with open(output_filepath, <span class="stringliteral">&quot;a&quot;</span>) <span class="keyword">as</span> fd:
<a name="l00529"></a>00529 
<a name="l00530"></a>00530          title = <span class="stringliteral">&quot;SUMMARY STATISTICS - Branch: {0}\n&quot;</span>.format(branch_tree)
<a name="l00531"></a>00531          fd.write(title)
<a name="l00532"></a>00532          fd.write(<span class="stringliteral">&quot;=&quot;</span> * len(title) + <span class="stringliteral">&quot;\n&quot;</span>)         
<a name="l00533"></a>00533 
<a name="l00534"></a>00534          <span class="comment"># --- Global stats   </span>
<a name="l00535"></a>00535          global_data_dico = {}
<a name="l00536"></a>00536          global_data_dico[data_tag] = {}
<a name="l00537"></a>00537 
<a name="l00538"></a>00538          var_list = []
<a name="l00539"></a>00539 
<a name="l00540"></a>00540          <span class="comment"># --- Compute statistics for the branch and generate the corresponding files </span>
<a name="l00541"></a>00541          job_results = sorted(branch_results, key=attrgetter(<span class="stringliteral">&#39;job.img_no&#39;</span>))
<a name="l00542"></a>00542          <span class="keywordflow">for</span> job_result <span class="keywordflow">in</span> job_results:
<a name="l00543"></a>00543 
<a name="l00544"></a>00544             job = job_result.job
<a name="l00545"></a>00545             object_per_type_dico = job_result.result
<a name="l00546"></a>00546 
<a name="l00547"></a>00547             <span class="keywordflow">for</span> file_type <span class="keywordflow">in</span> object_per_type_dico.keys():
<a name="l00548"></a>00548 
<a name="l00549"></a>00549                <span class="keywordflow">if</span> <span class="keywordflow">not</span> file_type <span class="keywordflow">in</span> object_per_type_dico[file_type]:
<a name="l00550"></a>00550                   object_per_type_dico[file_type][<span class="stringliteral">&quot;stats&quot;</span>] = {}
<a name="l00551"></a>00551 
<a name="l00552"></a>00552                <span class="comment"># --- Variables we do want statistics on: model params, SE_*, extra fitting info</span>
<a name="l00553"></a>00553                data_dico  = object_per_type_dico[file_type][data_tag]
<a name="l00554"></a>00554 
<a name="l00555"></a>00555                <span class="comment"># --- Renmoved failed fits    </span>
<a name="l00556"></a>00556                data_dico = deepcopy(data_dico)
<a name="l00557"></a>00557                data_dico = self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a6792fa9aee819fe6ea18195e42a5ad09">helper</a>.remove_failed_fits_from_result_dico(data_dico, master)
<a name="l00558"></a>00558                data_dico = self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a6792fa9aee819fe6ea18195e42a5ad09">helper</a>.remove_nans_from_result_dico(data_dico, master)    
<a name="l00559"></a>00559 
<a name="l00560"></a>00560                model_dico = object_per_type_dico[file_type][<span class="stringliteral">&quot;model&quot;</span>]
<a name="l00561"></a>00561                var_list = model_dico[<span class="stringliteral">&quot;param_names&quot;</span>]
<a name="l00562"></a>00562 
<a name="l00563"></a>00563                image_label = <span class="stringliteral">&#39;\n--------------- {0} - {1:03d} ---------------\n\n&#39;</span>.format(
<a name="l00564"></a>00564                                                                             file_type, job.img_no)
<a name="l00565"></a>00565 
<a name="l00566"></a>00566                object_per_type_dico[file_type][<span class="stringliteral">&quot;stats&quot;</span>][data_tag], var_list = \
<a name="l00567"></a>00567                           self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a856aab04605ab0caef9a7b91dd30790b">_compute_and_dump_stats</a>(fd, 
<a name="l00568"></a>00568                                                        var_list,  
<a name="l00569"></a>00569                                                        data_dico,
<a name="l00570"></a>00570                                                        data_tag, image_label, 
<a name="l00571"></a>00571                                                        except_list, 
<a name="l00572"></a>00572                                                        job, master)
<a name="l00573"></a>00573 
<a name="l00574"></a>00574                <span class="comment"># --- Compute and dump global stats </span>
<a name="l00575"></a>00575                <span class="keywordflow">if</span> len(object_per_type_dico[file_type][<span class="stringliteral">&quot;stats&quot;</span>][data_tag]) &gt; 0:
<a name="l00576"></a>00576 
<a name="l00577"></a>00577                   <span class="keywordflow">for</span> var <span class="keywordflow">in</span> var_list:
<a name="l00578"></a>00578                      <span class="keywordflow">if</span> var <span class="keywordflow">in</span> data_dico:
<a name="l00579"></a>00579                         <span class="keywordflow">if</span> <span class="keywordflow">not</span> var <span class="keywordflow">in</span> global_data_dico[data_tag]:
<a name="l00580"></a>00580                            global_data_dico[data_tag][var] = []
<a name="l00581"></a>00581                         global_data_dico[data_tag][var].extend(data_dico[var])
<a name="l00582"></a>00582                   <span class="comment">#print &quot;###global_data_dico:&quot;, global_data_dico</span>
<a name="l00583"></a>00583 
<a name="l00584"></a>00584          <span class="comment"># --- Dump global stats</span>
<a name="l00585"></a>00585          image_label = <span class="stringliteral">&#39;\n---------------------------- All ----------------------------\n\n&#39;</span>
<a name="l00586"></a>00586 
<a name="l00587"></a>00587          self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a856aab04605ab0caef9a7b91dd30790b">_compute_and_dump_stats</a>(fd, 
<a name="l00588"></a>00588                                        var_list,  
<a name="l00589"></a>00589                                        global_data_dico[data_tag],
<a name="l00590"></a>00590                                        data_tag, image_label,
<a name="l00591"></a>00591                                        except_list, 
<a name="l00592"></a>00592                                        job, master)
<a name="l00593"></a>00593 
<a name="l00594"></a>00594          fd.write(<span class="stringliteral">&quot;\n=== EOF ===&quot;</span>)
<a name="l00595"></a>00595          
<a name="l00596"></a>00596    
<a name="l00597"></a>00597       <span class="keywordflow">return</span> object_per_type_dico
<a name="l00598"></a>00598 
<a name="l00599"></a>00599 
<a name="l00600"></a>00600 
<a name="l00601"></a>00601    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00602"></a>00602    <span class="keyword">def </span>_compute_and_dump_stats(self, fd, var_list, data_dico, 
<a name="l00603"></a>00603                                      data_tag, image_label, except_list, job, master):
<a name="l00604"></a>00604 
<a name="l00605"></a>00605       stats_dico = {}
<a name="l00606"></a>00606       stats_dico[data_tag] = {}
<a name="l00607"></a>00607 
<a name="l00608"></a>00608       <span class="comment"># --- If there are data available...</span>
<a name="l00609"></a>00609       <span class="keywordflow">if</span> <span class="stringliteral">&quot;iobj&quot;</span> <span class="keywordflow">in</span> data_dico <span class="keywordflow">and</span> len(data_dico[<span class="stringliteral">&quot;iobj&quot;</span>]) &gt; 0:
<a name="l00610"></a>00610 
<a name="l00611"></a>00611          <span class="comment"># --- Which variables to compute statistics on</span>
<a name="l00612"></a>00612          se_var_list = [var <span class="keywordflow">for</span> var <span class="keywordflow">in</span> data_dico.keys() \
<a name="l00613"></a>00613                         <span class="keywordflow">if</span> <span class="keywordflow">not</span> var <span class="keywordflow">in</span> var_list \
<a name="l00614"></a>00614                         <span class="keywordflow">and</span> <span class="keywordflow">not</span> var <span class="keywordflow">in</span> except_list <span class="keywordflow">and</span> var.startswith(<span class="stringliteral">&quot;SE_&quot;</span>)]
<a name="l00615"></a>00615          var_list.extend(se_var_list)
<a name="l00616"></a>00616          var_list.extend([var <span class="keywordflow">for</span> var <span class="keywordflow">in</span> data_dico.keys() \
<a name="l00617"></a>00617                           <span class="keywordflow">if</span> <span class="keywordflow">not</span> var <span class="keywordflow">in</span> var_list \
<a name="l00618"></a>00618                           <span class="keywordflow">and</span> <span class="keywordflow">not</span> var <span class="keywordflow">in</span> except_list <span class="keywordflow">and</span> <span class="keywordflow">not</span> var <span class="keywordflow">in</span> se_var_list])
<a name="l00619"></a>00619 
<a name="l00620"></a>00620          fd.write(image_label)
<a name="l00621"></a>00621 
<a name="l00622"></a>00622          <span class="comment"># --- Compute summary stats, populate stats_dico</span>
<a name="l00623"></a>00623          stats_dico = self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a8ab1dfc9f3f83663a4c5d65d3da44b73" title="Compute summary statistics on input data.">_compute_summary_statistics</a>(data_dico, var_list, job, master)
<a name="l00624"></a>00624 
<a name="l00625"></a>00625          <span class="comment"># --- Dump stats values</span>
<a name="l00626"></a>00626          <span class="keywordflow">for</span> var <span class="keywordflow">in</span> var_list:
<a name="l00627"></a>00627             fd.write(<span class="stringliteral">&quot;{0:&lt;20}: &quot;</span>.format(var))
<a name="l00628"></a>00628             <span class="keywordflow">for</span> qoper <span class="keywordflow">in</span> sorted(stats_dico[var].keys()):
<a name="l00629"></a>00629                fd.write(<span class="stringliteral">&quot;{0} = {1:+.6e}  &quot;</span>.format(qoper.replace(<span class="stringliteral">&quot;numpy.&quot;</span>, <span class="stringliteral">&quot;&quot;</span>), 
<a name="l00630"></a>00630                                                   stats_dico[var][qoper]))
<a name="l00631"></a>00631             fd.write(<span class="stringliteral">&quot;\n&quot;</span>) 
<a name="l00632"></a>00632 
<a name="l00633"></a>00633       <span class="keywordflow">return</span> stats_dico, var_list
<a name="l00634"></a>00634 
<a name="l00635"></a>00635 
<a name="l00636"></a>00636    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00637"></a>00637    <span class="keyword">def </span>_compute_summary_statistics(self, result_dico, var_list, job, master):
<a name="l00638"></a>00638       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00639"></a>00639 <span class="stringliteral">         Compute summary statistics on input data </span>
<a name="l00640"></a>00640 <span class="stringliteral">         @param result_dico dictionary with data arrays on which to compute statistics </span>
<a name="l00641"></a>00641 <span class="stringliteral">         @param car_list list of keys in the data dictionary that represents the stat. variables </span>
<a name="l00642"></a>00642 <span class="stringliteral">         @param job an object of class GfitJob to process</span>
<a name="l00643"></a>00643 <span class="stringliteral">         @param worker instance of the master or a worker process      </span>
<a name="l00644"></a>00644 <span class="stringliteral">         @return dictionary with summary statistics</span>
<a name="l00645"></a>00645 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00646"></a>00646 
<a name="l00647"></a>00647       <span class="comment"># --- Compute stats and update the input data dictionary</span>
<a name="l00648"></a>00648       stats_dico = {}
<a name="l00649"></a>00649 
<a name="l00650"></a>00650       <span class="comment"># --- Statistical operations to apply </span>
<a name="l00651"></a>00651       qoper_tuples = [(<span class="stringliteral">&quot;numpy.size&quot;</span>, numpy.size), (<span class="stringliteral">&quot;numpy.sum&quot;</span>, numpy.sum), \
<a name="l00652"></a>00652                       (<span class="stringliteral">&quot;numpy.min&quot;</span>, numpy.min),   (<span class="stringliteral">&quot;numpy.max&quot;</span>, numpy.max), \
<a name="l00653"></a>00653                       (<span class="stringliteral">&quot;numpy.mean&quot;</span>, numpy.mean), (<span class="stringliteral">&quot;numpy.median&quot;</span>, numpy.median), \
<a name="l00654"></a>00654                       (<span class="stringliteral">&quot;numpy.std&quot;</span>, numpy.std)]
<a name="l00655"></a>00655 
<a name="l00656"></a>00656       <span class="comment"># --- Compute statistics and create a dictionary with keys variable and sub-keys operation</span>
<a name="l00657"></a>00657       <span class="keywordflow">for</span> qvar <span class="keywordflow">in</span> var_list:
<a name="l00658"></a>00658          stats_dico[qvar] = {}
<a name="l00659"></a>00659          <span class="keywordflow">for</span> (qlabel, qoper) <span class="keywordflow">in</span> qoper_tuples:
<a name="l00660"></a>00660             stats_dico[qvar][qlabel] = eval(<span class="stringliteral">&quot;qoper(result_dico[qvar])&quot;</span>)
<a name="l00661"></a>00661 
<a name="l00662"></a>00662       <span class="keywordflow">return</span> stats_dico
<a name="l00663"></a>00663 
<a name="l00664"></a>00664    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00665"></a>00665    <span class="keyword">def </span>_dump_all_collected_data(self, result_dico, error_dico, filter_dico, model_dico, 
<a name="l00666"></a>00666                                       output_directory, output_filename, job, master):
<a name="l00667"></a>00667       <span class="stringliteral">&quot;&quot;&quot;! Create a catalog containing all data collected during shape measurement for this job &quot;&quot;&quot;</span>            
<a name="l00668"></a>00668 
<a name="l00669"></a>00669 
<a name="l00670"></a>00670       <span class="comment"># --- Build column list</span>
<a name="l00671"></a>00671 
<a name="l00672"></a>00672       <span class="comment"># Essential parameters</span>
<a name="l00673"></a>00673       param_names = model_dico[<span class="stringliteral">&quot;param_names&quot;</span>]
<a name="l00674"></a>00674       col_list = [<span class="stringliteral">&quot;iobj&quot;</span>,<span class="stringliteral">&quot;GAL_id&quot;</span>, <span class="stringliteral">&quot;flag&quot;</span>, <span class="stringliteral">&quot;weight&quot;</span>, <span class="stringliteral">&quot;x0&quot;</span>, <span class="stringliteral">&quot;y0&quot;</span>]
<a name="l00675"></a>00675       col_list.extend(param_names)
<a name="l00676"></a>00676       col_list.extend([<span class="stringliteral">&quot;gal_Xc&quot;</span>, <span class="stringliteral">&quot;gal_Yc&quot;</span>, <span class="stringliteral">&quot;psf_Xc&quot;</span>, <span class="stringliteral">&quot;psf_Yc&quot;</span>,\
<a name="l00677"></a>00677                        <span class="stringliteral">&quot;GAL_Xc&quot;</span>, <span class="stringliteral">&quot;GAL_Yc&quot;</span>,\
<a name="l00678"></a>00678                      ])
<a name="l00679"></a>00679       col_key_map = dict(zip(col_list, list(numpy.arange(0, len(col_list)))))     
<a name="l00680"></a>00680       col_fmt_map = {<span class="stringliteral">&quot;iobj&quot;</span>:<span class="stringliteral">&quot;%d&quot;</span>,<span class="stringliteral">&quot;GAL_id&quot;</span>:<span class="stringliteral">&quot;%d&quot;</span>,<span class="stringliteral">&quot;flag&quot;</span>:<span class="stringliteral">&quot;%d&quot;</span>, <span class="stringliteral">&quot;weight&quot;</span>:<span class="stringliteral">&quot;%.2f&quot;</span>,\
<a name="l00681"></a>00681                      <span class="stringliteral">&quot;x0&quot;</span>:<span class="stringliteral">&quot;%9.3f&quot;</span>, <span class="stringliteral">&quot;y0&quot;</span>:<span class="stringliteral">&quot;%9.3f&quot;</span>, <span class="stringliteral">&quot;gal_Xc&quot;</span>:<span class="stringliteral">&quot;%9.3f&quot;</span>, <span class="stringliteral">&quot;gal_Yc&quot;</span>:<span class="stringliteral">&quot;%9.3f&quot;</span>,\
<a name="l00682"></a>00682                      <span class="stringliteral">&quot;psf_Xc&quot;</span>:<span class="stringliteral">&quot;%9.3f&quot;</span>, <span class="stringliteral">&quot;psf_Yc&quot;</span>:<span class="stringliteral">&quot;%9.3f&quot;</span>,\
<a name="l00683"></a>00683                      <span class="stringliteral">&quot;GAL_Xc&quot;</span>:<span class="stringliteral">&quot;%.18e&quot;</span>, <span class="stringliteral">&quot;GAL_Yc&quot;</span>:<span class="stringliteral">&quot;%.18e&quot;</span>,\
<a name="l00684"></a>00684                     }
<a name="l00685"></a>00685       col_fmt_map.update( dict( zip(param_names, [<span class="stringliteral">&quot;%15.9f&quot;</span>] * len(param_names)) ) )
<a name="l00686"></a>00686 
<a name="l00687"></a>00687       <span class="comment"># Extra parameters (non SExtractor)</span>
<a name="l00688"></a>00688       <span class="keywordflow">for</span> var <span class="keywordflow">in</span> result_dico.keys():
<a name="l00689"></a>00689          <span class="keywordflow">if</span> var <span class="keywordflow">in</span> col_list <span class="keywordflow">or</span> <span class="stringliteral">&quot;centroids&quot;</span> <span class="keywordflow">in</span> var <span class="keywordflow">or</span> <span class="stringliteral">&quot;SE_&quot;</span> <span class="keywordflow">in</span> var: 
<a name="l00690"></a>00690             <span class="keywordflow">continue</span>
<a name="l00691"></a>00691 
<a name="l00692"></a>00692          col_list.append(var)
<a name="l00693"></a>00693          col_fmt_map[var] = <span class="stringliteral">&quot;%15.9f&quot;</span>
<a name="l00694"></a>00694 
<a name="l00695"></a>00695       <span class="comment"># SExtractor variables</span>
<a name="l00696"></a>00696       <span class="keywordflow">for</span> var <span class="keywordflow">in</span> result_dico.keys():
<a name="l00697"></a>00697          <span class="keywordflow">if</span> <span class="stringliteral">&quot;centroids&quot;</span> <span class="keywordflow">in</span> var: 
<a name="l00698"></a>00698             <span class="keywordflow">continue</span>
<a name="l00699"></a>00699 
<a name="l00700"></a>00700          <span class="keywordflow">if</span> <span class="stringliteral">&quot;SE_&quot;</span> <span class="keywordflow">in</span> var:
<a name="l00701"></a>00701             col_list.append(var)
<a name="l00702"></a>00702             col_fmt_map[var] = <span class="stringliteral">&quot;%15.9f&quot;</span>
<a name="l00703"></a>00703    
<a name="l00704"></a>00704       <span class="comment">#for var in result_dico.keys():</span>
<a name="l00705"></a>00705       <span class="comment">#   print var, result_dico[var], len(result_dico[var])</span>
<a name="l00706"></a>00706 
<a name="l00707"></a>00707 <span class="comment">#      # Remove records with failed fits</span>
<a name="l00708"></a>00708 <span class="comment">#      result_dico_copy = deepcopy(result_dico)</span>
<a name="l00709"></a>00709 <span class="comment">#      result_dico_copy = self.helper._remove_failed_fits_from_result_dico(result_dico_copy, master)</span>
<a name="l00710"></a>00710 
<a name="l00711"></a>00711       <span class="comment"># --- Also record ellipticities of failed and filtered fits  </span>
<a name="l00712"></a>00712       result_dico_copy = deepcopy(result_dico)
<a name="l00713"></a>00713 
<a name="l00714"></a>00714       failed_marking_value = master.config.get_as_float(<span class="stringliteral">&quot;FAILED_ELLIPTICITY_VALUE&quot;</span>, 
<a name="l00715"></a>00715                                                         <span class="stringliteral">&quot;SHAPE_MEASUREMENT&quot;</span>)
<a name="l00716"></a>00716       <span class="keywordflow">if</span> failed_marking_value <span class="keywordflow">in</span> result_dico_copy[<span class="stringliteral">&quot;e1&quot;</span>] <span class="keywordflow">or</span> failed_marking_value <span class="keywordflow">in</span> result_dico_copy[<span class="stringliteral">&quot;e2&quot;</span>]:
<a name="l00717"></a>00717 
<a name="l00718"></a>00718          <span class="comment"># --- Get filtered elipticity values</span>
<a name="l00719"></a>00719          <span class="keywordflow">for</span> (ID, e1) <span class="keywordflow">in</span> zip(filter_dico[<span class="stringliteral">&quot;GAL_id&quot;</span>], filter_dico[<span class="stringliteral">&quot;e1&quot;</span>]):
<a name="l00720"></a>00720             result_dico_copy[<span class="stringliteral">&quot;e1&quot;</span>][result_dico_copy[<span class="stringliteral">&quot;GAL_id&quot;</span>].index(ID)] = e1       
<a name="l00721"></a>00721          <span class="keywordflow">for</span> (ID, e2) <span class="keywordflow">in</span> zip(filter_dico[<span class="stringliteral">&quot;GAL_id&quot;</span>], filter_dico[<span class="stringliteral">&quot;e2&quot;</span>]):
<a name="l00722"></a>00722             result_dico_copy[<span class="stringliteral">&quot;e2&quot;</span>][result_dico_copy[<span class="stringliteral">&quot;GAL_id&quot;</span>].index(ID)] = e2 
<a name="l00723"></a>00723 
<a name="l00724"></a>00724          <span class="comment"># --- Get failed elipticity values</span>
<a name="l00725"></a>00725          <span class="keywordflow">for</span> (ID, e1) <span class="keywordflow">in</span> zip(error_dico[<span class="stringliteral">&quot;GAL_id&quot;</span>], error_dico[<span class="stringliteral">&quot;e1&quot;</span>]):
<a name="l00726"></a>00726             result_dico_copy[<span class="stringliteral">&quot;e1&quot;</span>][result_dico_copy[<span class="stringliteral">&quot;GAL_id&quot;</span>].index(ID)] = e1       
<a name="l00727"></a>00727          <span class="keywordflow">for</span> (ID, e2) <span class="keywordflow">in</span> zip(error_dico[<span class="stringliteral">&quot;GAL_id&quot;</span>], error_dico[<span class="stringliteral">&quot;e2&quot;</span>]):
<a name="l00728"></a>00728             result_dico_copy[<span class="stringliteral">&quot;e2&quot;</span>][result_dico_copy[<span class="stringliteral">&quot;GAL_id&quot;</span>].index(ID)] = e2 
<a name="l00729"></a>00729 
<a name="l00730"></a>00730       <span class="comment"># --- Save records to file</span>
<a name="l00731"></a>00731       self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a6792fa9aee819fe6ea18195e42a5ad09">helper</a>.save_from_list_dico(result_dico_copy, output_directory, output_filename, col_list,
<a name="l00732"></a>00732                                       key_index_map=col_key_map, key_fmt_map=col_fmt_map)
<a name="l00733"></a>00733 
<a name="l00734"></a>00734 
<a name="l00735"></a>00735    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00736"></a>00736    <span class="keyword">def </span>_create_galaxy_SE_dataset(self, master):
<a name="l00737"></a>00737       <span class="stringliteral">&quot;&quot;&quot;! Create a MpfxDataset object to query Sextractor-related data &quot;&quot;&quot;</span>
<a name="l00738"></a>00738 
<a name="l00739"></a>00739       dataset_name = master.config.get_as_string(<span class="stringliteral">&quot;NAME&quot;</span>, <span class="stringliteral">&quot;SEXTRACTOR_DATASET_GALAXY&quot;</span>)
<a name="l00740"></a>00740       dataset_dir  = master.config.get_as_string(<span class="stringliteral">&quot;BASE_DIR&quot;</span>, <span class="stringliteral">&quot;SEXTRACTOR_DATASET_GALAXY&quot;</span>)
<a name="l00741"></a>00741 
<a name="l00742"></a>00742       <span class="keywordflow">return</span> MpfxDataset(master, dataset_name, dataset_dir)
<a name="l00743"></a>00743 
<a name="l00744"></a>00744    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00745"></a>00745    <span class="keyword">def </span>_create_psf_SE_dataset(self, master):
<a name="l00746"></a>00746       <span class="stringliteral">&quot;&quot;&quot;! Create a MpfxDataset object to query Sextractor-related data &quot;&quot;&quot;</span>
<a name="l00747"></a>00747 
<a name="l00748"></a>00748       dataset_name = master.config.get_as_string(<span class="stringliteral">&quot;NAME&quot;</span>, 
<a name="l00749"></a>00749                                                  <span class="stringliteral">&quot;SEXTRACTOR_DATASET_PSF&quot;</span>)
<a name="l00750"></a>00750       dataset_dir  = master.config.get_as_string(<span class="stringliteral">&quot;BASE_DIR&quot;</span>,
<a name="l00751"></a>00751                                                  <span class="stringliteral">&quot;SEXTRACTOR_DATASET_PSF&quot;</span>)
<a name="l00752"></a>00752 
<a name="l00753"></a>00753       <span class="keywordflow">return</span> MpfxDataset(master, dataset_name, dataset_dir)
<a name="l00754"></a>00754 
<a name="l00755"></a>00755    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00756"></a>00756    <span class="keyword">def </span>_create_psf_image_dataset(self, master):
<a name="l00757"></a>00757       <span class="stringliteral">&quot;&quot;&quot;! Create a MpfxDataset object to query PSF-related data at the positions of galaxies &quot;&quot;&quot;</span>
<a name="l00758"></a>00758 
<a name="l00759"></a>00759       dataset_name = master.config.get_as_string(<span class="stringliteral">&quot;NAME&quot;</span>, <span class="stringliteral">&quot;PSF_DATASET&quot;</span>)
<a name="l00760"></a>00760       dataset_dir  = master.config.get_as_string(<span class="stringliteral">&quot;BASE_DIR&quot;</span>, <span class="stringliteral">&quot;PSF_DATASET&quot;</span>)
<a name="l00761"></a>00761 
<a name="l00762"></a>00762       <span class="keywordflow">return</span> MpfxDataset(master, dataset_name, dataset_dir)
<a name="l00763"></a>00763 
<a name="l00764"></a>00764    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00765"></a>00765    <span class="keyword">def </span>_locate_galaxy_se_files(self, se_dataset, job, master):
<a name="l00766"></a>00766       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00767"></a>00767 <span class="stringliteral">         @param se_dataset a secondary dataset object pointing to the SExtractor galaxy data</span>
<a name="l00768"></a>00768 <span class="stringliteral">         @param job the GfitJob object corresponding to the image to analyze</span>
<a name="l00769"></a>00769 <span class="stringliteral">         @param master master process object</span>
<a name="l00770"></a>00770 <span class="stringliteral">         @return a dictionary containing for each file_type, image number and epoch the absolute </span>
<a name="l00771"></a>00771 <span class="stringliteral">         path of matching SExtractor files</span>
<a name="l00772"></a>00772 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00773"></a>00773 
<a name="l00774"></a>00774       pattern_list = master.config.get_as_list(<span class="stringliteral">&quot;FILE_PATTERNS&quot;</span>,
<a name="l00775"></a>00775                                                <span class="stringliteral">&quot;SEXTRACTOR_DATASET_GALAXY.CATALOG_PROPERTIES&quot;</span>)
<a name="l00776"></a>00776       dir_list = []
<a name="l00777"></a>00777       dir_recurse = <span class="keyword">False</span>      
<a name="l00778"></a>00778 
<a name="l00779"></a>00779       <span class="keywordflow">if</span> master.config.has_key(<span class="stringliteral">&quot;DIR_INPUT_LIST&quot;</span>, <span class="stringliteral">&quot;SEXTRACTOR_DATASET_GALAXY&quot;</span>):
<a name="l00780"></a>00780          dir_list = master.config.get_as_list(<span class="stringliteral">&quot;DIR_INPUT_LIST&quot;</span>, <span class="stringliteral">&quot;SEXTRACTOR_DATASET_GALAXY&quot;</span>)
<a name="l00781"></a>00781 
<a name="l00782"></a>00782       <span class="keywordflow">print</span> <span class="stringliteral">&quot;*** DIR_LIST:&quot;</span>, dir_list
<a name="l00783"></a>00783 
<a name="l00784"></a>00784       <span class="keywordflow">if</span> master.config.has_key(<span class="stringliteral">&quot;DIR_RECURSE&quot;</span>, <span class="stringliteral">&quot;SEXTRACTOR_DATASET_GALAXY&quot;</span>):
<a name="l00785"></a>00785          dir_recurse = master.config.get_as_list(<span class="stringliteral">&quot;DIR_RECURSE&quot;</span>, <span class="stringliteral">&quot;SEXTRACTOR_DATASET_GALAXY&quot;</span>)
<a name="l00786"></a>00786       <span class="keywordflow">return</span> self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a04d28573a0a6610536302132b8dccc2f">_get_matching_files</a>(se_dataset, pattern_list, dir_list, dir_recurse, job, master) 
<a name="l00787"></a>00787 
<a name="l00788"></a>00788    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00789"></a>00789    <span class="keyword">def </span>_locate_psf_se_files(self, se_dataset, job, master):
<a name="l00790"></a>00790       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00791"></a>00791 <span class="stringliteral">         @param se_dataset a secondary dataset object pointing to the SExtractor STAR data</span>
<a name="l00792"></a>00792 <span class="stringliteral">         @param job the GfitJob object corresponding to the image to analyze</span>
<a name="l00793"></a>00793 <span class="stringliteral">         @param master master process object</span>
<a name="l00794"></a>00794 <span class="stringliteral">         @return a dictionary containing for each file_type, image number and epoch the absolute </span>
<a name="l00795"></a>00795 <span class="stringliteral">         path of matching SExtractor files</span>
<a name="l00796"></a>00796 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00797"></a>00797 
<a name="l00798"></a>00798       pattern_list = master.config.get_as_list(<span class="stringliteral">&quot;FILE_PATTERNS&quot;</span>, 
<a name="l00799"></a>00799                                                <span class="stringliteral">&quot;SEXTRACTOR_DATASET_PSF.CATALOG_PROPERTIES&quot;</span>)
<a name="l00800"></a>00800 
<a name="l00801"></a>00801       dir_list = []
<a name="l00802"></a>00802       dir_recurse = <span class="keyword">False</span>      
<a name="l00803"></a>00803 
<a name="l00804"></a>00804       <span class="keywordflow">if</span> master.config.has_key(<span class="stringliteral">&quot;DIR_INPUT_LIST&quot;</span>, <span class="stringliteral">&quot;SEXTRACTOR_DATASET_PSF&quot;</span>):
<a name="l00805"></a>00805          dir_list = master.config.get_as_list(<span class="stringliteral">&quot;DIR_INPUT_LIST&quot;</span>, <span class="stringliteral">&quot;SEXTRACTOR_DATASET_PSF&quot;</span>)
<a name="l00806"></a>00806       <span class="keywordflow">if</span> master.config.has_key(<span class="stringliteral">&quot;DIR_RECURSE&quot;</span>, <span class="stringliteral">&quot;SEXTRACTOR_DATASET_PSF&quot;</span>):
<a name="l00807"></a>00807          dir_recurse = master.config.get_as_list(<span class="stringliteral">&quot;DIR_RECURSE&quot;</span>, <span class="stringliteral">&quot;SEXTRACTOR_DATASET_PSF&quot;</span>)
<a name="l00808"></a>00808       <span class="keywordflow">return</span> self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a04d28573a0a6610536302132b8dccc2f">_get_matching_files</a>(se_dataset, pattern_list, dir_list, dir_recurse, job, master) 
<a name="l00809"></a>00809 
<a name="l00810"></a>00810    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00811"></a>00811    <span class="keyword">def </span>_locate_psf_image_files(self, psf_dataset, job, master):
<a name="l00812"></a>00812       <span class="stringliteral">&quot;&quot;&quot;!</span>
<a name="l00813"></a>00813 <span class="stringliteral">         @param psf_dataset a secondary dataset object pointing to the PSF image data</span>
<a name="l00814"></a>00814 <span class="stringliteral">         @param job the GfitJob object corresponding to the image to analyze</span>
<a name="l00815"></a>00815 <span class="stringliteral">         @param master master process object</span>
<a name="l00816"></a>00816 <span class="stringliteral">         @return a dictionary containing for each file_type, image number and epoch the absolute </span>
<a name="l00817"></a>00817 <span class="stringliteral">         path of matching PSF files</span>
<a name="l00818"></a>00818 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00819"></a>00819 
<a name="l00820"></a>00820       pattern_list = master.config.get_as_list(<span class="stringliteral">&quot;FILE_PATTERNS&quot;</span>, <span class="stringliteral">&quot;PSF_DATASET.IMAGE_PROPERTIES&quot;</span>)
<a name="l00821"></a>00821 
<a name="l00822"></a>00822       dir_list = []
<a name="l00823"></a>00823       dir_recurse = <span class="keyword">False</span>      
<a name="l00824"></a>00824 
<a name="l00825"></a>00825       <span class="keywordflow">if</span> master.config.has_key(<span class="stringliteral">&quot;DIR_INPUT_LIST&quot;</span>, <span class="stringliteral">&quot;PSF_DATASET&quot;</span>):
<a name="l00826"></a>00826          dir_list = master.config.get_as_list(<span class="stringliteral">&quot;DIR_INPUT_LIST&quot;</span>, <span class="stringliteral">&quot;PSF_DATASET&quot;</span>)
<a name="l00827"></a>00827 
<a name="l00828"></a>00828       <span class="keywordflow">if</span> master.config.has_key(<span class="stringliteral">&quot;DIR_RECURSE&quot;</span>, <span class="stringliteral">&quot;PSF_DATASET&quot;</span>):
<a name="l00829"></a>00829          dir_recurse = master.config.get_as_list(<span class="stringliteral">&quot;DIR_RECURSE&quot;</span>, <span class="stringliteral">&quot;PSF_DATASET&quot;</span>)
<a name="l00830"></a>00830       <span class="keywordflow">return</span> self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJobProcessor.html#a04d28573a0a6610536302132b8dccc2f">_get_matching_files</a>(psf_dataset, pattern_list, dir_list, dir_recurse, job, master) 
<a name="l00831"></a>00831 
<a name="l00832"></a>00832 
<a name="l00833"></a>00833    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00834"></a>00834    <span class="keyword">def </span>_get_matching_files(self, dataset, file_patterns, dir_list, dir_recurse, job, master):
<a name="l00835"></a>00835       <span class="stringliteral">&quot;&quot;&quot;!</span>
<a name="l00836"></a>00836 <span class="stringliteral">         @param dataset a dataset object</span>
<a name="l00837"></a>00837 <span class="stringliteral">         @param file_patterns a list of Unix-like file patterns, like [&quot;image*.fits&quot;, &quot;*.cat&quot;]</span>
<a name="l00838"></a>00838 <span class="stringliteral">         @param dir_list a list of specific directories to search under base directory</span>
<a name="l00839"></a>00839 <span class="stringliteral">         @param recurse tell whether to walk down directories (default @c True)</span>
<a name="l00840"></a>00840 <span class="stringliteral">         @param job the GfitJob object corresponding to the image to analyze</span>
<a name="l00841"></a>00841 <span class="stringliteral">         @param master master process object</span>
<a name="l00842"></a>00842 <span class="stringliteral">         @return a dictionary containing for each file_type, image number and epoch the absolute </span>
<a name="l00843"></a>00843 <span class="stringliteral">         path of matching files</span>
<a name="l00844"></a>00844 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00845"></a>00845 
<a name="l00846"></a>00846       <span class="comment"># --- Locate the files matching the underlying criteria of the job (img_no, etc.)</span>
<a name="l00847"></a>00847       matching_dico = dataset.query(master, file_patterns, 
<a name="l00848"></a>00848                                             dir_list=dir_list,
<a name="l00849"></a>00849                                             image_list=[job.img_no], 
<a name="l00850"></a>00850                                             image_range=[], 
<a name="l00851"></a>00851                                             sort=<span class="keyword">True</span>, recurse=dir_recurse)    
<a name="l00852"></a>00852 
<a name="l00853"></a>00853       <span class="comment"># --- Aggregate all paths to handle multiepoch files</span>
<a name="l00854"></a>00854       <span class="comment"># TODO: see how to handle multiple exposure files (multiepoch). May need another dataset</span>
<a name="l00855"></a>00855       <span class="comment">#       containing multi-exposure files processed using a another tool.</span>
<a name="l00856"></a>00856       filepath_list = [] 
<a name="l00857"></a>00857       <span class="keywordflow">for</span> file_dico <span class="keywordflow">in</span> matching_dico.values():
<a name="l00858"></a>00858          filepath_list.extend(file_dico.values())
<a name="l00859"></a>00859 
<a name="l00860"></a>00860       <span class="comment"># --- Build a dictionary with keys: (image_type, img_no, epoch) -&gt; Value: file_path    </span>
<a name="l00861"></a>00861       file_path_dico = {}    
<a name="l00862"></a>00862       <span class="keywordflow">for</span> file_path <span class="keywordflow">in</span> filepath_list:
<a name="l00863"></a>00863          [file_type, img_no, epoch] = job.get_file_components_from_path(file_path)
<a name="l00864"></a>00864          <span class="keywordflow">if</span> <span class="keywordflow">not</span>  (img_no, epoch) <span class="keywordflow">in</span> file_path_dico:
<a name="l00865"></a>00865             file_path_dico[(img_no, epoch)] = []
<a name="l00866"></a>00866          <span class="comment"># Store filetype_main, not file_type   </span>
<a name="l00867"></a>00867          file_path_dico[(img_no, epoch)].append(file_path)  
<a name="l00868"></a>00868 
<a name="l00869"></a>00869       <span class="comment"># --- Find the </span>
<a name="l00870"></a>00870 
<a name="l00871"></a>00871 <span class="comment">#      # Build a dictionary with keys: (image_type, img_no, epoch) -&gt; Value: file_path</span>
<a name="l00872"></a>00872 <span class="comment">#      # Note: it is assumed the SE catalog names are identical to the .FITS objedct file name from</span>
<a name="l00873"></a>00873 <span class="comment">#      #       which the centroids were estimated, except that the extension is different </span>
<a name="l00874"></a>00874 <span class="comment">#      #       (e.g. .txt or .cat) =&gt; so we only store in &lt;file_path_dico&gt; the object filename without </span>
<a name="l00875"></a>00875 <span class="comment">#      #       extension as file_type key.     </span>
<a name="l00876"></a>00876 <span class="comment">#      file_path_dico = {}    </span>
<a name="l00877"></a>00877 <span class="comment">#      for file_path in filepath_list:</span>
<a name="l00878"></a>00878 <span class="comment">#         [file_type, img_no, epoch] = job.get_file_components_from_path(file_path)</span>
<a name="l00879"></a>00879 <span class="comment">#         [filetype_main, filetype_ext] = os.path.splitext(file_type)</span>
<a name="l00880"></a>00880 <span class="comment">#         if not  (filetype_main, img_no, epoch) in file_path_dico:</span>
<a name="l00881"></a>00881 <span class="comment">#            file_path_dico[(filetype_main, img_no, epoch)] = []</span>
<a name="l00882"></a>00882 <span class="comment">#         # Store filetype_main, not file_type   </span>
<a name="l00883"></a>00883 <span class="comment">#         file_path_dico[(filetype_main, img_no, epoch)].append(file_path)  </span>
<a name="l00884"></a>00884 
<a name="l00885"></a>00885       <span class="comment">#print &quot;FILEPATH DICO:&quot;, file_path_dico</span>
<a name="l00886"></a>00886 
<a name="l00887"></a>00887       <span class="keywordflow">return</span> file_path_dico
<a name="l00888"></a>00888 
<a name="l00889"></a>00889    <span class="comment"># -----------------------------------------------------------------------------------------------</span>
<a name="l00890"></a>00890    <span class="keyword">def </span>_get_selected_branches(self, master):
<a name="l00891"></a>00891 
<a name="l00892"></a>00892       <span class="keywordflow">return</span> master.config.get_as_list(<span class="stringliteral">&quot;DIR_INPUT_LIST&quot;</span>, <span class="stringliteral">&quot;PRIMARY_DATASET&quot;</span>)      
<a name="l00893"></a>00893 
<a name="l00894"></a>00894 <span class="comment"># -------------------------------------------------------------------------------------------------</span>
<a name="l00895"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html">00895</a> <span class="keyword">class </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html" title="A Gfit job.">GfitJob</a>(<a class="code" href="classMpfxJob.html">MpfxJob</a>):      
<a name="l00896"></a>00896 
<a name="l00897"></a>00897    <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00898"></a>00898 <span class="stringliteral">       A Gfit job. Based on mpfg.Job and mpfx.MpfxJob.  </span>
<a name="l00899"></a>00899 <span class="stringliteral">   &quot;&quot;&quot;</span>
<a name="l00900"></a>00900 
<a name="l00901"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a5bab7f658ac691daabdb8f4dc9e49b63">00901</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a5bab7f658ac691daabdb8f4dc9e49b63" title="Construct a new job for identifiying a set of files in the dataset to process together.">__init__</a>(self, master, dataset, img_path_dico, *args):
<a name="l00902"></a>00902       <span class="stringliteral">&quot;&quot;&quot;!   </span>
<a name="l00903"></a>00903 <span class="stringliteral">         Construct a new job for identifiying a set of files in the dataset to process together.</span>
<a name="l00904"></a>00904 <span class="stringliteral"></span>
<a name="l00905"></a>00905 <span class="stringliteral">         To obtain the path associated with a given type, just use:</span>
<a name="l00906"></a>00906 <span class="stringliteral">         @code self.img_path_dico[type]@endcode with one of the aforementioned types.</span>
<a name="l00907"></a>00907 <span class="stringliteral"></span>
<a name="l00908"></a>00908 <span class="stringliteral">         @param master master process instance</span>
<a name="l00909"></a>00909 <span class="stringliteral">         @param dataset data source used to create the job</span>
<a name="l00910"></a>00910 <span class="stringliteral">         @param img_path_dico file absolute path dictionary  for every file types referenced in </span>
<a name="l00911"></a>00911 <span class="stringliteral">                the job</span>
<a name="l00912"></a>00912 <span class="stringliteral">         @param args a list with the branch tree, image number and epoch number</span>
<a name="l00913"></a>00913 <span class="stringliteral"></span>
<a name="l00914"></a>00914 <span class="stringliteral">         @return an initialized GfitJob object</span>
<a name="l00915"></a>00915 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00916"></a>00916 
<a name="l00917"></a>00917       MpfxJob.__init__(self, master, dataset, img_path_dico, *args)
<a name="l00918"></a>00918 
<a name="l00919"></a>00919       <span class="comment"># --- Keep track of all defined datasets</span>
<a name="l00920"></a>00920       self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a75ee6bf2a69156219680afb6749b2c5d">_dataset_dico</a> = {}  
<a name="l00921"></a>00921 
<a name="l00922"></a>00922    <span class="comment"># ~~~~~~~~~~</span>
<a name="l00923"></a>00923    <span class="comment"># Properties </span>
<a name="l00924"></a>00924    <span class="comment"># ~~~~~~~~~~</span>
<a name="l00925"></a>00925 
<a name="l00926"></a>00926    <span class="comment"># --- Getters</span>
<a name="l00927"></a>00927 
<a name="l00928"></a>00928    @property
<a name="l00929"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#aa437c0e5b0c6e2ee26dae41a678aa4b9">00929</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#aa437c0e5b0c6e2ee26dae41a678aa4b9" title="Get the absolute paths of SExtractor catalogs linked to the GREAT3 galaxy files referenced by this jo...">galaxy_se_filepath_dico</a>(self):
<a name="l00930"></a>00930       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00931"></a>00931 <span class="stringliteral">         Get the absolute paths of SExtractor catalogs linked to the GREAT3 galaxy files referenced</span>
<a name="l00932"></a>00932 <span class="stringliteral">         by this job </span>
<a name="l00933"></a>00933 <span class="stringliteral">         @return a dictionary containing for each file_type, image number and epoch the absolute </span>
<a name="l00934"></a>00934 <span class="stringliteral">         path of SExtractor matching files</span>
<a name="l00935"></a>00935 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00936"></a>00936       <span class="keywordflow">return</span> self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a4077e7a1a3303d0b49d1efe109c7954e">_galaxy_se_filepath_dico</a>
<a name="l00937"></a>00937 
<a name="l00938"></a>00938    @property
<a name="l00939"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a3b1269b00e0d457710057f3606fd9f2c">00939</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a3b1269b00e0d457710057f3606fd9f2c" title="Get the absolute paths of SExtractor catalogs linked to the GREAT3 PSF files referenced by this job...">star_se_filepath_dico</a>(self):
<a name="l00940"></a>00940       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00941"></a>00941 <span class="stringliteral">         Get the absolute paths of SExtractor catalogs linked to the GREAT3 PSF files referenced</span>
<a name="l00942"></a>00942 <span class="stringliteral">         by this job </span>
<a name="l00943"></a>00943 <span class="stringliteral">         @return a dictionary containing for each file_type, image number and epoch the absolute </span>
<a name="l00944"></a>00944 <span class="stringliteral">         path of SExtractor matching files</span>
<a name="l00945"></a>00945 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00946"></a>00946       <span class="keywordflow">return</span> self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#ab3ab3638bded6d13a1a5fb64ee37115e">_star_se_filepath_dico</a>
<a name="l00947"></a>00947 
<a name="l00948"></a>00948    @property
<a name="l00949"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a7e9529d165cee59d6047de950aa54dd9">00949</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a7e9529d165cee59d6047de950aa54dd9" title="Get a the absolute paths of PSF image absolute paths matching the galaxies referenced by this job...">psf_filepath_dico</a>(self):
<a name="l00950"></a>00950       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00951"></a>00951 <span class="stringliteral">         Get a the absolute paths of PSF image absolute paths matching the galaxies referenced by </span>
<a name="l00952"></a>00952 <span class="stringliteral">                 this job</span>
<a name="l00953"></a>00953 <span class="stringliteral">         @return a dictionary containing for each file_type, image number and epoch the absolute </span>
<a name="l00954"></a>00954 <span class="stringliteral">         path of PSF matching files</span>
<a name="l00955"></a>00955 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00956"></a>00956       <span class="keywordflow">return</span> self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a41f951ebbfac8a3100fa14c822cfa033">_psf_filepath_dico</a>
<a name="l00957"></a>00957 
<a name="l00958"></a>00958    @property
<a name="l00959"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a57114616275ffae2221d12cb178ec635">00959</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a57114616275ffae2221d12cb178ec635" title="Get the dataset dictionary containing all created datasets.">dataset_dico</a>(self):
<a name="l00960"></a>00960       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00961"></a>00961 <span class="stringliteral">         Get the dataset dictionary containing all created datasets</span>
<a name="l00962"></a>00962 <span class="stringliteral">         @return a dictionary containing all registered datasets</span>
<a name="l00963"></a>00963 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00964"></a>00964 
<a name="l00965"></a>00965 <span class="comment">#   @property</span>
<a name="l00966"></a>00966 <span class="comment">#   def galaxy_stamp_size(self):</span>
<a name="l00967"></a>00967 <span class="comment">#      &quot;&quot;&quot;! </span>
<a name="l00968"></a>00968 <span class="comment">#         Get the original PSF postage stamp size</span>
<a name="l00969"></a>00969 <span class="comment">#      &quot;&quot;&quot;</span>
<a name="l00970"></a>00970 <span class="comment">#      return self._galaxy_stamp_size</span>
<a name="l00971"></a>00971 
<a name="l00972"></a>00972 <span class="comment">#   @property</span>
<a name="l00973"></a>00973 <span class="comment">#   def psf_stamp_size(self):</span>
<a name="l00974"></a>00974 <span class="comment">#      &quot;&quot;&quot;! </span>
<a name="l00975"></a>00975 <span class="comment">#         Get the original PSF postage stamp size</span>
<a name="l00976"></a>00976 <span class="comment">#      &quot;&quot;&quot;</span>
<a name="l00977"></a>00977 <span class="comment">#      return self._psf_stamp_size</span>
<a name="l00978"></a>00978 
<a name="l00979"></a>00979 
<a name="l00980"></a>00980    <span class="comment"># --- Setters</span>
<a name="l00981"></a>00981 
<a name="l00982"></a>00982    @galaxy_se_filepath_dico.setter
<a name="l00983"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#aa437c0e5b0c6e2ee26dae41a678aa4b9">00983</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#aa437c0e5b0c6e2ee26dae41a678aa4b9" title="Get the absolute paths of SExtractor catalogs linked to the GREAT3 galaxy files referenced by this jo...">galaxy_se_filepath_dico</a>(self, galaxy_se_filepath_dico):
<a name="l00984"></a>00984       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00985"></a>00985 <span class="stringliteral">         Specify the absolute paths to SExtractor catalog linked to the GREAT3 galaxy files </span>
<a name="l00986"></a>00986 <span class="stringliteral">         referenced by this job</span>
<a name="l00987"></a>00987 <span class="stringliteral">         @param galaxy_se_filepath_dico filepaths dictionary containing for each file_type, image number and epoch the</span>
<a name="l00988"></a>00988 <span class="stringliteral">         absolute path of SExtractor matching files</span>
<a name="l00989"></a>00989 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l00990"></a>00990       self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a4077e7a1a3303d0b49d1efe109c7954e">_galaxy_se_filepath_dico</a> = galaxy_se_filepath_dico
<a name="l00991"></a>00991 
<a name="l00992"></a>00992    @star_se_filepath_dico.setter
<a name="l00993"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a3b1269b00e0d457710057f3606fd9f2c">00993</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a3b1269b00e0d457710057f3606fd9f2c" title="Get the absolute paths of SExtractor catalogs linked to the GREAT3 PSF files referenced by this job...">star_se_filepath_dico</a>(self, star_se_filepath_dico):
<a name="l00994"></a>00994       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l00995"></a>00995 <span class="stringliteral">         Specify the absolute paths of SExtractor catalog linked to the PSF GREAT3 files referenced</span>
<a name="l00996"></a>00996 <span class="stringliteral">         by this job</span>
<a name="l00997"></a>00997 <span class="stringliteral">         @param star_se_filepath_dico dictionary containing for each file_type, image number and epoch the</span>
<a name="l00998"></a>00998 <span class="stringliteral">                                     absolute path of SExtractor matching files</span>
<a name="l00999"></a>00999 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l01000"></a>01000       self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#ab3ab3638bded6d13a1a5fb64ee37115e">_star_se_filepath_dico</a> = star_se_filepath_dico
<a name="l01001"></a>01001 
<a name="l01002"></a>01002    @psf_filepath_dico.setter
<a name="l01003"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a7e9529d165cee59d6047de950aa54dd9">01003</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a7e9529d165cee59d6047de950aa54dd9" title="Get a the absolute paths of PSF image absolute paths matching the galaxies referenced by this job...">psf_filepath_dico</a>(self, psf_filepath_dico):
<a name="l01004"></a>01004       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l01005"></a>01005 <span class="stringliteral">         Specify the absolute paths of PSF image absolute paths matching the galaxies referenced by </span>
<a name="l01006"></a>01006 <span class="stringliteral">         this job</span>
<a name="l01007"></a>01007 <span class="stringliteral">         @param psf_filepath_dico dictionary containing for each file_type, image number and epoch the</span>
<a name="l01008"></a>01008 <span class="stringliteral">                            absolute path of PSF matching files</span>
<a name="l01009"></a>01009 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l01010"></a>01010       self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a41f951ebbfac8a3100fa14c822cfa033">_psf_filepath_dico</a> = psf_filepath_dico
<a name="l01011"></a>01011 
<a name="l01012"></a>01012    @dataset_dico.setter
<a name="l01013"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a57114616275ffae2221d12cb178ec635">01013</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a57114616275ffae2221d12cb178ec635" title="Get the dataset dictionary containing all created datasets.">dataset_dico</a>(self, dataset_dico):
<a name="l01014"></a>01014       <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l01015"></a>01015 <span class="stringliteral">         Specify a dataset dictionary containing all created datasets</span>
<a name="l01016"></a>01016 <span class="stringliteral">         @param dataset_dico dictionary containing all created datasets</span>
<a name="l01017"></a>01017 <span class="stringliteral">      &quot;&quot;&quot;</span>
<a name="l01018"></a>01018       self.<a class="code" href="classgfit_1_1gfit__job_1_1GfitJob.html#a75ee6bf2a69156219680afb6749b2c5d">_dataset_dico</a> = dataset_dico
<a name="l01019"></a>01019 
<a name="l01020"></a>01020 
<a name="l01021"></a>01021 <span class="comment"># -------------------------------------------------------------------------------------------------</span>
<a name="l01022"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobResult.html">01022</a> <span class="keyword">class </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobResult.html" title="The result of a GREAT3 job.">GfitJobResult</a>(<a class="code" href="classMpfxJobResult.html">MpfxJobResult</a>):      
<a name="l01023"></a>01023 
<a name="l01024"></a>01024    <span class="stringliteral">&quot;&quot;&quot;! </span>
<a name="l01025"></a>01025 <span class="stringliteral">       The result of a GREAT3 job. </span>
<a name="l01026"></a>01026 <span class="stringliteral">       @see mpfx.MpfxJobResult</span>
<a name="l01027"></a>01027 <span class="stringliteral">       @see mpf.JobResult.</span>
<a name="l01028"></a>01028 <span class="stringliteral">   &quot;&quot;&quot;</span>
<a name="l01029"></a>01029 
<a name="l01030"></a><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobResult.html#a5506f398c3f6fcdb27d6f78f333e38b2">01030</a>    <span class="keyword">def </span><a class="code" href="classgfit_1_1gfit__job_1_1GfitJobResult.html#a5506f398c3f6fcdb27d6f78f333e38b2" title="Construct a GfitJobResult job result object.">__init__</a>(self, job, result, worker):   
<a name="l01031"></a>01031       <span class="stringliteral">&quot;&quot;&quot;! Construct a GfitJobResult job result object &quot;&quot;&quot;</span>
<a name="l01032"></a>01032       MpfxJobResult.__init__(self, worker, job, result)
<a name="l01033"></a>01033 
<a name="l01034"></a>01034 <span class="comment"># -- EOF gfit_job.py</span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="gfit__job_8py.html">gfit_job.py</a>      </li>
      <li class="footer">Generated on Tue Apr 21 2015 14:26:30 for gfit by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
