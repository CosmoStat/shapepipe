
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ShapePipe Tutorial &#8212; ShapePipe v1.0</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=84ace793992934648b4de8eed757e5a2" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx-book-theme.9d8b4a8b9bb19db25eeaddc40d639ba2.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Post-processing" href="post_processing.html" />
    <link rel="prev" title="Testing" href="testing.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<div class="col-12 col-md-3 bd-sidebar site-navigation " id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">ShapePipe v1.0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About ShapePipe
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="about.html">
   About
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="contributors.html">
   Contributors
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Installing ShapePipe
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="dependencies.html">
   Dependencies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="installation.html">
   Installation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Running ShapePipe
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="basic_execution.html">
   Basic Execution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="configuration.html">
   Configuration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="testing.html">
   Testing
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   ShapePipe Tutorial
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Miscellaneous
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="post_processing.html">
   Post-processing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="random_cat.html">
   Create random catalogue
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  API Documentation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="understanding_api.html">
   Understanding the API Documentation
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="shapepipe.html">
   shapepipe
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="shapepipe.modules.html">
     shapepipe.modules
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.find_exposures_package.html">
       shapepipe.modules.find_exposures_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
      <label for="toctree-checkbox-3">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.find_exposures_package.find_exposures.html">
         shapepipe.modules.find_exposures_package.find_exposures
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.get_images_package.html">
       shapepipe.modules.get_images_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
      <label for="toctree-checkbox-4">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.get_images_package.get_images.html">
         shapepipe.modules.get_images_package.get_images
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.make_cat_package.html">
       shapepipe.modules.make_cat_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
      <label for="toctree-checkbox-5">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.make_cat_package.make_cat.html">
         shapepipe.modules.make_cat_package.make_cat
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.mask_package.html">
       shapepipe.modules.mask_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
      <label for="toctree-checkbox-6">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.mask_package.mask.html">
         shapepipe.modules.mask_package.mask
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.match_external_package.html">
       shapepipe.modules.match_external_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
      <label for="toctree-checkbox-7">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.match_external_package.match_external.html">
         shapepipe.modules.match_external_package.match_external
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.mccd_package.html">
       shapepipe.modules.mccd_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
      <label for="toctree-checkbox-8">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.mccd_package.mccd_interpolation_script.html">
         shapepipe.modules.mccd_package.mccd_interpolation_script
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.mccd_package.mccd_plot_utilities.html">
         shapepipe.modules.mccd_package.mccd_plot_utilities
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.mccd_package.shapepipe_auxiliary_mccd.html">
         shapepipe.modules.mccd_package.shapepipe_auxiliary_mccd
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.merge_headers_package.html">
       shapepipe.modules.merge_headers_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
      <label for="toctree-checkbox-9">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.merge_headers_package.merge_headers.html">
         shapepipe.modules.merge_headers_package.merge_headers
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.merge_sep_cats_package.html">
       shapepipe.modules.merge_sep_cats_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
      <label for="toctree-checkbox-10">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.merge_sep_cats_package.merge_sep_cats.html">
         shapepipe.modules.merge_sep_cats_package.merge_sep_cats
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.merge_starcat_package.html">
       shapepipe.modules.merge_starcat_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
      <label for="toctree-checkbox-11">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.merge_starcat_package.merge_starcat.html">
         shapepipe.modules.merge_starcat_package.merge_starcat
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.ngmix_package.html">
       shapepipe.modules.ngmix_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
      <label for="toctree-checkbox-12">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.ngmix_package.ngmix.html">
         shapepipe.modules.ngmix_package.ngmix
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.pastecat_package.html">
       shapepipe.modules.pastecat_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
      <label for="toctree-checkbox-13">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.pastecat_package.pastecat.html">
         shapepipe.modules.pastecat_package.pastecat
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.psfex_interp_package.html">
       shapepipe.modules.psfex_interp_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
      <label for="toctree-checkbox-14">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.psfex_interp_package.psfex_interp.html">
         shapepipe.modules.psfex_interp_package.psfex_interp
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.psfex_package.html">
       shapepipe.modules.psfex_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
      <label for="toctree-checkbox-15">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.psfex_package.psfex_script.html">
         shapepipe.modules.psfex_package.psfex_script
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.python_example_package.html">
       shapepipe.modules.python_example_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
      <label for="toctree-checkbox-16">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.python_example_package.python_example.html">
         shapepipe.modules.python_example_package.python_example
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.random_cat_package.html">
       shapepipe.modules.random_cat_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
      <label for="toctree-checkbox-17">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.random_cat_package.random_cat.html">
         shapepipe.modules.random_cat_package.random_cat
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.setools_package.html">
       shapepipe.modules.setools_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
      <label for="toctree-checkbox-18">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.setools_package.setools.html">
         shapepipe.modules.setools_package.setools
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.sextractor_package.html">
       shapepipe.modules.sextractor_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
      <label for="toctree-checkbox-19">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.sextractor_package.sextractor_script.html">
         shapepipe.modules.sextractor_package.sextractor_script
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.split_exp_package.html">
       shapepipe.modules.split_exp_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
      <label for="toctree-checkbox-20">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.split_exp_package.split_exp.html">
         shapepipe.modules.split_exp_package.split_exp
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.spread_model_package.html">
       shapepipe.modules.spread_model_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
      <label for="toctree-checkbox-21">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.spread_model_package.spread_model.html">
         shapepipe.modules.spread_model_package.spread_model
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.uncompress_fits_package.html">
       shapepipe.modules.uncompress_fits_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
      <label for="toctree-checkbox-22">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.uncompress_fits_package.uncompress_fits.html">
         shapepipe.modules.uncompress_fits_package.uncompress_fits
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="shapepipe.modules.vignetmaker_package.html">
       shapepipe.modules.vignetmaker_package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
      <label for="toctree-checkbox-23">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="shapepipe.modules.vignetmaker_package.vignetmaker.html">
         shapepipe.modules.vignetmaker_package.vignetmaker
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.modules.module_decorator.html">
       shapepipe.modules.module_decorator
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.modules.module_runners.html">
       shapepipe.modules.module_runners
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="shapepipe.pipeline.html">
     shapepipe.pipeline
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
    <label for="toctree-checkbox-24">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.pipeline.args.html">
       shapepipe.pipeline.args
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.pipeline.config.html">
       shapepipe.pipeline.config
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.pipeline.dependency_handler.html">
       shapepipe.pipeline.dependency_handler
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.pipeline.execute.html">
       shapepipe.pipeline.execute
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.pipeline.file_handler.html">
       shapepipe.pipeline.file_handler
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.pipeline.file_io.html">
       shapepipe.pipeline.file_io
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.pipeline.job_handler.html">
       shapepipe.pipeline.job_handler
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.pipeline.mpi_run.html">
       shapepipe.pipeline.mpi_run
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.pipeline.run_log.html">
       shapepipe.pipeline.run_log
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.pipeline.shared.html">
       shapepipe.pipeline.shared
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.pipeline.str_handler.html">
       shapepipe.pipeline.str_handler
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.pipeline.timeout.html">
       shapepipe.pipeline.timeout
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.pipeline.worker_handler.html">
       shapepipe.pipeline.worker_handler
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="shapepipe.utilities.html">
     shapepipe.utilities
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/>
    <label for="toctree-checkbox-25">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.utilities.canfar.html">
       shapepipe.utilities.canfar
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.utilities.cfis.html">
       shapepipe.utilities.cfis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.utilities.file_system.html">
       shapepipe.utilities.file_system
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shapepipe.utilities.galaxy.html">
       shapepipe.utilities.galaxy
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="shapepipe.info.html">
     shapepipe.info
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="shapepipe.run.html">
     shapepipe.run
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contributing to ShapePipe
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="contributing.html">
   Contribution Guidelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="module_develop.html">
   Module Development
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="module_example.html">
   Module Examples
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="z_ref.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  <p></p>
</div>

</div>


          


          
<!-- This is an invisible pixel that we watch to see if we've scrolled. -->
<div class="sbt-scroll-pixel-helper"></div>
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            <div class="topbar-left">
                
                <label class="nav-toggle-button" for="__navigation">
                    <div class="visually-hidden">Toggle navigation</div>
                    <i class="fas fa-bars"></i>
                </label>
                
            </div>
            
            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/CosmoStat/shapepipe"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/CosmoStat/shapepipe/issues/new?title=Issue%20on%20page%20%2Fpipeline_tutorial.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/CosmoStat/shapepipe/edit/master/docs/source/pipeline_tutorial.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#quick-start">
   Quick start
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#file-types-and-names">
     File types and names
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cfis-processing">
     CFIS processing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#input-and-output-paths">
     Input and output paths
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#job-and-pipeline-scripts">
     Job and pipeline scripts
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#select-tiles">
     Select tiles
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-the-pipeline">
   Run the pipeline
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#retrieve-input-images">
     Retrieve input images
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prepare-input-images">
   Prepare input images
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mask-images">
   Mask images
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#detect-objects-on-tiles-and-process-stars-on-single-exposures">
   Detect objects on tiles and process stars on single exposures
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#global-star-sample-statistics">
     Global star sample statistics
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#galaxy-selection">
   Galaxy selection
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#shape-measurement">
   Shape measurement
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#paste-catalogues">
   Paste catalogues
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upload-results">
   Upload results
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>ShapePipe Tutorial</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#quick-start">
   Quick start
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#file-types-and-names">
     File types and names
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cfis-processing">
     CFIS processing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#input-and-output-paths">
     Input and output paths
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#job-and-pipeline-scripts">
     Job and pipeline scripts
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#select-tiles">
     Select tiles
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-the-pipeline">
   Run the pipeline
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#retrieve-input-images">
     Retrieve input images
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prepare-input-images">
   Prepare input images
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mask-images">
   Mask images
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#detect-objects-on-tiles-and-process-stars-on-single-exposures">
   Detect objects on tiles and process stars on single exposures
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#global-star-sample-statistics">
     Global star sample statistics
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#galaxy-selection">
   Galaxy selection
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#shape-measurement">
   Shape measurement
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#paste-catalogues">
   Paste catalogues
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upload-results">
   Upload results
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="shapepipe-tutorial">
<h1>ShapePipe Tutorial<a class="headerlink" href="#shapepipe-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="quick-start">
<h2>Quick start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h2>
<p>Run the entire pipeline on a single example CFIS image with tile ID 246.290:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/cosmostat/shapepipe#installing-shapepipe">Install</a> <code class="docutils literal notranslate"><span class="pre">ShapePipe</span></code> and activate the <code class="docutils literal notranslate"><span class="pre">shapepipe</span></code> conda environment.</p></li>
<li><p>Run the job script</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>job_sp <span class="m">246</span>.290 -j <span class="m">127</span>
</pre></div>
</div>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">ShapePipe</span></code> pipeline processes single-exposure images and stacked images. Input images have to be calibrated beforehand for astrometry and photometry. This tutorial of an entire <code class="docutils literal notranslate"><span class="pre">ShapePipe</span></code> run covers specifically images from CFIS, the Canada-France Imaging Survey. CFIS stacks are so-called tiles, which are the co-adds of on average three exposures in the r-band.</p>
<div class="section" id="file-types-and-names">
<h3>File types and names<a class="headerlink" href="#file-types-and-names" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">ShapePipe</span></code> pipeline handles different image and file types, some of which
are created by the pipeline during the analysis. These file types are listed below.</p>
<p>All files follow a (configurable) naming and numbering convention, to facilitate bookkeeping for
tracking relevant image information. In general, the convention is <strong>&lt;image_type&gt;_<ID>.fits</strong>.
<code class="docutils literal notranslate"><span class="pre">ID</span></code> can be a combination of numbers and special characters such as <code class="docutils literal notranslate"><span class="pre">-</span></code>.
Naming and numbering of the input files can closely follow the original image names and (ID) numbers provided by the telescope and pre-processing software, with some required modifications as described below.</p>
<ul class="simple">
<li><p>Single-exposure mosaic image.<br />
Multi-HDU FITS file containing a mosaic from multiple CCDs of a single exposure (an exposure is also called epoch).
Each CCD is stored in a different HDU.
These files are used on input by <code class="docutils literal notranslate"><span class="pre">ShapePipe</span></code>. The pixel data can contain the observed image, a weight map, or a flag map.
These images are typically created by a telescope analysis software (e.g.~<code class="docutils literal notranslate"><span class="pre">pitcairn</span></code>). Examples from CFIS are
<code class="docutils literal notranslate"><span class="pre">2228303p.fits.fz</span></code>, <code class="docutils literal notranslate"><span class="pre">2214439p.flag.fits.fz</span></code>. These names need to be modified to be correctly identified by <code class="docutils literal notranslate"><span class="pre">ShapePipe</span></code>:
The <code class="docutils literal notranslate"><span class="pre">p</span></code> needs to be removed, the image type needs to precede the ID, and the file name can only contain a single dot (<code class="docutils literal notranslate"><span class="pre">.</span></code>) delimiting the file extension. We create the extension <code class="docutils literal notranslate"><span class="pre">fitsfz</span></code> for compressed FITS file.<br />
Default convention: <strong>&lt;image_type&gt;-&lt;exposure_number&gt;.fitsfz</strong>.<br />
Examples: <code class="docutils literal notranslate"><span class="pre">image-2228303.fitsfz</span></code>, <code class="docutils literal notranslate"><span class="pre">flag-2214439.fitsfz</span></code></p></li>
<li><p>Single-exposure single-CCD image.<br />
FITS file containing a single CCD from an individual exposure. The pixel data can contain the observed image, a weight
map, or a flag map.<br />
Default convention: <strong>&lt;image_type&gt;-&lt;exposure_number&gt;-&lt;CCD_number&gt;.fits</strong><br />
Examples: <code class="docutils literal notranslate"><span class="pre">image-2079614-9.fits</span></code>, <code class="docutils literal notranslate"><span class="pre">weight-2079614-3.fits</span></code></p></li>
<li><p>Stacked images<br />
FITS file containing a stack by co-adding different single exposures, created by software such as <code class="docutils literal notranslate"><span class="pre">swarp</span></code>.
A stacked image is also called <em>tile</em>. These files are used on input by <code class="docutils literal notranslate"><span class="pre">ShapePipe</span></code>.
The pixel data can contain the observed image, a weight map, or a flag map. Tile images and weights are created in the
case of CFIS by Stephen Gwyn using a combination of <code class="docutils literal notranslate"><span class="pre">swarp</span></code> and his own software. Examples of file names are
<code class="docutils literal notranslate"><span class="pre">CFIS.316.246.r.fits</span></code>, <code class="docutils literal notranslate"><span class="pre">CFIS.205.267.r.weight.fits.fz</span></code>, the latter is a compressed FITS file, see below. Tile flag files
are created the mask module of <code class="docutils literal notranslate"><span class="pre">ShapePipe</span></code> (see <span class="xref myst">Mask images</span>). The tile ID needs to be modified such that the <code class="docutils literal notranslate"><span class="pre">.</span></code> between the two tile numbers (RA and DEC indicator) is not mistaken for a file extension delimiter. For the same reason, the extension <code class="docutils literal notranslate"><span class="pre">.fits.fz</span></code> is changed to <code class="docutils literal notranslate"><span class="pre">.fitzfz</span></code>. In addition, for
clarity, we include the string <code class="docutils literal notranslate"><span class="pre">image</span></code> for a tile image type.<br />
Default convention: <strong>&lt;image_type&gt;-&lt;tile_number&gt;.fits</strong><br />
Examples: <code class="docutils literal notranslate"><span class="pre">CFIS_image-277-282.fits</span></code>, <code class="docutils literal notranslate"><span class="pre">CFIS_weight-274-282.fitsfz</span></code>, <code class="docutils literal notranslate"><span class="pre">pipeline_flag-239-293.fits</span></code></p></li>
<li><p>Database catalogue files<br />
For very large files that combine information from multiple tiles or single exposures, <code class="docutils literal notranslate"><span class="pre">ShapePipe</span></code> creates <code class="docutils literal notranslate"><span class="pre">sqlite</span></code>
data base catalogues.<br />
Examples: <code class="docutils literal notranslate"><span class="pre">log_exp_headers.sqlite</span></code>, exposure header information</p></li>
<li><p>Numpy array binary files<br />
Some large files are stored as numpy arrays. These contain FITS header information.
Example: <code class="docutils literal notranslate"><span class="pre">headers-2366993.npy</span></code></p></li>
<li><p>PSF files<br />
<code class="docutils literal notranslate"><span class="pre">PSFEx</span></code> and <code class="docutils literal notranslate"><span class="pre">SExtractor</span></code> produce FITS files with file exentions other than <code class="docutils literal notranslate"><span class="pre">.fits</span></code>: <code class="docutils literal notranslate"><span class="pre">.psf</span></code> for files containing PSF
model information for a single CCD, and <code class="docutils literal notranslate"><span class="pre">.cat</span></code> for a PSF catalogue.</p></li>
<li><p><em>final</em> shape catalogue
The end product of <code class="docutils literal notranslate"><span class="pre">ShapePipe</span></code> is a <em>final</em> catalogue containing a large number of information for each galaxy, including its
shape parameters, the ellipticity components :math:<code class="docutils literal notranslate"><span class="pre">e_1</span></code> and :math:<code class="docutils literal notranslate"><span class="pre">e_2</span></code>. This catalogue also contains shapes of artificially
sheared images. This information is used in post-processing to compute calibrated shear estimates via metacalibration.</p></li>
<li><p>Summary statistic files<br />
The <code class="docutils literal notranslate"><span class="pre">SETools</span></code> module that creates samples of objects according to some user-defined selection criteria (see <span class="xref myst">Select stars</span>) also outputs ASCII<br />
files with user-defined summary statistics for each CCD, for example the number of selected stars, or mean and standard deviation of their FWHM.<br />
Example: <code class="docutils literal notranslate"><span class="pre">star_stat-2366993-18.txt</span></code></p></li>
<li><p>Tile ID list<br />
ASCII file with a tile number on each line. Used for the <code class="docutils literal notranslate"><span class="pre">get_image_runner</span></code> module to download CFIS images (see <span class="xref myst">Download tiles</span>).</p></li>
<li><p>Single-exposure name list<br />
ASCII file with a single-exposure name on each line. Produced by the <code class="docutils literal notranslate"><span class="pre">find_exposure_runner</span></code> module to identify single exposures that were used to create
a given tile. See <span class="xref myst">Find exposures</span>).</p></li>
<li><p>Plots<br />
The <code class="docutils literal notranslate"><span class="pre">SETools</span></code> module can also produce plots of the objects properties that were selected for a given CCD.
The type of plot (histogram, scatter plot, …) and quantities to plot as well as plot decorations can be specified in the
selection criteria config file (see <span class="xref myst">Select stars</span>).
Example: <code class="docutils literal notranslate"><span class="pre">hist_mag_stars-2104133-5.png</span></code></p></li>
<li><p>Log files<br />
The pipeline core and all called modules write ASCII log files to disk.<br />
Examples: <code class="docutils literal notranslate"><span class="pre">process-2366993-6.log</span></code>, <code class="docutils literal notranslate"><span class="pre">log_sp_exp.log</span></code>.</p></li>
</ul>
</div>
<div class="section" id="cfis-processing">
<h3>CFIS processing<a class="headerlink" href="#cfis-processing" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ShapePipe</span></code> splits the processing of CFIS images into several parts:
These are the retrieval and preparation of input images, processing of single exposures,
processing of tile images, creation and upload (optional) of <em>final</em> shape catalogues.</p>
<p>The following flowchart visualised the processing parts and steps.</p>
<p><img alt="ShapePipe_FlowChart" src="_images/ShapePipe_v0.0.1.png" /></p>
<p>Below, the individual processing steps are described in detail.</p>
</div>
<div class="section" id="input-and-output-paths">
<h3>Input and output paths<a class="headerlink" href="#input-and-output-paths" title="Permalink to this headline">¶</a></h3>
<p>All required paths are automatically set in the job script <code class="docutils literal notranslate"><span class="pre">job_sp</span></code>.</p>
<p>If an example config file is run outside this script,
the following path variables might need to be defined.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">$SP_RUN</span></code>: Run directory of <code class="docutils literal notranslate"><span class="pre">ShapePipe</span></code>. In general this is just <code class="docutils literal notranslate"><span class="pre">pwd</span></code>, and can be set via</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">SP_RUN</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
</pre></div>
</div>
<p>but on a cluster this directory might be different.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">$SP_CONFIG</span></code>: Path to configuration files. In our example this is <code class="docutils literal notranslate"><span class="pre">$SP_BASE/example/cfis</span></code>.</p></li>
</ul>
<p>In addition, the output path <code class="docutils literal notranslate"><span class="pre">$SP_RUN/output</span></code> needs to be created by the user before running <code class="docutils literal notranslate"><span class="pre">ShapePipe</span></code>.</p>
</div>
<div class="section" id="job-and-pipeline-scripts">
<h3>Job and pipeline scripts<a class="headerlink" href="#job-and-pipeline-scripts" title="Permalink to this headline">¶</a></h3>
<p>The job script to run the pipeline in its entity or in parts is <code class="docutils literal notranslate"><span class="pre">job_sp[.bash]</span></code>. Type</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>job_sp -h
</pre></div>
</div>
<p>for all options.</p>
<p>This script creates the subdirectory <code class="docutils literal notranslate"><span class="pre">$SP_RUN/output</span></code> to store all pipeline outputs
(log files, diagnostics, statistics, output images, catalogues, single-exposure headers with WCS information).</p>
<p>Optionally, the subdir <code class="docutils literal notranslate"><span class="pre">output_star_cat</span></code> is created by the used to store the external star catalogues for masking. This is only necessary if the pipeline is run on a cluster without internet connection to access star catalogues. In that case, the star catalogues need to be retrieved outside the pipeline, for example on a login node, and copied to <code class="docutils literal notranslate"><span class="pre">output_star_cat</span></code>.</p>
<p>The job script automaticall performs a number of subsequent calls to the <code class="docutils literal notranslate"><span class="pre">ShapePipe</span></code> executable <code class="docutils literal notranslate"><span class="pre">shapepipe_run</span></code>, as</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>shapepipe_run -c <span class="nv">$SP_CONFIG</span>/&lt;config&gt;.ini
</pre></div>
</div>
<p>The config file <code class="docutils literal notranslate"><span class="pre">&lt;config&gt;.ini</span></code> contains the configuration for one or more modules.
See the main <code class="docutils literal notranslate"><span class="pre">ShapePipe</span></code> readme for more details.</p>
<p>The user specifies which steps are run with the command line option <code class="docutils literal notranslate"><span class="pre">-j</span> <span class="pre">JOB</span></code>. The integer value <code class="docutils literal notranslate"><span class="pre">JOB</span></code>
is bit-coded such that arbitrary combinations of steps can be run with a single call to <code class="docutils literal notranslate"><span class="pre">job_sp</span></code>. For
example, to run steps #1 and #2, type <code class="docutils literal notranslate"><span class="pre">job_sp</span> <span class="pre">-j</span> <span class="pre">3</span></code>.</p>
</div>
<div class="section" id="select-tiles">
<h3>Select tiles<a class="headerlink" href="#select-tiles" title="Permalink to this headline">¶</a></h3>
<p>To run the job script, one or more CFIS tiles need to be chosen. If the tile IDs are known, they are provided to <code class="docutils literal notranslate"><span class="pre">job_sp</span></code> on the command line.</p>
<p>If the tile IDs are not known a priori, they can be selected via sky coordinates, with the script <code class="docutils literal notranslate"><span class="pre">cfis_field_select</span></code>.
For example, to find the tile number for a Planck cluster at R.A.=213.68 deg, dec=57.79 deg, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cfis_field_select -i /path/to/shapepipe/auxdir/CFIS/tiles_202007/tiles_all_order.txt --coord <span class="m">213</span>.68deg_54.79deg -t tile --input_format ID_only --out_name_only --out_ID_only -s
</pre></div>
</div>
<p>The input text file (provide via the flag <code class="docutils literal notranslate"><span class="pre">-i</span></code>) contains a list of CFIS tiles, this can also be directory containing the tile FITS files.</p>
<p>The following sections describe the different steps that are performed with <code class="docutils literal notranslate"><span class="pre">job_sp</span></code>.</p>
</div>
</div>
<div class="section" id="run-the-pipeline">
<h2>Run the pipeline<a class="headerlink" href="#run-the-pipeline" title="Permalink to this headline">¶</a></h2>
<div class="section" id="retrieve-input-images">
<h3>Retrieve input images<a class="headerlink" href="#retrieve-input-images" title="Permalink to this headline">¶</a></h3>
<p>The command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>job_sp TILE_ID -j <span class="m">1</span>
</pre></div>
</div>
<p>retrieves the image and weight corresponding to TILE_ID using the module <code class="docutils literal notranslate"><span class="pre">get_images</span></code>.
It then identifies the exposures that were used to create the tile image via the <code class="docutils literal notranslate"><span class="pre">find_exposures</span></code> runner.
Finally, another call to <code class="docutils literal notranslate"><span class="pre">get_images</span></code> retrieves the exposure images, weights, and flag files.</p>
<p>For the retrieval method the user can choose betwen</p>
<ul class="simple">
<li><p>download from VOspace (<code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">vos</span></code>);</p></li>
<li><p>create symbolic link to existing file on disk (<code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">symlink</span></code>).</p></li>
</ul>
<p>Note that internet access is required for this step if the download method is <code class="docutils literal notranslate"><span class="pre">vos</span></code>.</p>
<p>An output directory <code class="docutils literal notranslate"><span class="pre">run_sp_GitFeGie</span></code> (in <code class="docutils literal notranslate"><span class="pre">output</span></code>) is created containing the results of <code class="docutils literal notranslate"><span class="pre">get_images</span></code> for tiles (<code class="docutils literal notranslate"><span class="pre">Git</span></code>),
<code class="docutils literal notranslate"><span class="pre">find_exposures</span></code> (<code class="docutils literal notranslate"><span class="pre">Fe</span></code>), and <code class="docutils literal notranslate"><span class="pre">get_images</span></code> for exposures (<code class="docutils literal notranslate"><span class="pre">Gie</span></code>).</p>
</div>
</div>
<div class="section" id="prepare-input-images">
<h2>Prepare input images<a class="headerlink" href="#prepare-input-images" title="Permalink to this headline">¶</a></h2>
<p>With</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>job_sp TILE_ID -j <span class="m">2</span>
</pre></div>
</div>
<p>the compressed tile weight image is uncompressed via the <code class="docutils literal notranslate"><span class="pre">uncompress_fits</span></code> module. Then, the single-exposure images, weight, and flags are split into single-exposure single-CCD file
(one FITS file per CCD) with <code class="docutils literal notranslate"><span class="pre">split_exp</span></code>.
Finally, the headers of all single-exposure single-CCD files are merged into a single <code class="docutils literal notranslate"><span class="pre">sqlite</span></code> file, to store the WCS information of the input exposures.</p>
<p>Two output directories are created, <code class="docutils literal notranslate"><span class="pre">run_sp_Uz</span></code> for <code class="docutils literal notranslate"><span class="pre">uncompress_fits</span></code>, and <code class="docutils literal notranslate"><span class="pre">run_sp_exp_SpMh</span></code> for the output of the modules
<code class="docutils literal notranslate"><span class="pre">split_exp</span></code> (<code class="docutils literal notranslate"><span class="pre">Sp</span></code>) and <code class="docutils literal notranslate"><span class="pre">merge_headers</span></code> (<code class="docutils literal notranslate"><span class="pre">Mh</span></code>).</p>
</div>
<div class="section" id="mask-images">
<h2>Mask images<a class="headerlink" href="#mask-images" title="Permalink to this headline">¶</a></h2>
<p>Run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>job_sp TILE_ID -j <span class="m">4</span>
</pre></div>
</div>
<p>to mask tile and single-exposure single-CCD images. Both tasks are performed by two calls to the <code class="docutils literal notranslate"><span class="pre">mask</span></code> runner.</p>
<p>Note that internet access is required for this step, since a reference star catalogue is downloaded.</p>
<p>The output of both masking runs are stored in the output directory <code class="docutils literal notranslate"><span class="pre">run_sp_MaMa</span></code>, with run 1 (2) of
<code class="docutils literal notranslate"><span class="pre">mask</span></code> corresponding to tiles (exposures).</p>
<p><strong>Diagnostics:</strong> Open a single-exposure single-CCD image and the corresponding pipeline flag
in <code class="docutils literal notranslate"><span class="pre">ds9</span></code>, and display both frames next to each other. Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ds9 image-2113737-10.fits pipeline_flag-2113737-10.fits
</pre></div>
</div>
<p>Choose <code class="docutils literal notranslate"><span class="pre">zoom</span> <span class="pre">fit</span></code> for both frames, click <code class="docutils literal notranslate"><span class="pre">scale</span> <span class="pre">zscale</span></code> for the image, and <code class="docutils literal notranslate"><span class="pre">color</span> <span class="pre">aips0</span></code> for the flag, to display something like this:</p>
<a class="reference internal image-reference" href="_images/diag_mask.png"><img alt="_images/diag_mask.png" src="_images/diag_mask.png" style="width: 250px;" /></a>
<p>By eye the correspondence between the different flag types and the image can be
seen. Note that the two frames might not match perfectly, since (a) WCS
information is not available in the flag file FITS headers; (b) the image can
have a zero-padded pixel border, which is not accounted for by <code class="docutils literal notranslate"><span class="pre">ds9</span></code>.</p>
</div>
<div class="section" id="detect-objects-on-tiles-and-process-stars-on-single-exposures">
<h2>Detect objects on tiles and process stars on single exposures<a class="headerlink" href="#detect-objects-on-tiles-and-process-stars-on-single-exposures" title="Permalink to this headline">¶</a></h2>
<p>The call</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>job_sp TILE_ID -j <span class="m">8</span>
</pre></div>
</div>
<p>performs a number of steps. First, objects on the tiles are deteced with the <code class="docutils literal notranslate"><span class="pre">sextractor</span></code> runner.
Next, the following tasks are run on the single-exposure single-CCD images:</p>
<ul class="simple">
<li><p>Objects are deteced with <code class="docutils literal notranslate"><span class="pre">sextractor</span></code>.</p></li>
<li><p>Star candidates are selected via <code class="docutils literal notranslate"><span class="pre">setools</span></code>.</p></li>
<li><p>The PSF model is created, either with <code class="docutils literal notranslate"><span class="pre">psfex</span></code> for PSFex, or
with <code class="docutils literal notranslate"><span class="pre">mccd_preprocessing</span></code> and <code class="docutils literal notranslate"><span class="pre">mccd_fit_val</span></code> for MCCD.</p></li>
<li><p>The PSF model is interpolated to star positions for validation. For the PSFEx model, this is done
via a call to <code class="docutils literal notranslate"><span class="pre">psfex_interp</span></code>. For MCCD, the modules <code class="docutils literal notranslate"><span class="pre">merge_starcat</span></code>, <code class="docutils literal notranslate"><span class="pre">mccd_plots</span></code>, and
<code class="docutils literal notranslate"><span class="pre">mccd_interp</span></code> are called.</p></li>
</ul>
<p>The output directory for both the <code class="docutils literal notranslate"><span class="pre">mccd</span></code> and <code class="docutils literal notranslate"><span class="pre">psfex</span></code> options is <code class="docutils literal notranslate"><span class="pre">run_sp_tile_Sx_exp_SxSePsf</span></code>.
This stores the output of SExtractor on the tiles (<code class="docutils literal notranslate"><span class="pre">tile_Sx</span></code>), on the exposures (<code class="docutils literal notranslate"><span class="pre">exp_Sx</span></code>),
<code class="docutils literal notranslate"><span class="pre">setools</span></code> (<code class="docutils literal notranslate"><span class="pre">Se</span></code>), and the Psf model (<code class="docutils literal notranslate"><span class="pre">Psf</span></code>).</p>
<p>The following plots show an example of a single CCD, in the center of the focal plane.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Size-magnitude plot</p></th>
<th class="head"><p>Star magnitude histogram</p></th>
<th class="head"><p>Stars in CCD (mag)</p></th>
<th class="head"><p>Stars in CCD (size)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="_images/size_mag-2113737-10.png"><img alt="_images/size_mag-2113737-10.png" src="_images/size_mag-2113737-10.png" style="width: 250px;" /></a></p></td>
<td><p><a class="reference internal" href="_images/hist_mag_stars-2113737-10.png"><img alt="_images/hist_mag_stars-2113737-10.png" src="_images/hist_mag_stars-2113737-10.png" style="width: 250px;" /></a></p></td>
<td><p><a class="reference internal" href="_images/mag_star_field-2113737-10.png"><img alt="_images/mag_star_field-2113737-10.png" src="_images/mag_star_field-2113737-10.png" style="width: 250px;" /></a></p></td>
<td><p><a class="reference internal" href="_images/fwhm_field-2113737-10.png"><img alt="_images/fwhm_field-2113737-10.png" src="_images/fwhm_field-2113737-10.png" style="width: 250px;" /></a></p></td>
</tr>
<tr class="row-odd"><td><p>The stellar locus is well-defined</p></td>
<td><p>Magnitude distribution looks reasonable</p></td>
<td><p>Stars are relatively homogeneously distributed over the CCD</p></td>
<td><p>The uniform and small seeing of CFHT is evident</p></td>
</tr>
</tbody>
</table>
<p>To contrast the last plot, here is the case of the CCD in the lower right corner, which shows a known (but yet unexplained) lack of stars
in the lower parts:</p>
<a class="reference internal image-reference" href="_images/fwhm_field-2113737-35.png"><img alt="_images/fwhm_field-2113737-35.png" src="_images/fwhm_field-2113737-35.png" style="width: 250px;" /></a>
<p>The statistics output file for the center CCD #10:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat star_stat-2113737-10.txt
<span class="c1"># Statistics</span>
Nb objects full <span class="nv">cat</span> <span class="o">=</span> <span class="m">1267</span>
Nb <span class="nv">stars</span> <span class="o">=</span> <span class="m">160</span>
stars/deg^2 <span class="o">=</span> <span class="m">6345</span>.70450519073
Mean star fwhm selected <span class="o">(</span>arcsec<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>.7441293125152588
Standard deviation fwhm star selected <span class="o">(</span>arcsec<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>.014217643037438393
Mode fwhm used <span class="o">(</span>arcsec<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>.7345179691314697
Min fwhm cut <span class="o">(</span>arcesec<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>.7159179691314698
Max fwhm cut <span class="o">(</span>arcsec<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>.7531179691314697
</pre></div>
</div>
<div class="section" id="global-star-sample-statistics">
<h3>Global star sample statistics<a class="headerlink" href="#global-star-sample-statistics" title="Permalink to this headline">¶</a></h3>
<p>The statistics on stars from all CCD can be combined to create histograms, with the non-pipeline script <code class="docutils literal notranslate"><span class="pre">stats_global.py</span></code>.
Run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>stats_global -o stats -v -c <span class="nv">$SP_CONFIG</span>/config_stats.ini
</pre></div>
</div>
<p>to create histograms (as <code class="docutils literal notranslate"><span class="pre">.txt</span></code> tables and <code class="docutils literal notranslate"><span class="pre">.png</span></code> plots) in the directory <code class="docutils literal notranslate"><span class="pre">stats</span></code>. Here are some example plots :</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Non-masked objects per CCD</p></th>
<th class="head"><p>Stars per CCD</p></th>
<th class="head"><p>FWHM mode</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="_images/1_nb_nonmasked.png"><img alt="_images/1_nb_nonmasked.png" src="_images/1_nb_nonmasked.png" style="width: 250px;" /></a></p></td>
<td><p><a class="reference internal" href="_images/2_nb_stars.png"><img alt="_images/2_nb_stars.png" src="_images/2_nb_stars.png" style="width: 250px;" /></a></p></td>
<td><p><a class="reference internal" href="_images/5_mode_fhwm_star.png"><img alt="_images/5_mode_fhwm_star.png" src="_images/5_mode_fhwm_star.png" style="width: 250px;" /></a></p></td>
</tr>
<tr class="row-odd"><td><p>No CCD with a very large masked area</p></td>
<td><p>No CCD with insufficient stars</p></td>
<td><p>Rather broad seeing distribution</p></td>
</tr>
</tbody>
</table>
<p>Note that <code class="docutils literal notranslate"><span class="pre">stats_global</span></code> read all <code class="docutils literal notranslate"><span class="pre">SETool</span></code> output stats files found in a given input directory tree. It can thus produce histogram combining
several runs.</p>
</div>
</div>
<div class="section" id="galaxy-selection">
<h2>Galaxy selection<a class="headerlink" href="#galaxy-selection" title="Permalink to this headline">¶</a></h2>
<p>The focus of the next step,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>job_sp TILE_ID -j <span class="m">16</span>
</pre></div>
</div>
<p>is the selection of galaxies as extended objects compared to the PSF.
First, the PSF model is interpolated to galaxy positions, according to the PSF model
with <code class="docutils literal notranslate"><span class="pre">psfex_interp</span></code> or <code class="docutils literal notranslate"><span class="pre">mccd_interp</span></code>. Next, postage stamps around galaxies
of the weights maps are created via <code class="docutils literal notranslate"><span class="pre">vignetmaker</span></code>. Then, the spread model
is computed by the <code class="docutils literal notranslate"><span class="pre">spread_model</span></code> module. Finally, postage stamps
around galaxies of single-exposure data is extracted with another call
to <code class="docutils literal notranslate"><span class="pre">vignetmaker</span></code>.</p>
<p>The output directory is</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">run_sp_MiViSmVi</span></code> if the PSF model is <code class="docutils literal notranslate"><span class="pre">mccd</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">run_sp_tile_PsViSmVi</span></code> for the <code class="docutils literal notranslate"><span class="pre">PSFEx</span></code> PSF model.</p></li>
</ul>
<p>This corresponds to the MCCD/PSFex interpolation (<code class="docutils literal notranslate"><span class="pre">Mi</span></code>/<code class="docutils literal notranslate"><span class="pre">Pi</span></code>), <code class="docutils literal notranslate"><span class="pre">vignetmaker</span></code> (<code class="docutils literal notranslate"><span class="pre">Vi</span></code>), <code class="docutils literal notranslate"><span class="pre">spread_model</span></code> (<code class="docutils literal notranslate"><span class="pre">Sm</span></code>), and the
second call to <code class="docutils literal notranslate"><span class="pre">vignetmaker</span></code> (<code class="docutils literal notranslate"><span class="pre">Vi</span></code>).</p>
</div>
<div class="section" id="shape-measurement">
<h2>Shape measurement<a class="headerlink" href="#shape-measurement" title="Permalink to this headline">¶</a></h2>
<p>The call</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>job_sp TILE_ID -j <span class="m">32</span>
</pre></div>
</div>
<p>computes galaxy shapes using the multi-epoch model-fitting method <code class="docutils literal notranslate"><span class="pre">ngmix</span></code>. At the same time,
shapes of artifically sheared galaxies are obtained for metacalibration.</p>
<p>Shape measurement is performed in parallel for each tile, the number of processes can be specified
by the user with the option <code class="docutils literal notranslate"><span class="pre">--nsh_jobs</span> <span class="pre">NJOB</span></code>. This creates <code class="docutils literal notranslate"><span class="pre">NJOB</span></code> output directories <code class="docutils literal notranslate"><span class="pre">run_sp_tile_ngmix_Ng&lt;X&gt;u</span></code>.
with <code class="docutils literal notranslate"><span class="pre">X</span></code> = 1 … <code class="docutils literal notranslate"><span class="pre">NJOB</span></code> containing the result of <code class="docutils literal notranslate"><span class="pre">ngmix</span></code>.</p>
</div>
<div class="section" id="paste-catalogues">
<h2>Paste catalogues<a class="headerlink" href="#paste-catalogues" title="Permalink to this headline">¶</a></h2>
<p>The last real processing step is</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>job_sp TILE_ID -j <span class="m">64</span>
</pre></div>
</div>
<p>This task first merges the <code class="docutils literal notranslate"><span class="pre">NJOB</span></code> parallel <code class="docutils literal notranslate"><span class="pre">ngmix</span></code> output files from the previous step into
one output file. Then, previously obtained information are pasted into a <em>final</em> shape catalogue via <code class="docutils literal notranslate"><span class="pre">make_cat</span></code>.
Included are galaxy detection and basic measurement parameters, the PSF model at
galaxy positions, the spread-model classification, and the shape measurement.</p>
<p>Two output directories are created.
The first one is <code class="docutils literal notranslate"><span class="pre">run_sp_Ms</span></code> for the <code class="docutils literal notranslate"><span class="pre">merge_sep</span></code> run.
The second is <code class="docutils literal notranslate"><span class="pre">run_sp_Mc</span></code> for the <code class="docutils literal notranslate"><span class="pre">make_cat</span></code> task; the name is the same for both the <code class="docutils literal notranslate"><span class="pre">MCCD</span></code> and <code class="docutils literal notranslate"><span class="pre">PSFEx</span></code> PSF model.</p>
</div>
<div class="section" id="upload-results">
<h2>Upload results<a class="headerlink" href="#upload-results" title="Permalink to this headline">¶</a></h2>
<p>Optionally, after the pipeline is finished, results can be uploaded to VOspace via</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>job_sp TILE_ID -j <span class="m">128</span>
</pre></div>
</div>
</div>
</div>


              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="testing.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Testing</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="post_processing.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Post-processing</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By CosmoStat<br/>
    
        &copy; Copyright 2022, CosmoStat.<br/>
      Last updated on 17 Sep, 2022.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>